<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="lib/github-markdown.css">
<style>
    .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        margin: 0 auto;
        padding: 45px;
    }

    @media (max-width: 767px) {
        .markdown-body {
            padding: 15px;
        }
    }
</style>
<article class="markdown-body">
<h1><a id="user-content-fonte-finding-bug-inducing-commit-from-failure" class="anchor" aria-hidden="true" href="#fonte-finding-bug-inducing-commit-from-failure"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Fonte: Finding Bug Inducing Commit From Failure</strong></h1>
<p align="center">
  <a target="_blank" rel="noopener noreferrer" href="./fonte.png"><img src="./fonte.png" style="max-width: 100%;"></a>
</p>
<h2><a id="user-content-environmental-setup" class="anchor" aria-hidden="true" href="#environmental-setup"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Environmental Setup</strong></h2>
<ul>
<li>H/W
<ul>
<li>Developed under Mac with Intel chip</li>
<li>Compatible with amd64 processors</li>
</ul>
</li>
<li>SW
<ul>
<li>
<p>Tested with bash (recommended), zsh, PowerShell</p>
</li>
<li>
<p>Requires Python &gt;= 3.9.1</p>
<ul>
<li>If you're using <code>pyenv</code>, you can use the following commands:
<div class="highlight highlight-source-shell"><pre>pyenv install 3.9.1
pyenv <span class="pl-k">local</span> 3.9.1</pre></div>
</li>
<li>
<strong>Install dependencies</strong>
<div class="highlight highlight-source-shell"><pre>python -m pip install numpy==1.21.0 pandas==1.4.3 scipy==1.9.0 tqdm matplotlib==3.4.0 seaborn==0.11.1 rank-bm25==0.2.2 tabulate==0.8.9 jupyter setuptools
python -m pip install lib/SBFL
python -m pip install lib/spiral</pre></div>
</li>
</ul>
</li>
<li>
<p>Docker client (only for the replication or extension): <a href="https://www.docker.com/products/docker-desktop" rel="nofollow">Download here</a></p>
</li>
</ul>
</li>
</ul>
<h2><a id="user-content-getting-started" class="anchor" aria-hidden="true" href="#getting-started"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Getting Started</strong></h2>
<h3><a id="user-content-please-note-that" class="anchor" aria-hidden="true" href="#please-note-that"><span aria-hidden="true" class="octicon octicon-link"></span></a>Please note that</h3>
<ul>
<li>The core ingredient data including coverage matrix and commit history is available at <code>./data/Defects4J/core/</code>.</li>
<li>The BIC dataset is available at <code>./data/Defects4J/BIC_dataset/</code>.</li>
</ul>
<h3><a id="user-content-running-fonte" class="anchor" aria-hidden="true" href="#running-fonte"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running Fonte</h3>
<div class="highlight highlight-source-shell"><pre>python Fonte.py data/Defecst4J/core/<span class="pl-k">&lt;</span>pid<span class="pl-k">&gt;</span>-<span class="pl-k">&lt;</span>vid<span class="pl-k">&gt;</span>b -o <span class="pl-k">&lt;</span>savepath<span class="pl-k">&gt;</span></pre></div>
<ul>
<li>
<p>Example:</p>
<div class="highlight highlight-source-shell"><pre>python Fonte.py data/Defects4J/core/Cli-29b -o output.csv
<span class="pl-c"><span class="pl-c">#</span> Number of total commits: 616</span>
<span class="pl-c"><span class="pl-c">#</span>          vote  rank  is_style_change</span>
<span class="pl-c"><span class="pl-c">#</span> commit</span>
<span class="pl-c"><span class="pl-c">#</span> c0d5c79   1.0   1.0            False</span>
<span class="pl-c"><span class="pl-c">#</span> 147df44   0.0   2.0             True</span></pre></div>
</li>
<li>
<p>Available arguments:</p>
<pre><code>usage: Fonte.py [-h] [--tool TOOL] [--formula FORMULA] [--alpha ALPHA] [--tau TAU] [--lamb LAMB] [--skip-stage-2] [--output OUTPUT] coredir

Compute commit scores

positional arguments:
  coredir               data/Defects4J/core/&lt;pid&gt;-&lt;vid&gt;b

optional arguments:
  -h, --help            show this help message and exit
  --tool TOOL           history retrieval tool, git or shovel (default: git)
  --formula FORMULA     SBFL formula (default: Ochiai)
  --alpha ALPHA         alpha (default: Ochiai)
  --tau TAU             tau (default: max)
  --lamb LAMB           lambda (default: 0.1)
  --skip-stage-2        skip stage 2 (default: False)
  --output OUTPUT, -o OUTPUT
                        path to output file (example: output.csv)
</code></pre>
</li>
</ul>
<h2><a id="user-content-reproducing-the-experiment-results" class="anchor" aria-hidden="true" href="#reproducing-the-experiment-results"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Reproducing the experiment results</strong></h2>
<ol>
<li>Run the Jupyter notebook
<div class="highlight highlight-source-shell"><pre>jupyter notebook</pre></div>
If you're a VSCode user, just install the <code>Jupyter</code> extension.</li>
<li>Open <code>experiment.ipynb</code> and run the cells to reproduce our experiment results.
<ul>
<li>The output will be saved to <code>./experiment_results/</code>. Note that the directory already contains the pre-computed results. If you want to fully replicate our experiments, remove all files from the <code>./experiment_results/</code> and run the cells again.</li>
</ul>
</li>
</ol>
<h2><a id="user-content-wait-how-to-extract-the-core-data-for-other-defects4j-faults-for-further-extensions-optional" class="anchor" aria-hidden="true" href="#wait-how-to-extract-the-core-data-for-other-defects4j-faults-for-further-extensions-optional"><span aria-hidden="true" class="octicon octicon-link"></span></a>
<strong>Wait, how to extract the core data for other Defects4J faults for further extensions?</strong> (optional)</h2>
<p>We provide a pre-built Docker image, containing our data collection scripts along with Defects4J, that can be used to extract the core data for all bugs in Defects4J.</p>
<ol>
<li>
<p>Pull the image from DockerHub. This may take a while because the image size is about 4GB.</p>
<div class="highlight highlight-source-shell"><pre>docker pull anonyfonte/fonte:latest</pre></div>
</li>
<li>
<p>Start a Docker container</p>
<div class="highlight highlight-source-shell"><pre>docker run -dt --name fonte -v <span class="pl-s"><span class="pl-pds">$(</span>pwd<span class="pl-pds">)</span></span>/docker/workspace:/root/workspace anonyfonte/fonte:latest</pre></div>
<ul>
<li>What the <code>-v</code> option does?: The directory <code>./docker/workspace</code> in the local machine will share data with <code>/root/workspace</code> in the container.</li>
<li>
<code>$(pwd)</code>: The current directory. Change it to <code>${PWD}</code> or <code>%cd%</code> if you're using PowerShell or Windows Command Prompt, respectively.</li>
</ul>
</li>
<li>
<p>Collect the coverage information and the commit history of <code>&lt;pid&gt;-&lt;vid&gt;b</code></p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> fonte sh collect_core.sh <span class="pl-k">&lt;</span>pid<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>vid<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>tool:git,shovel<span class="pl-k">&gt;</span>
<span class="pl-c"><span class="pl-c">#</span> docker exec fonte sh collect_core.sh Cli 29 git</span></pre></div>
<ul>
<li>The output will be saved to <code>./docker/workspace/data/&lt;pid&gt;-&lt;vid&gt;b/</code>
</li>
<li>Don't forget to append the tool option (<code>git</code> or <code>shovel</code>)!</li>
</ul>
</li>
<li>
<p>Run Fonte on the newly collected data:</p>
<div class="highlight highlight-source-shell"><pre>python Fonte.py ./docker/workspace/data/<span class="pl-k">&lt;</span>pid<span class="pl-k">&gt;</span>-<span class="pl-k">&lt;</span>vid<span class="pl-k">&gt;</span>b/
<span class="pl-c"><span class="pl-c">#</span> python Fonte.py ./docker/workspace/data/Cli-29b/</span></pre></div>
<p><g-emoji class="g-emoji" alias="bulb" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png">ðŸ’¡</g-emoji> To <strong>speed up</strong> the AST comparison, you can turn off the code formatting using OpenRewrite. Just append <code>false</code> when calling <code>collect_core.sh</code>:</p>
<div class="highlight highlight-source-shell"><pre>docker <span class="pl-c1">exec</span> fonte sh collect_core.sh <span class="pl-k">&lt;</span>pid<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>vid<span class="pl-k">&gt;</span> <span class="pl-k">&lt;</span>tool:git,shovel<span class="pl-k">&gt;</span> <span class="pl-c1">false</span>
<span class="pl-c"><span class="pl-c">#</span> docker exec fonte sh collect_core.sh Cli 29 git false</span></pre></div>
</li>
</ol>
<h2><a id="user-content-file--directory-structure" class="anchor" aria-hidden="true" href="#file--directory-structure"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>File &amp; Directory Structure</strong></h2>
<ul>
<li><code>README.md</code></li>
<li>
<code>CodeShovel-error.md</code>: this contains the error reproduction steps for CodeShovel</li>
<li><strong><code>Fonte.py</code>: Fonte CLI</strong></li>
<li><strong><code>experiment.ipynb</code>: the main experiment script</strong></li>
<li>
<code>run_Bug2Commit.py</code>: the python script implementing Bug2Commit (not contained in the lightweight version)</li>
<li>
<code>data/</code>
<ul>
<li>
<code>Defects4J/</code>
<ul>
<li>
<code>BIC_dataset/</code>
<ul>
<li><code>*.csv</code></li>
<li>
<code>README.md</code>: See this for more information about the BIC dataset</li>
</ul>
</li>
<li>
<code>core/</code>
<ul>
<li>
<code>&lt;pid&gt;-&lt;vid&gt;b</code>
<ul>
<li>
<code>git/</code>
<ul>
<li>
<code>commits.pkl</code>: pandas Dataframe</li>
<li>
<code>validation.csv</code>: style change commit validation results in the following format:
<pre lang="csv"><code>commit,filepath,[C|U|N|E]
...
</code></pre>
<ul>
<li>where
<ul>
<li>
<code>C</code>: ASTs are different (<strong>c</strong>hanged)</li>
<li>
<code>U</code>: ASTs are identical (<strong>u</strong>nchanged)</li>
<li>
<code>N</code>: The file is <strong>n</strong>ewly introduced</li>
<li>
<code>E</code>: External <strong>e</strong>rror by GumTree</li>
</ul>
</li>
<li>A commit is a style-change commit only when the result for every related file is <code>U</code>.</li>
</ul>
</li>
<li>
<code>validation_noOpenRewrite.csv</code>: style change commit validation results without the CheckStyle fixes using OpenRewrite</li>
</ul>
</li>
<li>
<code>shovel/</code>
<ul>
<li>
<code>raw/</code>: the raw output files from CodeShovel</li>
<li>
<code>commits.pkl</code>: pandas Dataframe</li>
<li><code>validation.csv</code></li>
<li>
<code>validation_noOpenRewrite.csv</code>: style change commit validation results without the CheckStyle fixes using OpenRewrite</li>
</ul>
</li>
<li>
<code>coverage.pkl</code>: pandas Dataframe (index: tests, columns: lines)</li>
<li>
<code>commits.log</code>: all commits in the branch</li>
<li>
<code>failing_tests</code>: the exception messages and stack traces of failing test cases (used when running Bug2Commit)</li>
</ul>
</li>
</ul>
</li>
<li>
<code>baseline/</code>: this contains the ingredients &amp; results for Bug2Commit and FBL-BERT.
<ul>
<li>
<code>&lt;pid&gt;-&lt;vid&gt;b/</code>
<ul>
<li>
<code>commits/</code>: the raw contents of commits that modified at least one <code>.java</code> file (collected using the <code>data_utils.py</code> in <a href="https://anonymous.4open.science/r/fbl-bert-700C" rel="nofollow">FBL-BERT</a>, not contained in the lightweight version)</li>
<li>
<code>br_short.txt</code>: a title of the bug report</li>
<li>
<code>br_long.txt</code>: a main body of the bug report</li>
<li>
<code>ranking_INDEX_FBLBERT_RN_bertoverflow_QARC_q256_d230_dim128_cosine_q256_d230_dim128_commits_token.tsv</code>: raw retrieval results for <code>&lt;pid&gt;-&lt;vid&gt;b</code> (<strong>FBL-BERT</strong>)</li>
<li>
<code>ranking_Bug2Commit.csv</code>: raw retrieval results for <code>&lt;pid&gt;-&lt;vid&gt;b</code> (<strong>Bug2Commit</strong>)</li>
</ul>
</li>
</ul>
</li>
<li>
<code>buggy_methods.json</code>: The buggy method information is constructed for the actual buggy versions of programs in Defects4J (corresponding to <code>revision.id.buggy</code>). The actual buggy version may differ from the isolated buggy version provided by Defects4J that you obtain right after the checkout. Therefore, the buggy methods may not exactly match the methods fixed by the patch.</li>
</ul>
</li>
<li>
<code>industry/</code>: the results of applying Fonte to the batch testing data of an industry software ABC
<ul>
<li>
<code>&lt;data&gt;_&lt;test&gt;.csv</code>: test names are anonymized due to DBR</li>
</ul>
</li>
</ul>
</li>
<li>
<code>docker/</code>: containing the docker resources that can be used to extract the core data
<ul>
<li>
<code>resources/</code>: the resources needed to build the image from scratch</li>
<li>
<code>Dockerfile</code>: the docker config file used to build the image <code>bic:new</code>
</li>
<li>
<code>workspace/</code>
<ul>
<li>
<code>collect_core.sh</code>: the main script for code data extraction</li>
<li><code>collect.py</code></li>
</ul>
</li>
</ul>
</li>
<li>
<code>experiment_results/</code>
<ul>
<li>
<code>rankings/</code>
<ul>
<li>
<code>git_line_Ochiai_voting(_C_BIC|_C_susp)/</code>: the postfix <code>_C_susp</code> means skipping Stage 2
<ul>
<li><code>&lt;tau&gt;-&lt;alpha&gt;-&lt;lambda&gt;.csv</code></li>
<li>
<code>score-&lt;lambda&gt;.csv</code>: baseline</li>
<li>
<code>equal-&lt;lambda&gt;.csv</code>: baseline</li>
</ul>
</li>
<li>
<code>git_line_Ochiai_maxArrg(_C_BIC|_C_susp).csv</code>: max-aggregation baseline</li>
<li>
<code>Random(_C_BIC|_C_susp).csv</code>: Random baseline</li>
<li>
<code>FBL-BERT(_C_BIC|_C_susp).csv</code>: FBL-BERT results</li>
<li>
<code>Bug2Commit(_C_BIC|_C_susp).csv</code>: Bug2Commit results</li>
<li>
<code>Worst(_C_BIC|_C_susp).csv</code>: Lower bound of the results</li>
</ul>
</li>
</ul>
</li>
<li>
<code>lib/</code>
<ul>
<li><code>SBFL/</code></li>
<li><code>spiral/</code></li>
<li>
<code>experiment_utils.py</code>: it contains the main functions</li>
<li><code>README.md</code></li>
</ul>
</li>
</ul>

</article>