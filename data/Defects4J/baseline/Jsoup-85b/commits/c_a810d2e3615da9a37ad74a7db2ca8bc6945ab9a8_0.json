{"sha": "a810d2e3615da9a37ad74a7db2ca8bc6945ab9a8", "log": "Don't blow up if a namespace is undefined  Fixes #848", "commit": "\n--- a/src/main/java/org/jsoup/helper/W3CDom.java\n+++ b/src/main/java/org/jsoup/helper/W3CDom.java\n \n                 String prefix = updateNamespaces(sourceEl);\n                 String namespace = namespacesStack.peek().get(prefix);\n+                String tagName = sourceEl.tagName();\n \n-                Element el = doc.createElementNS(namespace, sourceEl.tagName());\n+                Element el = namespace == null && tagName.contains(\":\") ?\n+                    doc.createElementNS(\"\", tagName) : // doesn't have a real namespace defined\n+                    doc.createElementNS(namespace, tagName);\n                 copyAttributes(sourceEl, el);\n                 if (dest == null) { // sets up the root\n                     doc.appendChild(el);\n--- a/src/test/java/org/jsoup/helper/W3CDomTest.java\n+++ b/src/test/java/org/jsoup/helper/W3CDomTest.java\n import java.io.IOException;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n import static org.junit.Assert.assertTrue;\n \n public class W3CDomTest {\n \n         Document w3Doc = new W3CDom().fromJsoup(jsoupDoc);\n     }\n+\n+    @Test public void treatsUndeclaredNamespaceAsLocalName() {\n+        String html = \"<fb:like>One</fb:like>\";\n+        org.jsoup.nodes.Document doc = Jsoup.parse(html);\n+\n+        Document w3Doc = new W3CDom().fromJsoup(doc);\n+        Node htmlEl = w3Doc.getFirstChild();\n+\n+        assertNull(htmlEl.getNamespaceURI());\n+        assertEquals(\"html\", htmlEl.getLocalName());\n+        assertEquals(\"html\", htmlEl.getNodeName());\n+\n+        Node fb = htmlEl.getFirstChild().getNextSibling().getFirstChild();\n+        assertNull(fb.getNamespaceURI());\n+        assertEquals(\"like\", fb.getLocalName());\n+        assertEquals(\"fb:like\", fb.getNodeName());\n+\n+    }\n }\n ", "timestamp": 1525043772, "metainfo": ""}