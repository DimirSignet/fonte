{"sha": "e9feec90dbd3e428dc1930c3b5efbd9271160d01", "log": "Check that XML declarations parse OK  Fixes #1015", "commit": "\n--- a/src/main/java/org/jsoup/parser/XmlTreeBuilder.java\n+++ b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java\n             String data = comment.getData();\n             if (data.length() > 1 && (data.startsWith(\"!\") || data.startsWith(\"?\"))) {\n                 Document doc = Jsoup.parse(\"<\" + data.substring(1, data.length() -1) + \">\", baseUri, Parser.xmlParser());\n-                Element el = doc.child(0);\n-                insert = new XmlDeclaration(settings.normalizeTag(el.tagName()), data.startsWith(\"!\"));\n-                insert.attributes().addAll(el.attributes());\n+                if (doc.childNodeSize() > 0) {\n+                    Element el = doc.child(0);\n+                    insert = new XmlDeclaration(settings.normalizeTag(el.tagName()), data.startsWith(\"!\"));\n+                    insert.attributes().addAll(el.attributes());\n+                } // else, we couldn't parse it as a decl, so leave as a comment\n             }\n         }\n         insertNode(insert);\n--- a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java\n+++ b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java\n \n         assertEquals(\"//\\n\\n  foo();\\n//\", doc.selectFirst(\"script\").text());\n     }\n+\n+    @Test\n+    public void handlesDodgyXmlDecl() {\n+        String xml = \"<?xml version='1.0'><val>One</val>\";\n+        Document doc = Jsoup.parse(xml, \"\", Parser.xmlParser());\n+        assertEquals(\"One\", doc.select(\"val\").text());\n+    }\n }", "timestamp": 1523826554, "metainfo": ""}