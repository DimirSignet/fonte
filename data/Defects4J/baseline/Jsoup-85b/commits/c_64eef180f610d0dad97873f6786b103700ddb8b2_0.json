{"sha": "64eef180f610d0dad97873f6786b103700ddb8b2", "log": "Test case for deflate", "commit": "\n--- a/src/test/java/org/jsoup/integration/ConnectTest.java\n+++ b/src/test/java/org/jsoup/integration/ConnectTest.java\n \n import org.jsoup.Connection;\n import org.jsoup.Jsoup;\n+import org.jsoup.integration.servlets.Deflateservlet;\n import org.jsoup.integration.servlets.EchoServlet;\n import org.jsoup.integration.servlets.HelloServlet;\n import org.jsoup.integration.servlets.SlowRider;\n         Document doc = Jsoup.connect(echoUrl).cookies(cookies).get();\n         assertEquals(\"token=asdfg123; uid=jhy\", ihVal(\"Cookie\", doc));\n     }\n+\n+    @Test\n+    public void supportsDeflate() throws IOException {\n+        Connection.Response res = Jsoup.connect(Deflateservlet.Url).execute();\n+        assertEquals(\"deflate\", res.header(\"Content-Encoding\"));\n+\n+        Document doc = res.parse();\n+        assertEquals(\"Hello, World!\", doc.selectFirst(\"p\").text());\n+    }\n }\n--- /dev/null\n+++ b/src/test/java/org/jsoup/integration/servlets/Deflateservlet.java\n+package org.jsoup.integration.servlets;\n+\n+import org.jsoup.integration.TestServer;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.zip.Deflater;\n+import java.util.zip.DeflaterOutputStream;\n+\n+public class Deflateservlet extends BaseServlet {\n+    public static final String Url = TestServer.map(Deflateservlet.class);\n+\n+    @Override\n+    protected void doGet(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {\n+        res.setContentType(TextHtml);\n+        res.setStatus(HttpServletResponse.SC_OK);\n+        res.setHeader(\"Content-Encoding\", \"deflate\");\n+\n+        String doc = \"<p>Hello, World!<p>That should be enough, right?<p>Hello, World!<p>That should be enough, right?\";\n+\n+        DeflaterOutputStream stream = new DeflaterOutputStream(\n+            res.getOutputStream(),\n+            new Deflater(Deflater.BEST_COMPRESSION, true)); // true = nowrap zlib headers\n+\n+       stream.write(doc.getBytes(StandardCharsets.UTF_8));\n+       stream.close();\n+    }\n+\n+    // allow the servlet to run as a main program, for local test\n+    public static void main(String[] args) {\n+        TestServer.start();\n+        System.out.println(Url);\n+    }\n+}", "timestamp": 1512334911, "metainfo": ""}