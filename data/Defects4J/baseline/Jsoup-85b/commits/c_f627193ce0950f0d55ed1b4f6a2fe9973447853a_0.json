{"sha": "f627193ce0950f0d55ed1b4f6a2fe9973447853a", "log": "Collapse boolean attribute empty string values  Fixes #985", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Attribute.java\n+++ b/src/main/java/org/jsoup/nodes/Attribute.java\n         return shouldCollapseAttribute(key, val, out);\n     }\n \n-    protected static boolean shouldCollapseAttribute(String key, String val, Document.OutputSettings out) {\n-        // todo: optimize\n-        return (val == null || \"\".equals(val) || val.equalsIgnoreCase(key))\n-            && out.syntax() == Document.OutputSettings.Syntax.html\n-            && isBooleanAttribute(key);\n+    protected static boolean shouldCollapseAttribute(final String key, final String val, final Document.OutputSettings out) {\n+        return (\n+            out.syntax() == Document.OutputSettings.Syntax.html &&\n+                (val == null || (\"\".equals(val) || val.equalsIgnoreCase(key)) && Attribute.isBooleanAttribute(key)));\n     }\n \n     /**\n--- a/src/main/java/org/jsoup/nodes/Attributes.java\n+++ b/src/main/java/org/jsoup/nodes/Attributes.java\n             accum.append(' ').append(key);\n \n             // collapse checked=null, checked=\"\", checked=checked; write out others\n-            if (!(out.syntax() == Document.OutputSettings.Syntax.html\n-                && (val == null || val.equals(key) && Attribute.isBooleanAttribute(key)))) {\n-\n+            if (!Attribute.shouldCollapseAttribute(key, val, out)) {\n                 accum.append(\"=\\\"\");\n                 Entities.escape(accum, val == null ? EmptyString : val, out, true, false, false);\n                 accum.append('\"');\n--- a/src/test/java/org/jsoup/nodes/ElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/ElementTest.java\n         assertFalse(doc.body().html().contains(\"class=\\\"\\\"\"));\n     }\n \n+    @Test\n+    public void booleanAttributeOutput() {\n+        Document doc = Jsoup.parse(\"<img src=foo noshade='' nohref async=async autofocus=false>\");\n+        Element img = doc.selectFirst(\"img\");\n+\n+        assertEquals(\"<img src=\\\"foo\\\" noshade nohref async autofocus=\\\"false\\\">\", img.outerHtml());\n+    }\n+\n }", "timestamp": 1512340697, "metainfo": ""}