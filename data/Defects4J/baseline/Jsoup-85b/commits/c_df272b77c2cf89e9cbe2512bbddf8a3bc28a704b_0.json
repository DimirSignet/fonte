{"sha": "df272b77c2cf89e9cbe2512bbddf8a3bc28a704b", "log": "In XML parse mode set to lowercase, normalize closing tags  Fixes #998", "commit": "\n--- a/src/main/java/org/jsoup/parser/XmlTreeBuilder.java\n+++ b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java\n      * @param endTag tag to close\n      */\n     private void popStackToClose(Token.EndTag endTag) {\n-        String elName = endTag.name();\n+        String elName = endTag.normalName();\n         Element firstFound = null;\n \n         for (int pos = stack.size() -1; pos >= 0; pos--) {\n--- a/src/test/java/org/jsoup/parser/HtmlParserTest.java\n+++ b/src/test/java/org/jsoup/parser/HtmlParserTest.java\n         assertEquals(\"<r> <x> A </x> <y> B </y> </r>\", StringUtil.normaliseWhitespace(doc.body().html()));\n     }\n \n+    @Test public void normalizesDiscordantTags() {\n+        Document document = Jsoup.parse(\"<div>test</DIV><p></p>\");\n+        assertEquals(\"<div>\\n test\\n</div>\\n<p></p>\", document.body().html());\n+    }\n+\n     @Test public void selfClosingVoidIsNotAnError() {\n         String html = \"<p>test<br/>test<br/></p>\";\n         Parser parser = Parser.htmlParser().setTrackErrors(5);\n--- a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java\n+++ b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java\n         assertEquals(\"<test id=\\\"1\\\">Check</test>\", TextUtil.stripNewlines(doc.html()));\n     }\n \n+    @Test public void normalizesDiscordantTags() {\n+        Parser parser = Parser.xmlParser().settings(ParseSettings.htmlDefault);\n+        Document document = Jsoup.parse(\"<div>test</DIV><p></p>\", \"\", parser);\n+        assertEquals(\"<div>\\n test\\n</div>\\n<p></p>\", document.html());\n+        // was failing -> toString() = \"<div>\\n test\\n <p></p>\\n</div>\"\n+    }\n+\n     @Test public void roundTripsCdata() {\n         String xml = \"<div id=1><![CDATA[\\n<html>\\n <foo><&amp;]]></div>\";\n         Document doc = Jsoup.parse(xml, \"\", Parser.xmlParser());", "timestamp": 1513967108, "metainfo": ""}