{"sha": "1463c01840c5738bd4daa1e50640d71b3ae751c3", "log": "Handle differences between JDK1.3 and JDK1.4  ", "commit": "\n--- a/src/java/org/apache/commons/lang/LocaleUtils.java\n+++ b/src/java/org/apache/commons/lang/LocaleUtils.java\n      * locale object from it.</p>\n      *\n      * <pre>\n-     *   LocaleUtils.toLocale(\"en\")     = new Locale(\"en\", \"\")\n-     *   LocaleUtils.toLocale(\"en_GB\")  = new Locale(\"en\", \"GB\")\n-     *   LocaleUtils.toLocale(\"en_GB_xxx\")  = new Locale(\"en\", \"GB\", \"xxx\")\n+     *   LocaleUtils.toLocale(\"en\")         = new Locale(\"en\", \"\")\n+     *   LocaleUtils.toLocale(\"en_GB\")      = new Locale(\"en\", \"GB\")\n+     *   LocaleUtils.toLocale(\"en_GB_xxx\")  = new Locale(\"en\", \"GB\", \"xxx\")   (#)\n      * </pre>\n-     * \n+     *\n+     * <p>(#) The behaviour of the JDK variant constructor changed between JDK1.3 and JDK1.4.\n+     * In JDK1.3, the constructor upper cases the variant, in JDK1.4, it doesn't.\n+     * Thus, the result from getVariant() may vary depending on your JDK.</p>\n+     *\n      * <p>This method validates the input strictly.\n      * The language code must be lowercase.\n      * The country code must be uppercase.\n--- a/src/test/org/apache/commons/lang/LocaleUtilsTest.java\n+++ b/src/test/org/apache/commons/lang/LocaleUtilsTest.java\n      * Test toLocale() method.\n      */\n     public void testToLocale_3Part() {\n-        assertValidToLocale(\"us_EN_a\", \"us\", \"EN\", \"a\");\n         assertValidToLocale(\"us_EN_A\", \"us\", \"EN\", \"A\");\n-        assertValidToLocale(\"us_EN_SFsafdFDsdfF\", \"us\", \"EN\", \"SFsafdFDsdfF\");\n+        // this isn't pretty, but was caused by a jdk bug it seems\n+        // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4210525\n+        if (SystemUtils.isJavaVersionAtLeast(1.4f)) {\n+            assertValidToLocale(\"us_EN_a\", \"us\", \"EN\", \"a\");\n+            assertValidToLocale(\"us_EN_SFsafdFDsdfF\", \"us\", \"EN\", \"SFsafdFDsdfF\");\n+        } else {\n+            assertValidToLocale(\"us_EN_a\", \"us\", \"EN\", \"A\");\n+            assertValidToLocale(\"us_EN_SFsafdFDsdfF\", \"us\", \"EN\", \"SFSAFDFDSDFF\");\n+        }\n         \n         try {\n             LocaleUtils.toLocale(\"us_EN-a\");\n             new Locale[] {\n                 LOCALE_EN_US_ZZZZ,\n                 LOCALE_EN_US,\n-                new Locale(\"en\", \"\")});\n+                LOCALE_EN});\n     }        \n \n     /**", "timestamp": 1128765325, "metainfo": ""}