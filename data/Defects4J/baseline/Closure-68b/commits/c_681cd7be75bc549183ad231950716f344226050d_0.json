{"sha": "681cd7be75bc549183ad231950716f344226050d", "log": "Fix another regression in extern-synthesized vars. The problem came up because we were attaching @suppress {duplicate} to VAR nodes, and CollapseVariableDeclarations was deleting those @suppress tags.  R=johnlenz DELTA=23  (21 added, 0 deleted, 2 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=212   ", "commit": "\n--- a/src/com/google/javascript/jscomp/VarCheck.java\n+++ b/src/com/google/javascript/jscomp/VarCheck.java\n         varsToDeclareInExterns.contains(varName)) {\n       createSynthesizedExternVar(varName);\n \n-      parent.addSuppression(\"duplicate\");\n+      n.addSuppression(\"duplicate\");\n     }\n \n     // Check that the var has been declared.\n--- a/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n+++ b/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n import com.google.common.base.Joiner;\n import com.google.common.base.Supplier;\n import com.google.common.base.Suppliers;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.collect.Lists;\n import com.google.javascript.rhino.Node;\n \n   private List<String> args = Lists.newArrayList();\n \n   /** Externs for the test */\n-  private final List<JSSourceFile> externs = Lists.newArrayList(\n+  private final List<JSSourceFile> DEFAULT_EXTERNS = ImmutableList.of(\n     JSSourceFile.fromCode(\"externs\",\n         \"var arguments;\"\n         + \"/**\\n\"\n         + \"/** @nosideeffects */ function noSideEffects() {}\")\n   );\n \n+  private List<JSSourceFile> externs;\n+\n   @Override\n   public void setUp() throws Exception {\n     super.setUp();\n+    externs = DEFAULT_EXTERNS;\n     lastCompiler = null;\n     outReader = new ByteArrayOutputStream();\n     errReader = new ByteArrayOutputStream();\n         \"  node0 -> node1 [label=\\\"UNCOND\\\", fontcolor=\\\"red\\\", weight=0.01, color=\\\"red\\\"];\\n\" +\n         \"}\\n\\n\",\n         new String(outReader.toByteArray()));\n+  }\n+\n+  public void testSyntheticExterns() {\n+    externs = ImmutableList.of(\n+        JSSourceFile.fromCode(\"externs\", \"myVar.property;\"));\n+    test(\"var theirVar = {}; var myVar = {}; var yourVar = {};\",\n+         VarCheck.UNDEFINED_EXTERN_VAR_ERROR);\n+\n+    args.add(\"--jscomp_off=externsValidation\");\n+    args.add(\"--warning_level=VERBOSE\");\n+    test(\"var theirVar = {}; var myVar = {}; var yourVar = {};\",\n+         \"var theirVar={},myVar={},yourVar={};\");\n+\n+    args.add(\"--jscomp_off=externsValidation\");\n+    args.add(\"--warning_level=VERBOSE\");\n+    test(\"var theirVar = {}; var myVar = {}; var myVar = {};\",\n+         SyntacticScopeCreator.VAR_MULTIPLY_DECLARED_ERROR);\n   }\n \n   /* Helper functions */", "timestamp": 1294269482, "metainfo": ""}