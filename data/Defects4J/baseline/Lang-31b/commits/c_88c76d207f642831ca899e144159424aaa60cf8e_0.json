{"sha": "88c76d207f642831ca899e144159424aaa60cf8e", "log": "Fixing #LANG-294. The indexOf method did not take into account the size variable that limited the amount of the buffer that should be looked at.   ", "commit": "\n--- a/src/java/org/apache/commons/lang/text/StrBuilder.java\n+++ b/src/java/org/apache/commons/lang/text/StrBuilder.java\n             return -1;\n         }\n         char[] thisBuf = buffer;\n+        int len = size - strLen + 1;\n         outer:\n-        for (int i = startIndex; i < thisBuf.length - strLen; i++) {\n+        for (int i = startIndex; i < len; i++) {\n             for (int j = 0; j < strLen; j++) {\n                 if (str.charAt(j) != thisBuf[i + j]) {\n                     continue outer;\n--- a/src/test/org/apache/commons/lang/text/StrBuilderTest.java\n+++ b/src/test/org/apache/commons/lang/text/StrBuilderTest.java\n         assertEquals(new StringBuffer(\"junit\").toString(), sb.toStringBuffer().toString());\n     }\n \n+    //-----------------------------------------------------------------------\n+    public void testLang294() {\n+        StrBuilder sb = new StrBuilder(\"\\n%BLAH%\\nDo more stuff\\neven more stuff\\n%BLAH%\\n\");\n+        sb.deleteAll(\"\\n%BLAH%\");\n+        assertEquals(\"\\nDo more stuff\\neven more stuff\\n\", sb.toString()); \n+    }\n+\n+    public void testIndexOfLang294() {\n+        StrBuilder sb = new StrBuilder(\"onetwothree\");\n+        sb.deleteFirst(\"three\");\n+        assertEquals(-1, sb.indexOf(\"three\"));\n+    }\n+\n }", "timestamp": 1162332900, "metainfo": ""}