{"sha": "df4c479df0b633103e92251665f999a0b113fbb2", "log": "COMPRESS-215 improve central directory location for Zip32 archives, based on patch by Robin Power  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipFile.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipFile.java\n      */\n     private void positionAtCentralDirectory()\n         throws IOException {\n-        boolean found = tryToLocateSignature(MIN_EOCD_SIZE + ZIP64_EOCDL_LENGTH,\n-                                             MAX_EOCD_SIZE + ZIP64_EOCDL_LENGTH,\n-                                             ZipArchiveOutputStream\n-                                             .ZIP64_EOCD_LOC_SIG);\n+        positionAtEndOfCentralDirectoryRecord();\n+        archive.seek(archive.getFilePointer() - ZIP64_EOCDL_LENGTH);\n+        archive.readFully(WORD_BUF);\n+        boolean found = Arrays.equals(ZipArchiveOutputStream.ZIP64_EOCD_LOC_SIG,\n+                                      WORD_BUF);\n         if (!found) {\n             // not a ZIP64 archive\n+            skipBytes(ZIP64_EOCDL_LENGTH - WORD);\n             positionAtCentralDirectory32();\n         } else {\n             positionAtCentralDirectory64();\n      */\n     private void positionAtCentralDirectory64()\n         throws IOException {\n-        skipBytes(ZIP64_EOCDL_LOCATOR_OFFSET);\n+        skipBytes(ZIP64_EOCDL_LOCATOR_OFFSET\n+                  - WORD /* signature has already been read */);\n         archive.readFully(DWORD_BUF);\n         archive.seek(ZipEightByteInteger.getLongValue(DWORD_BUF));\n         archive.readFully(WORD_BUF);\n      */\n     private void positionAtCentralDirectory32()\n         throws IOException {\n+        skipBytes(CFD_LOCATOR_OFFSET);\n+        archive.readFully(WORD_BUF);\n+        archive.seek(ZipLong.getValue(WORD_BUF));\n+    }\n+\n+    /**\n+     * Searches for the and positions the stream at the start of the\n+     * &quot;End of central dir record&quot;.\n+     */\n+    private void positionAtEndOfCentralDirectoryRecord()\n+        throws IOException {\n         boolean found = tryToLocateSignature(MIN_EOCD_SIZE, MAX_EOCD_SIZE,\n                                              ZipArchiveOutputStream.EOCD_SIG);\n         if (!found) {\n             throw new ZipException(\"archive is not a ZIP archive\");\n         }\n-        skipBytes(CFD_LOCATOR_OFFSET);\n-        archive.readFully(WORD_BUF);\n-        archive.seek(ZipLong.getValue(WORD_BUF));\n     }\n \n     /**", "timestamp": 1358604121, "metainfo": ""}