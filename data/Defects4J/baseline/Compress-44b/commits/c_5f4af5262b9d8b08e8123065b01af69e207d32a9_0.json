{"sha": "5f4af5262b9d8b08e8123065b01af69e207d32a9", "log": "Use archiveList for keeping track of archive contents  ", "commit": "\n--- a/src/test/java/org/apache/commons/compress/changes/ChangeSetTestCase.java\n+++ b/src/test/java/org/apache/commons/compress/changes/ChangeSetTestCase.java\n  */\n package org.apache.commons.compress.changes;\n \n+import java.io.BufferedInputStream;\n import java.io.File;\n import java.io.FileInputStream;\n import java.io.FileOutputStream;\n import java.io.InputStream;\n import java.util.ArrayList;\n+import java.util.Iterator;\n import java.util.List;\n \n import org.apache.commons.compress.AbstractTestCase;\n     \n     private ArchiveStreamFactory factory = new ArchiveStreamFactory();\n \n+    private void archiveListDelete(String prefix){\n+        Iterator it = archiveList.iterator();\n+        while(it.hasNext()){\n+            String entry = (String) it.next();\n+            if (entry.equals(prefix) || entry.startsWith(prefix+\"/\")){\n+                it.remove();\n+            }\n+        }\n+    }\n+\n     /**\n      * Tries to delete the folder \"bla\" from a zip file. This should result in\n      * the deletion of bla/*, which actually means bla/test4.xml should be\n \n             ChangeSet changes = new ChangeSet();\n             changes.delete(\"bla\");\n+            archiveListDelete(\"bla\");\n             changes.perform(ais, out);\n             is.close();\n \n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test1.xml\");\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"test with spaces.txt\");\n-\n-        this.checkArchiveContent(result, expected);\n+        this.checkArchiveContent(result, archiveList);\n     }\n \n     /**\n \n             ChangeSet changes = new ChangeSet();\n             changes.delete(\"bla/test5.xml\");\n+            archiveListDelete(\"bla/test5.xml\");\n             changes.perform(ais, out);\n             is.close();\n \n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test1.xml\");\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"test with spaces.txt\");\n-        expected.add(\"bla/test4.xml\");\n-        expected.add(\"bla/blubber/test6.xml\");\n-        this.checkArchiveContent(result, expected);\n+        this.checkArchiveContent(result, archiveList);\n     }\n \n     /**\n \n             ChangeSet changes = new ChangeSet();\n             changes.delete(\"bla\");\n+            archiveListDelete(\"bla\");\n \n             // Add a file\n             final File file1 = getFile(\"test.txt\");\n             ArchiveEntry entry = new ZipArchiveEntry(\"bla/test.txt\");\n             changes.add(entry, new FileInputStream(file1));\n+            archiveList.add(\"bla/test.txt\");\n \n             changes.perform(ais, out);\n             is.close();\n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test1.xml\");\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"bla/test.txt\");\n-        expected.add(\"test with spaces.txt\");\n-\n-        this.checkArchiveContent(result, expected);\n+        this.checkArchiveContent(result, archiveList);\n     }\n \n     /**\n             final File file1 = getFile(\"test.txt\");\n             ArchiveEntry entry = new ZipArchiveEntry(\"blub/test.txt\");\n             changes.add(entry, new FileInputStream(file1));\n+            archiveList.add(\"blub/test.txt\");\n \n             changes.delete(\"testdata/test1.xml\");\n+            archiveListDelete(\"testdata/test1.xml\");\n \n             changes.perform(ais, out);\n             is.close();\n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"blub/test.txt\");\n-        expected.add(\"bla/test5.xml\");\n-        expected.add(\"bla/blubber/test6.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"bla/test4.xml\");\n-        expected.add(\"test with spaces.txt\");\n-\n-        this.checkArchiveContent(result, expected);\n-    }\n-\n-    /**\n-     * add blub/test.txt + delete blub Should add dir1/test.txt and delete it\n+        this.checkArchiveContent(result, archiveList);\n+    }\n+\n+    /**\n+     * add blub/test.txt + delete blub Should add blub/test.txt and delete it\n      * afterwards. In this example, the zip archive should stay untouched.\n      * \n      * @throws Exception\n             final File file1 = getFile(\"test.txt\");\n             ArchiveEntry entry = new ZipArchiveEntry(\"blub/test.txt\");\n             changes.add(entry, new FileInputStream(file1));\n+            archiveList.add(\"blub/test.txt\");\n \n             changes.delete(\"blub\");\n+            archiveListDelete(\"blub\");\n \n             changes.perform(ais, out);\n             is.close();\n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test1.xml\");\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"bla/test5.xml\");\n-        expected.add(\"bla/blubber/test6.xml\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"bla/test4.xml\");\n-        expected.add(\"test with spaces.txt\");\n-\n-        this.checkArchiveContent(result, expected);\n+        this.checkArchiveContent(result, archiveList);\n     }\n \n     /**\n             final File file1 = getFile(\"test.txt\");\n             ArchiveEntry entry = new ZipArchiveEntry(\"bla/test.txt\");\n             changes.add(entry, new FileInputStream(file1));\n+            archiveList.add(\"bla/test.txt\");\n \n             changes.delete(\"bla\");\n+            archiveListDelete(\"bla\");\n \n             changes.perform(ais, out);\n             is.close();\n                 ais.close();\n         }\n \n-        List expected = new ArrayList();\n-        expected.add(\"testdata/test1.xml\");\n-        expected.add(\"testdata/test2.xml\");\n-        expected.add(\"test/test3.xml\");\n-        expected.add(\"test.txt\");\n-        expected.add(\"something/bla\");\n-        expected.add(\"test with spaces.txt\");\n-\n-        this.checkArchiveContent(result, expected);\n+        this.checkArchiveContent(result, archiveList);\n     }\n \n     /**\n         List expected = new ArrayList();\n         expected.add(\"test1.xml\");\n         expected.add(\"testdata/test.txt\");\n-        // TODO: automatic detection of TAR archive temp fails here\n         final ArchiveInputStream in = factory.createArchiveInputStream(\"tar\", new FileInputStream(temp));\n         this.checkArchiveContent(in, expected);\n     }", "timestamp": 1238365202, "metainfo": ""}