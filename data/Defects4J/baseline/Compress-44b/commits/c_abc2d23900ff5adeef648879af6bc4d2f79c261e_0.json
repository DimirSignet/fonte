{"sha": "abc2d23900ff5adeef648879af6bc4d2f79c261e", "log": "COMPRESS-357 synchronize the important part of finish again", "commit": "\n--- a/src/main/java/org/apache/commons/compress/compressors/bzip2/BZip2CompressorOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/bzip2/BZip2CompressorOutputStream.java\n     private Data data;\n     private BlockSort blockSorter;\n \n+    private final Object outLock = new Object();\n     private OutputStream out;\n \n     /**\n     }\n \n \n-    public synchronized void finish() throws IOException {\n-        if (out != null) {\n-            try {\n-                if (this.runLength > 0) {\n-                    writeRun();\n-                }\n-                this.currentChar = -1;\n-                endBlock();\n-                endCompression();\n-            } finally {\n-                this.out = null;\n-                this.data = null;\n-                this.blockSorter = null;\n-            }\n-        }\n+    public void finish() throws IOException {\n+        synchronized(outLock) {\n+            if (out != null) {\n+                try {\n+                    if (this.runLength > 0) {\n+                        writeRun();\n+                    }\n+                    this.currentChar = -1;\n+                    endBlock();\n+                    endCompression();\n+                } finally {\n+                    this.out = null;\n+                }\n+            }\n+        }\n+        this.blockSorter = null;\n+        this.data = null;\n     }\n \n     @Override", "timestamp": 1465659195, "metainfo": ""}