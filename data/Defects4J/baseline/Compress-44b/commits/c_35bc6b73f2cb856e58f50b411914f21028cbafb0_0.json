{"sha": "35bc6b73f2cb856e58f50b411914f21028cbafb0", "log": "Oops - test class was not being run because the name ended in Tests instead of Test Fix up to work under Surefire  ", "commit": "\n--- /dev/null\n+++ b/src/test/java/org/apache/commons/compress/ArchiveReadTest.java\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \n+ */\n+\n+package org.apache.commons.compress;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import junit.framework.Test;\n+import junit.framework.TestSuite;\n+\n+import org.apache.commons.compress.archivers.ArchiveEntry;\n+import org.apache.commons.compress.archivers.ArchiveException;\n+\n+/**\n+ * Test that can read various archive file examples.\n+ * \n+ * This is a very simple implementation.\n+ * \n+ * Files must be in resources/archives, and there must be a file.txt containing\n+ * the list of files in the archives.\n+ * \n+ * The class uses nested suites in order to be able to name the test after the file name,\n+ * as JUnit does not allow one to change the display name of a test.\n+ */\n+public class ArchiveReadTest extends AbstractTestCase {\n+\n+    final static ClassLoader classLoader = ArchiveReadTest.class.getClassLoader();\n+\n+    private File file;\n+    private static final ArrayList<String> fileList = new ArrayList<String>();\n+\n+    public ArchiveReadTest(String name) {\n+        super(name);\n+    }\n+\n+    private ArchiveReadTest(String name, File file){\n+        super(name);\n+        this.file = file;\n+    }\n+\n+    public static TestSuite suite() throws IOException{\n+        TestSuite suite = new TestSuite(\"ArchiveReadTests\");\n+        // TODO move fileList setup to static block\n+        File arcdir =new File(classLoader.getResource(\"archives\").getFile());\n+        assertTrue(arcdir.exists());\n+        File listing= new File(arcdir,\"files.txt\");\n+        assertTrue(\"files.txt is readable\",listing.canRead());\n+        BufferedReader br = new BufferedReader(new FileReader(listing));\n+        String line;\n+        fileList.clear(); // Surefire calls the suite more than once\n+        while ((line=br.readLine())!=null){\n+            if (line.startsWith(\"#\")){\n+                continue;\n+            }\n+            fileList.add(line);\n+        }\n+        br.close();\n+        File[]files=arcdir.listFiles();\n+        for (final File file : files) {\n+            if (file.getName().endsWith(\".txt\")){\n+                continue;\n+            }\n+            // Appears to be the only way to give the test a variable name\n+            TestSuite namedSuite = new TestSuite(file.getName());\n+            Test test = new ArchiveReadTest(\"testArchive\", file);\n+            namedSuite.addTest(test);\n+            suite.addTest(namedSuite);\n+        }\n+        return suite;\n+    }\n+\n+    // files.txt contains size and filename\n+    @Override\n+    protected String getExpectedString(ArchiveEntry entry) {\n+        return entry.getSize() + \" \" + entry.getName();\n+    }\n+\n+    public void testArchive() throws Exception{\n+        @SuppressWarnings(\"unchecked\") // fileList is correct type already\n+        ArrayList<String> expected= (ArrayList<String>) fileList.clone();\n+        try {\n+           checkArchiveContent(file, expected);\n+        } catch (ArchiveException e) {\n+            fail(\"Problem checking \"+file);\n+        } catch (junit.framework.AssertionFailedError e) { // show error in context\n+            fail(\"Problem checking \" + file + \" \" +e);\n+        }\n+    }\n+}", "timestamp": 1424186393, "metainfo": ""}