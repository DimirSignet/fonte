{"sha": "6eac426de89fe077a181f39452dee6f6ca4c2f52", "log": "Implement uncompressing of BZip2 compressed entries in ZipArchiveInputStream", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStream.java\n \n import org.apache.commons.compress.archivers.ArchiveEntry;\n import org.apache.commons.compress.archivers.ArchiveInputStream;\n+import org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream;\n import org.apache.commons.compress.utils.IOUtils;\n \n import static org.apache.commons.compress.archivers.zip.ZipConstants.DWORD;\n                         current.entry.getGeneralPurposeBit().getSlidingDictionarySize(),\n                         current.entry.getGeneralPurposeBit().getNumberOfShannonFanoTrees(),\n                         new BoundedInputStream(in, current.entry.getCompressedSize()));\n+            } else if (current.entry.getMethod() == ZipMethod.BZIP2.getCode()) {\n+                current.in = new BZip2CompressorInputStream(new BoundedInputStream(in, current.entry.getCompressedSize()));\n             }\n         }\n         \n         } else if (current.entry.getMethod() == ZipArchiveOutputStream.DEFLATED) {\n             read = readDeflated(buffer, offset, length);\n         } else if (current.entry.getMethod() == ZipMethod.UNSHRINKING.getCode()\n-                || current.entry.getMethod() == ZipMethod.IMPLODING.getCode()) {\n+                || current.entry.getMethod() == ZipMethod.IMPLODING.getCode()\n+                || current.entry.getMethod() == ZipMethod.BZIP2.getCode()) {\n             read = current.in.read(buffer, offset, length);\n         } else {\n             throw new UnsupportedZipFeatureException(ZipMethod.getMethodByCode(current.entry.getMethod()),\n--- a/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java\n+++ b/src/test/java/org/apache/commons/compress/archivers/zip/ZipArchiveInputStreamTest.java\n import java.io.BufferedInputStream;\n import java.io.FileInputStream;\n import java.io.InputStream;\n+import java.util.Arrays;\n import java.io.IOException;\n \n import org.apache.commons.compress.utils.IOUtils;\n             in.close();\n         }\n     }\n+\n+    @Test\n+    public void testUnzipBZip2CompressedEntry() throws Exception {\n+        ZipArchiveInputStream in = new ZipArchiveInputStream(new FileInputStream(getFile(\"bzip2-zip.zip\")));\n+        \n+        try {\n+            ZipArchiveEntry ze = in.getNextZipEntry();\n+            assertEquals(42, ze.getSize());\n+            byte[] expected = new byte[42];\n+            Arrays.fill(expected , (byte)'a');\n+            assertArrayEquals(expected, IOUtils.toByteArray(in));\n+        } finally {\n+            in.close();\n+        }\n+    }\n }", "timestamp": 1447218693, "metainfo": ""}