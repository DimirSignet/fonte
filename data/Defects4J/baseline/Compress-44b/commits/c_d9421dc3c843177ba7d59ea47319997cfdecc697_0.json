{"sha": "d9421dc3c843177ba7d59ea47319997cfdecc697", "log": "SnappyInputStream must slide then window when before writing beyond buffer  may be related to COMPRESS-358", "commit": "\n--- a/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/snappy/SnappyCompressorInputStream.java\n      * @return True if the decompressed data should be flushed\n      */\n     private boolean expandLiteral(final int length) throws IOException {\n+        boolean shouldFlush = ensureBufferSpace(length);\n         final int bytesRead = IOUtils.readFully(in, decompressBuf, writeIndex, length);\n         count(bytesRead);\n         if (length != bytesRead) {\n         }\n \n         writeIndex += length;\n-        return writeIndex >= 2 * this.blockSize;\n+        return shouldFlush || writeIndex >= 2 * this.blockSize;\n+    }\n+\n+    private boolean ensureBufferSpace(final int length) {\n+        if (writeIndex + length >= decompressBuf.length) {\n+            slideBuffer();\n+            return true;\n+        }\n+        return false;\n     }\n \n     /**\n             throw new IOException(\"Offset is larger than block size\");\n         }\n         final int offset = (int) off;\n+        boolean shouldFlush = ensureBufferSpace(length);\n \n         if (offset == 1) {\n             final byte lastChar = decompressBuf[writeIndex - 1];\n                 writeIndex += pad;\n             }\n         }\n-        return writeIndex >= 2 * this.blockSize;\n+        return shouldFlush || writeIndex >= 2 * this.blockSize;\n     }\n \n     /**", "timestamp": 1483972045, "metainfo": ""}