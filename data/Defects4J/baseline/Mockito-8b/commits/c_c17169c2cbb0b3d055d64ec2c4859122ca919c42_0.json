{"sha": "c17169c2cbb0b3d055d64ec2c4859122ca919c42", "log": "Merge pull request #32 from alberskib/master  [#467] Fix return value of compareTo for the same objects", "commit": "\n--- a/src/org/mockito/internal/stubbing/defaultanswers/ReturnsEmptyValues.java\n+++ b/src/org/mockito/internal/stubbing/defaultanswers/ReturnsEmptyValues.java\n  *  Returns description of mock for toString() method\n  * </li>\n  * <li>\n- *  Returns non-zero for Comparable#compareTo(T other) method (see issue 184)\n+ *  Returns zero if references are equals otherwise non-zero for Comparable#compareTo(T other) method (see issue 184)\n  * </li>\n  * <li>\n  *  Returns null for everything else\n             }\n         } else if (methodsGuru.isCompareToMethod(invocation.getMethod())) {\n             //see issue 184.\n-            //mocks by default should not return 0 for compareTo because they are not the same. Hence we return 1 (anything but 0 is good).\n+            //mocks by default should return 0 if references are the same, otherwise some other value because they are not the same. Hence we return 1 (anything but 0 is good).\n             //Only for compareTo() method by the Comparable interface\n-            return 1;\n+            return invocation.getMock() == invocation.getArguments()[0] ? 0 : 1;\n         }\n         \n         Class<?> returnType = invocation.getMethod().getReturnType();\n--- a/test/org/mockito/internal/stubbing/defaultanswers/ReturnsEmptyValuesTest.java\n+++ b/test/org/mockito/internal/stubbing/defaultanswers/ReturnsEmptyValuesTest.java\n         assertTrue(result != (Object) 0);\n     }\n \n+    @Test public void should_return_zero_if_mock_is_compared_to_itself() {\n+        //given\n+        Date d = mock(Date.class);\n+        d.compareTo(d);\n+        Invocation compareTo = this.getLastInvocation();\n+\n+        //when\n+        Object result = values.answer(compareTo);\n+\n+        //then\n+        assertEquals(0, result);\n+    }\n+\n }\n--- a/test/org/mockitousage/bugs/ShouldMocksCompareToBeConsistentWithEqualsTest.java\n+++ b/test/org/mockitousage/bugs/ShouldMocksCompareToBeConsistentWithEqualsTest.java\n public class ShouldMocksCompareToBeConsistentWithEqualsTest extends TestBase {\n \n     @Test\n-    public void shouldCompareToBeConsistentWithEquals() {\n+    public void should_compare_to_be_consistent_with_equals() {\n         //given\n         Date today    = mock(Date.class);\n         Date tomorrow = mock(Date.class);\n     }\n \n     @Test\n-    public void shouldAllowStubbingAndVerifyingCompareTo() {\n+    public void should_compare_to_be_consistent_with_equals_when_comparing_the_same_reference() {\n+        //given\n+        Date today    = mock(Date.class);\n+\n+        //when\n+        Set<Date> set = new TreeSet<Date>();\n+        set.add(today);\n+        set.add(today);\n+\n+        //then\n+        assertEquals(1, set.size());\n+    }\n+\n+    @Test\n+    public void should_allow_stubbing_and_verifying_compare_to() {\n         //given\n         Date mock    = mock(Date.class);\n         when(mock.compareTo(any(Date.class))).thenReturn(10);\n     }\n \n     @Test\n-    public void shouldResetNotRemoveDefaultStubbing() {\n+    public void should_reset_not_remove_default_stubbing() {\n         //given\n         Date mock    = mock(Date.class);\n         reset(mock);", "timestamp": 1389215623, "metainfo": ""}