{"sha": "f6d2ec5aef3aef491ba49fa968154c9ff4c4ad22", "log": "made sure state is OK when someone misuses mockito  --HG-- extra : convert_revision : svn%3Aaa2aecf3-ea3e-0410-9d70-716747e7c967/trunk%401035", "commit": "\n--- a/test/org/mockitousage/misuse/InvalidStateDetectionTest.java\n+++ b/test/org/mockitousage/misuse/InvalidStateDetectionTest.java\n  * \n  *    -unfinished stubbing\n  *    -unfinished stubVoid\n+ *    -unfinished doReturn()\n  *    -stubbing without actual method call\n  *    -verify without actual method call\n  *    \n     @Test\n     public void shouldDetectUnfinishedStubbing() {\n         when(mock.simpleMethod());\n-        detects(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n-\n-        when(mock.simpleMethod());\n-        detects(new OnStub(), UnfinishedStubbingException.class);\n-        \n-        when(mock.simpleMethod());\n-        detects(new OnStubVoid(), UnfinishedStubbingException.class);\n-        \n-        when(mock.simpleMethod());\n-        detects(new OnVerify(), UnfinishedStubbingException.class);\n-        \n-        when(mock.simpleMethod());\n-        detects(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n-        \n-        when(mock.simpleMethod());\n-        detects(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n-        \n-        when(mock.simpleMethod());\n-        detects(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n-\n-        when(mock.simpleMethod());\n-        detects(new OnDoAnswer(), UnfinishedStubbingException.class);\n+        detectsAndCleansUp(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n+\n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnStub(), UnfinishedStubbingException.class);\n+        \n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnStubVoid(), UnfinishedStubbingException.class);\n+        \n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnVerify(), UnfinishedStubbingException.class);\n+        \n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n+        \n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n+        \n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n+\n+        when(mock.simpleMethod());\n+        detectsAndCleansUp(new OnDoAnswer(), UnfinishedStubbingException.class);\n     }\n     \n     @Test\n     public void shouldDetectUnfinishedStubbingVoid() {\n         stubVoid(mock);\n-        detects(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnStub(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnStubVoid(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnVerify(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n-        \n-        stubVoid(mock);\n-        detects(new OnDoAnswer(), UnfinishedStubbingException.class);\n+        detectsAndCleansUp(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnStub(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnStubVoid(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnVerify(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n+        \n+        stubVoid(mock);\n+        detectsAndCleansUp(new OnDoAnswer(), UnfinishedStubbingException.class);\n     }\n     \n     @Test\n     public void shouldDetectUnfinishedDoAnswerStubbing() {\n         doAnswer(null);\n-        detects(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnStub(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnStubVoid(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnVerify(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n-        \n-        doAnswer(null);\n-        detects(new OnDoAnswer(), UnfinishedStubbingException.class);\n+        detectsAndCleansUp(new OnMethodCallOnMock(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnStub(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnStubVoid(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnVerify(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnVerifyInOrder(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnVerifyZeroInteractions(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnVerifyNoMoreInteractions(), UnfinishedStubbingException.class);\n+        \n+        doAnswer(null);\n+        detectsAndCleansUp(new OnDoAnswer(), UnfinishedStubbingException.class);\n     }\n     \n     @Test\n     public void shouldDetectUnfinishedVerification() {\n         verify(mock);\n-        detects(new OnStub(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnStubVoid(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnVerify(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnVerifyInOrder(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnVerifyZeroInteractions(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnVerifyNoMoreInteractions(), UnfinishedVerificationException.class);\n-        \n-        verify(mock);\n-        detects(new OnDoAnswer(), UnfinishedVerificationException.class);\n+        detectsAndCleansUp(new OnStub(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnStubVoid(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnVerify(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnVerifyInOrder(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnVerifyZeroInteractions(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnVerifyNoMoreInteractions(), UnfinishedVerificationException.class);\n+        \n+        verify(mock);\n+        detectsAndCleansUp(new OnDoAnswer(), UnfinishedVerificationException.class);\n     }\n     \n     @Test\n         }\n     }\n     \n-    private void detects(DetectsInvalidState detector, Class expected) {\n+    private void detectsAndCleansUp(DetectsInvalidState detector, Class expected) {\n         try {\n             detector.detect(mock);\n             fail(\"Should throw an exception\");\n         } catch (Exception e) {\n             assertEquals(expected, e.getClass());\n         }\n+        //Make sure state is OK\n+        StateMaster.validate();\n     }\n }", "timestamp": 1225057005, "metainfo": ""}