{"sha": "014ec7bebe9cb2ef80ee7346053f854faf5fc41e", "log": "issue 304 : initialize captors before each methods  --HG-- branch : issue 304 : TestNG integration", "commit": "\n--- a/src/org/mockito/internal/util/reflection/Fields.java\n+++ b/src/org/mockito/internal/util/reflection/Fields.java\n             this.instanceFields = instanceFields;\n         }\n \n-        // TODO get Filter out of ListFilter\n         public InstanceFields filter(Filter<InstanceField> withFilter) {\n             return new InstanceFields(instance, ListUtil.filter(instanceFields, withFilter));\n         }\n--- a/subprojects/testng/src/main/java/org/mockito/testng/MockitoBeforeTestNGMethod.java\n+++ b/subprojects/testng/src/main/java/org/mockito/testng/MockitoBeforeTestNGMethod.java\n package org.mockito.testng;\n \n+import org.mockito.Captor;\n import org.mockito.MockitoAnnotations;\n+import org.mockito.internal.configuration.CaptorAnnotationProcessor;\n+import org.mockito.internal.util.reflection.Fields;\n+import org.mockito.internal.util.reflection.InstanceField;\n import org.testng.IInvokedMethod;\n import org.testng.ITestResult;\n \n+import java.util.List;\n import java.util.WeakHashMap;\n+\n+import static org.mockito.internal.util.reflection.Fields.notAnnotatedBy;\n \n public class MockitoBeforeTestNGMethod {\n \n     }\n \n     private void initializeCaptors(Object instance) {\n-        /*\n-         * TODO Refactor #processAnnotationOn methods out of DefaultAnnotationEngine\n-         */\n+        List<InstanceField> instanceFields = Fields.allFieldsInHierarchy(instance).filter(notAnnotatedBy(Captor.class)).instanceFields();\n+        for (InstanceField instanceField : instanceFields) {\n+            new CaptorAnnotationProcessor().process(instanceField.annotation(Captor.class), instanceField.jdkField());\n+        }\n     }\n \n     private void markAsInitialized(Object instance) {", "timestamp": 1331516593, "metainfo": ""}