{"sha": "7868342609aa725794652dfe04d696de1ba7545d", "log": "Issue 335 fix: EqualsWithDelta not null safe I added null checks in EqualsWithDelta class corresponding to: If wanted is null and actual is not, return false. If actual is null and wanted is not, return false. If wanted and actual are null, return true", "commit": "\n--- a/src/org/mockito/internal/matchers/EqualsWithDelta.java\n+++ b/src/org/mockito/internal/matchers/EqualsWithDelta.java\n \n     public boolean matches(Object actual) {\n         Number actualNumber = (Number) actual;\n+        if (wanted == null ^ actual == null) {\n+            return false;\n+        }\n+\n+        if (wanted == null && actual == null) {\n+            return true;\n+        }\n+\n         return wanted.doubleValue() - delta.doubleValue() <= actualNumber.doubleValue()\n                 && actualNumber.doubleValue() <= wanted.doubleValue()\n                         + delta.doubleValue();\n--- /dev/null\n+++ b/test/org/mockitousage/bugs/EqualsWithDeltaTest.java\n+package org.mockitousage.bugs;\n+\n+import org.hamcrest.Matcher;\n+import org.junit.Test;\n+import org.mockito.internal.matchers.EqualsWithDelta;\n+\n+import static org.fest.assertions.Assertions.assertThat;\n+\n+public class EqualsWithDeltaTest {\n+\n+\t@Test\n+\tpublic void testEqualsWithDelta_NullExpected() throws Exception {\n+\t\tMatcher<Number> matcher = equalsWithDelta(null);\n+\t\tassertThat(matcher.matches(1.0)).isFalse();\n+\t}\n+\n+\t@Test\n+\tpublic void testEqualsWithDelta_NullActual() throws Exception {\n+\t\tMatcher<Number> matcher = equalsWithDelta(1.0);\n+\t\tassertThat(matcher.matches(null)).isFalse();\n+\t}\n+\n+    @Test\n+    public void testEqualsWithDelta_NullActualAndExpected() throws Exception {\n+        Matcher<Number> matcher = equalsWithDelta(null);\n+        assertThat(matcher.matches(null)).isTrue();\n+    }\n+\n+\tpublic Matcher<Number> equalsWithDelta(final Double expected) {\n+\t\treturn new EqualsWithDelta(expected, .000001);\n+\t}\n+}", "timestamp": 1342855598, "metainfo": ""}