{"sha": "5672ed90dd8b29319a7ac2efd9acfe49a5027651", "log": "Made reset validate the state as well  --HG-- extra : convert_revision : svn%3Aaa2aecf3-ea3e-0410-9d70-716747e7c967/trunk%401328", "commit": "\n--- a/src/org/mockito/internal/MockitoCore.java\n+++ b/src/org/mockito/internal/MockitoCore.java\n     }\n     \n     public <T> void reset(T ... mocks) {\n-        //TODO Perhaps we should validate the state instead of resetting?\n+        MOCKING_PROGRESS.validateState();\n         MOCKING_PROGRESS.reset();\n         MOCKING_PROGRESS.resetOngoingStubbing();\n         //TODO Perhaps we should maintain previous ReturnValues?\n--- a/test/org/mockitousage/reset/ResetTest.java\n+++ b/test/org/mockitousage/reset/ResetTest.java\n import static org.mockito.Matchers.*;\n import static org.mockito.Mockito.*;\n \n+import org.junit.Before;\n import org.junit.Test;\n import org.mockito.Mock;\n import org.mockito.exceptions.misusing.MissingMethodInvocationException;\n+import org.mockito.exceptions.misusing.UnfinishedVerificationException;\n import org.mockitousage.IMethods;\n import org.mockitoutil.TestBase;\n \n \n     @Mock private IMethods mock;\n     @Mock private IMethods mockTwo;\n-\n-    @Test\n-    public void shouldClearArgumentMatcherStackSoAbuseOfArgumentMatchersIsNotDetectedAfterReset() {\n-        anyInt(); // abuse of matcher\n-        reset(mock);\n-        mock(IMethods.class);\n-    }\n-\n-    @Test\n-    public void shouldNotThrowUnfinishedVerificationAfterReset() throws Exception {\n-        verify(mock); // unfinished verification\n-        reset(mock);\n-        mock(IMethods.class);\n+    \n+    @Before\n+    public void makeStackTracesClean() {\n+        super.makeStackTracesClean();\n     }\n \n     @Test\n         reset(mock, mockTwo);\n         verifyNoMoreInteractions(mock, mockTwo);\n     }\n+    \n+    @Test\n+    public void shouldValidateStateWhenResetting() {\n+        //invalid verify:\n+        verify(mock);\n+        \n+        try {\n+            reset(mockTwo);\n+            fail();\n+        } catch (UnfinishedVerificationException e) {}\n+    }\n }\n--- a/test/org/mockitoutil/TestBase.java\n+++ b/test/org/mockitoutil/TestBase.java\n     public void cleanUpConfigInAnyCase() {\n         ConfigurationAccess.getConfig().overrideCleansStackTrace(false);\n         ConfigurationAccess.getConfig().overrideReturnValues(null);\n+    }\n+\n+    public void makeStackTracesClean() {\n+        ConfigurationAccess.getConfig().overrideCleansStackTrace(true);\n     }\n     \n     @Before", "timestamp": 1239807793, "metainfo": ""}