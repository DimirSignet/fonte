{"sha": "ec4c1998400d6072d0293049b78df459c7921ec4", "log": "Made unfinished stubbing clickable & localizable  --HG-- extra : convert_revision : svn%3Aaa2aecf3-ea3e-0410-9d70-716747e7c967/trunk%401301", "commit": "\n--- a/src/org/mockito/exceptions/Reporter.java\n+++ b/src/org/mockito/exceptions/Reporter.java\n \n     }\n     \n-    public void unfinishedStubbing() {\n+    public void unfinishedStubbing(Location location) {\n         throw new UnfinishedStubbingException(join(\n-                \"Unfinished stubbing detected!\",\n+                \"Unfinished stubbing detected here:\",\n+                \"-> at \" + location,\n+                \"\",\n                 \"E.g. thenReturn() may be missing.\",\n                 \"Examples of correct stubbing:\",\n                 \"    when(mock.isOk()).thenReturn(true);\",\n                 \"    doThrow(exception).when(mock).someVoidMethod();\",\n                 \"Hints:\",\n                 \" 1. missing thenReturn() or mock call inside when()\",\n-                \" 2. stubbed method cannot be final.\",\n-                \" 3. although stubbed methods may return mocks, you cannot inline a mock() call inside a thenReturn method (see issue 53)\"\n+                \" 2. although stubbed methods may return mocks, you cannot inline a mock() call inside a thenReturn method (see issue 53)\",\n+                \"\"\n         ));\n     }\n \n--- a/src/org/mockito/internal/progress/MockingProgressImpl.java\n+++ b/src/org/mockito/internal/progress/MockingProgressImpl.java\n \n     OngoingStubbing ongoingStubbing;\n     private Localized<VerificationMode> verificationMode;\n-    private boolean stubbingInProgress = false;\n+    private Location stubbingInProgress = null;\n \n     public void reportOngoingStubbing(OngoingStubbing ongoingStubbing) {\n         this.ongoingStubbing = ongoingStubbing;\n \n     public void stubbingStarted() {\n         validateState();\n-        stubbingInProgress = true;\n+        stubbingInProgress = new Location();\n     }\n \n     public void validateState() {\n             reporter.unfinishedVerificationException(location);\n         }\n         \n-        if (stubbingInProgress) {\n-            stubbingInProgress = false;\n-            reporter.unfinishedStubbing();\n+        if (stubbingInProgress != null) {\n+            Location temp = stubbingInProgress;\n+            stubbingInProgress = null;\n+            reporter.unfinishedStubbing(temp);\n         }\n       \n         getArgumentMatcherStorage().validateState();\n \n     public void stubbingCompleted(Invocation invocation) {\n         debuggingInfo.addStubbedInvocation(invocation);        \n-        stubbingInProgress = false;\n+        stubbingInProgress = null;\n     }\n     \n     public String toString() {\n     }\n \n     public void reset() {\n-        stubbingInProgress = false;\n+        stubbingInProgress = null;\n         verificationMode = null;\n         getArgumentMatcherStorage().reset();\n     }\n--- a/test/org/mockitousage/stacktrace/ClickableStackTracesWhenFrameworkMisusedTest.java\n+++ b/test/org/mockitousage/stacktrace/ClickableStackTracesWhenFrameworkMisusedTest.java\n import static org.mockito.Mockito.*;\n \n import org.junit.After;\n-import org.junit.Ignore;\n import org.junit.Test;\n import org.mockito.Mock;\n import org.mockito.StateMaster;\n         when(mock.simpleMethod());\n     }\n     \n-    //TODO\n-    @Ignore\n     @Test\n     public void shouldPointOutUnfinishedStubbing() {\n         unfinishedStubbingHere();", "timestamp": 1238970606, "metainfo": ""}