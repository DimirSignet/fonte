{"sha": "0b421ea5ff39f05c755fc3a49d5c614bf878f01e", "log": "fixed issue 76 atMost(x) didn't play well with verifyNoMoreInteractions()  --HG-- extra : convert_revision : svn%3Aaa2aecf3-ea3e-0410-9d70-716747e7c967/trunk%401353", "commit": "\n--- a/src/org/mockito/internal/verification/AtMost.java\n+++ b/src/org/mockito/internal/verification/AtMost.java\n         if (foundSize > maxNumberOfInvocations) {\n             new Reporter().wantedAtMostX(maxNumberOfInvocations, foundSize);\n         }\n+        \n+        for (Invocation i : found) {\n+            i.markVerified();\n+        }\n     }\n }\n--- a/test/org/mockitousage/verification/AtMostXVerificationTest.java\n+++ b/test/org/mockitousage/verification/AtMostXVerificationTest.java\n import org.mockito.Mock;\n import org.mockito.exceptions.base.MockitoAssertionError;\n import org.mockito.exceptions.base.MockitoException;\n+import org.mockito.exceptions.verification.NoInteractionsWanted;\n import org.mockitoutil.TestBase;\n \n @SuppressWarnings(\"unchecked\")\n         }\n     }\n \n-    //TODO\n-//    @Test\n-//    public void shouldMarkInteractionsAsVerified() throws Exception {\n-//        mock.clear();\n-//        mock.clear();\n-//        \n-//        verify(mock, atMost(3)).clear();\n-//        verifyNoMoreInteractions(mock);\n-//    }\n-//\n-//    @Test\n-//    public void shouldDetectUnverifiedInMarkInteractionsAsVerified() throws Exception {\n-//        mock.clear();\n-//        mock.clear();\n-//        mock.add(120);\n-//        \n-//        verify(mock, atMost(3)).clear();\n-//        try {\n-//            verifyNoMoreInteractions(mock);\n-//            fail();\n-//        } catch(NoInteractionsWanted e) {\n-//            assertContains(\"add(120)\", e.getMessage());\n-//        }\n-//    }\n+    @Test\n+    public void shouldMarkInteractionsAsVerified() throws Exception {\n+        mock.clear();\n+        mock.clear();\n+        \n+        verify(mock, atMost(3)).clear();\n+        verifyNoMoreInteractions(mock);\n+    }\n+\n+    @Test\n+    public void shouldDetectUnverifiedInMarkInteractionsAsVerified() throws Exception {\n+        mock.clear();\n+        mock.clear();\n+        undesiredInteraction();\n+        \n+        verify(mock, atMost(3)).clear();\n+        try {\n+            verifyNoMoreInteractions(mock);\n+            fail();\n+        } catch(NoInteractionsWanted e) {\n+            assertContains(\"undesiredInteraction(\", e.getMessage());\n+        }\n+    }\n+\n+    private void undesiredInteraction() {\n+        mock.add(\"\");\n+    }\n }", "timestamp": 1240255969, "metainfo": ""}