{"sha": "a71ecd65ffe6de5f1ac44de78c2b6c36f8a47d6f", "log": "Further refactoring of exception messages - following the new patterns of storing and presenting locations of errors / verification failures  --HG-- extra : convert_revision : svn%3Aaa2aecf3-ea3e-0410-9d70-716747e7c967/trunk%401296", "commit": "\n--- a/src/org/mockito/exceptions/Reporter.java\n+++ b/src/org/mockito/exceptions/Reporter.java\n import org.mockito.exceptions.verification.ArgumentsAreDifferent;\n import org.mockito.exceptions.verification.NeverWantedButInvoked;\n import org.mockito.exceptions.verification.NoInteractionsWanted;\n+import org.mockito.exceptions.verification.SmartNullPointerException;\n import org.mockito.exceptions.verification.TooLittleActualInvocations;\n import org.mockito.exceptions.verification.TooManyActualInvocations;\n import org.mockito.exceptions.verification.VerifcationInOrderFailure;\n                 \"\"\n                 ));\n     }\n+\n+    public void smartNullPointerException(Location location) {\n+        throw new SmartNullPointerException(join(\n+                \"\\nYou have a NullPointerException here:\",\n+                \"-> at \" + new Location(),\n+                \"\\nBecause this method was *not* stubbed correctly:\",\n+                \"-> at \" + location\n+                ));\n+    }\n }\n--- a/src/org/mockito/exceptions/verification/SmartNullPointerException.java\n+++ b/src/org/mockito/exceptions/verification/SmartNullPointerException.java\n \n     private static final long serialVersionUID = 1L;\n \n-    public SmartNullPointerException(String message, Throwable t) {\n-        super(message, t);\n-    }\n-\n     public SmartNullPointerException(String message) {\n         super(message);\n     }\n--- a/src/org/mockito/internal/returnvalues/SmartNullReturnValues.java\n+++ b/src/org/mockito/internal/returnvalues/SmartNullReturnValues.java\n \n import org.mockito.Mockito;\n import org.mockito.ReturnValues;\n-import org.mockito.exceptions.cause.BecauseThisMethodWasNotStubbed;\n-import org.mockito.exceptions.verification.SmartNullPointerException;\n+import org.mockito.exceptions.Reporter;\n import org.mockito.internal.creation.jmock.ClassImposterizer;\n+import org.mockito.internal.debugging.Location;\n import org.mockito.internal.invocation.Invocation;\n import org.mockito.invocation.InvocationOnMock;\n \n \n     private final class ThrowingInterceptor implements MethodInterceptor {\n         private final InvocationOnMock invocation;\n-        private final Exception whenCreated = new BecauseThisMethodWasNotStubbed(\"\\nBecause this method was not stubbed correctly:\");\n+        private final Location location = new Location();\n \n         private ThrowingInterceptor(InvocationOnMock invocation) {\n             this.invocation = invocation;\n             if (Invocation.isToString(method)) {\n                 return \"SmartNull returned by unstubbed \" + invocation.getMethod().getName() + \"() method on mock\";\n             }\n-            throw new SmartNullPointerException(\"\\nYou have a NullPointerException here:\", whenCreated);\n+            \n+            new Reporter().smartNullPointerException(location);\n+            return null;\n         }\n     }\n \n--- a/test/org/mockitousage/stubbing/SmartNullsStubbingTest.java\n+++ b/test/org/mockitousage/stubbing/SmartNullsStubbingTest.java\n package org.mockitousage.stubbing;\n \n import static org.mockito.Mockito.*;\n-import static org.mockitoutil.ExtraMatchers.*;\n \n import org.junit.Before;\n import org.junit.Test;\n             methods.simpleMethod();\n             fail();\n         } catch (SmartNullPointerException e) {\n-            assertThat(e.getCause(),  hasMethodInStackTraceAt(0, \"unstubbedMethodInvokedHere\"));\n+            assertContains(\"unstubbedMethodInvokedHere(\", e.getMessage());\n         }\n     }\n ", "timestamp": 1238770289, "metainfo": ""}