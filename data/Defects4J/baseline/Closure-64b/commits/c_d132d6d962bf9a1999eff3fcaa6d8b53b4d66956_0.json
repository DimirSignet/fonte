{"sha": "d132d6d962bf9a1999eff3fcaa6d8b53b4d66956", "log": "Introduce a ECMASCRIPT5_STRICT language mode.  Run strict mode tests when in that mode.  R=acleung DELTA=47  (42 added, 1 deleted, 4 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=800   ", "commit": "\n--- a/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java\n+++ b/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java\n     }\n \n     if (config.languageIn.length() > 0) {\n-      if (config.languageIn.equals(\"ECMASCRIPT5\") ||\n+      if (config.languageIn.equals(\"ECMASCRIPT5_STRICT\") ||\n+          config.languageIn.equals(\"ES5_STRICT\")) {\n+        options.languageIn = CompilerOptions.LanguageMode.ECMASCRIPT5;\n+      } else if (config.languageIn.equals(\"ECMASCRIPT5\") ||\n           config.languageIn.equals(\"ES5\")) {\n         options.languageIn = CompilerOptions.LanguageMode.ECMASCRIPT5;\n       } else if (config.languageIn.equals(\"ECMASCRIPT3\") ||\n--- a/src/com/google/javascript/jscomp/CommandLineRunner.java\n+++ b/src/com/google/javascript/jscomp/CommandLineRunner.java\n \n     @Option(name = \"--language_in\",\n         usage = \"Sets what language spec that input sources conform. \"\n-        + \"Options: ECMASCRIPT3 (default), ECMASCRIPT5\")\n+        + \"Options: ECMASCRIPT3 (default), ECMASCRIPT5, ECMASCRIPT5_STRICT\")\n     private String language_in = \"ECMASCRIPT3\";\n \n     @Option(name = \"--version\",\n--- a/src/com/google/javascript/jscomp/Compiler.java\n+++ b/src/com/google/javascript/jscomp/Compiler.java\n     return options.languageIn == LanguageMode.ECMASCRIPT5;\n   }\n \n+  public LanguageMode LanguageMode() {\n+    return options.languageIn;\n+  }\n+\n   @Override\n   public boolean acceptConstKeyword() {\n     return options.acceptConstKeyword;\n         case ECMASCRIPT5:\n           mode = Config.LanguageMode.ECMASCRIPT5;\n           break;\n+        case ECMASCRIPT5_STRICT:\n+          mode = Config.LanguageMode.ECMASCRIPT5_STRICT;\n+          break;\n         default:\n           throw new IllegalStateException(\"unexpected language mode\");\n       }\n--- a/src/com/google/javascript/jscomp/CompilerOptions.java\n+++ b/src/com/google/javascript/jscomp/CompilerOptions.java\n      * Shiny new JavaScript\n      */\n     ECMASCRIPT5,\n+\n+    /**\n+     * Nitpicky, shiny new JavaScript\n+     */\n+    ECMASCRIPT5_STRICT,\n   }\n \n   /** When to do the extra sanity checks */\n--- a/src/com/google/javascript/jscomp/DefaultPassConfig.java\n+++ b/src/com/google/javascript/jscomp/DefaultPassConfig.java\n import com.google.common.collect.Sets;\n import com.google.common.io.Files;\n import com.google.javascript.jscomp.AbstractCompiler.LifeCycleStage;\n+import com.google.javascript.jscomp.CompilerOptions.LanguageMode;\n import com.google.javascript.jscomp.NodeTraversal.Callback;\n import com.google.javascript.rhino.Node;\n import com.google.javascript.rhino.Token;\n       checks.add(checkSuspiciousProperties);\n     }\n \n-    if (options.checkCaja || options.checkEs5Strict) {\n+    if (options.languageIn == LanguageMode.ECMASCRIPT5_STRICT\n+        || options.checkCaja\n+        || options.checkEs5Strict) {\n       checks.add(checkStrictMode);\n     }\n ", "timestamp": 1299604841, "metainfo": ""}