{"sha": "e0559c503f65641b9546c37e7c84c866caf37e66", "log": "Period formatter builder append(PeriodFormatter) did not handle some case [2495455] test from Bjoern Ricks  ", "commit": "\n--- a/JodaTime/src/main/java/org/joda/time/format/PeriodFormatterBuilder.java\n+++ b/JodaTime/src/main/java/org/joda/time/format/PeriodFormatterBuilder.java\n         int size = elementPairs.size();\n         if (size >= 2 && elementPairs.get(0) instanceof Separator) {\n             Separator sep = (Separator) elementPairs.get(0);\n-            PeriodFormatter f = toFormatter(elementPairs.subList(2, size), notPrinter, notParser);\n-            sep = sep.finish(f.getPrinter(), f.getParser());\n-            return new PeriodFormatter(sep, sep);\n+            if (sep.iAfterParser == null && sep.iAfterPrinter == null) {\n+                PeriodFormatter f = toFormatter(elementPairs.subList(2, size), notPrinter, notParser);\n+                sep = sep.finish(f.getPrinter(), f.getParser());\n+                return new PeriodFormatter(sep, sep);\n+            }\n         }\n         Object[] comp = createComposite(elementPairs);\n         if (notPrinter) {\n--- a/JodaTime/src/test/java/org/joda/time/format/TestPeriodFormatterBuilder.java\n+++ b/JodaTime/src/test/java/org/joda/time/format/TestPeriodFormatterBuilder.java\n         assertNotNull(bld.toParser());\n     }\n \n+    public void testBug2495455() {\n+        PeriodFormatter pfmt1 = new PeriodFormatterBuilder()\n+            .appendLiteral(\"P\")\n+            .appendYears()\n+            .appendSuffix(\"Y\")\n+            .appendMonths()\n+            .appendSuffix(\"M\")\n+            .appendWeeks()\n+            .appendSuffix(\"W\")\n+            .appendDays()\n+            .appendSuffix(\"D\")\n+            .appendSeparatorIfFieldsAfter(\"T\")\n+            .appendHours()\n+            .appendSuffix(\"H\")\n+            .appendMinutes()\n+            .appendSuffix(\"M\")\n+            .appendSecondsWithOptionalMillis()\n+            .appendSuffix(\"S\")\n+            .toFormatter();\n+        PeriodFormatter pfmt2 = new PeriodFormatterBuilder()\n+            .append(ISOPeriodFormat.standard())\n+            .toFormatter();\n+        pfmt1.parsePeriod(\"PT1003199059S\");\n+        pfmt2.parsePeriod(\"PT1003199059S\");\n+    }\n+\n }", "timestamp": 1288221342, "metainfo": ""}