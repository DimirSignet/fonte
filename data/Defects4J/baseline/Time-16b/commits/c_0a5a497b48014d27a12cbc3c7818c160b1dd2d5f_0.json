{"sha": "0a5a497b48014d27a12cbc3c7818c160b1dd2d5f", "log": "Cache result of hash code to enhance performance, issue reported by Jeffrey Green  ", "commit": "\n--- a/JodaTime/src/java/org/joda/time/LocalDate.java\n+++ b/JodaTime/src/java/org/joda/time/LocalDate.java\n \n     /** The local millis from 1970-01-01T00:00:00 */\n     private long iLocalMillis;\n-    /** The chronology to use in UTC */\n+    /** The chronology to use in UTC. */\n     private Chronology iChronology;\n+    /** The cached hash code. */\n+    private transient volatile int iHash;\n \n     //-----------------------------------------------------------------------\n     /**\n             }\n         }\n         return super.equals(partial);\n+    }\n+\n+    /**\n+     * Gets a hash code for the instant as defined in <code>ReadablePartial</code>.\n+     *\n+     * @return a suitable hash code\n+     */\n+    public int hashCode() {\n+        // override for performance\n+        int hash = iHash;\n+        if (hash == 0) {\n+            hash = iHash = super.hashCode();\n+        }\n+        return hash;\n     }\n \n     /**\n--- a/JodaTime/src/test/org/joda/time/TestLocalDate_Basics.java\n+++ b/JodaTime/src/test/org/joda/time/TestLocalDate_Basics.java\n         assertEquals(true, test2.hashCode() == test2.hashCode());\n     }\n \n+    public void testEqualsHashCodeAPI() {\n+        LocalDate test = new LocalDate(1970, 6, 9, COPTIC_PARIS);\n+        int expected = 157;\n+        expected = 23 * expected + 1970;\n+        expected = 23 * expected + COPTIC_UTC.year().getType().hashCode();\n+        expected = 23 * expected + 6;\n+        expected = 23 * expected + COPTIC_UTC.monthOfYear().getType().hashCode();\n+        expected = 23 * expected + 9;\n+        expected = 23 * expected + COPTIC_UTC.dayOfMonth().getType().hashCode();\n+        expected += COPTIC_UTC.hashCode();\n+        assertEquals(expected, test.hashCode());\n+    }\n+\n     //-----------------------------------------------------------------------\n     public void testCompareTo() {\n         LocalDate test1 = new LocalDate(2005, 6, 2);", "timestamp": 1259620981, "metainfo": ""}