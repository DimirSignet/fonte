{"sha": "9059501876ce6aa36e4e6d429556c3e88cd50d4e", "log": "PR: 36597 Submitted by: Hiroki Ata <hiroki.ata -at- mail.com>  underlaying inputStream wasnt correctly closed.  Thanks for the patch!    ", "commit": "\n--- a/src/java/org/apache/commons/compress/bzip2/CBZip2InputStream.java\n+++ b/src/java/org/apache/commons/compress/bzip2/CBZip2InputStream.java\n \n     private void bsFinishedWithStream()\n     {\n+        if (m_input != null)\n+        {\n+            try\n+            {\n+                m_input.close();\n+            }\n+            catch ( IOException e )\n+            {\n+            }\n+        }\n         m_input = null;\n     }\n \n     \n     public void close() throws IOException \n     {\n-        m_input.close();\n+\tbsFinishedWithStream();\n     }\n }\n--- a/src/test/org/apache/commons/compress/bzip2/test/BzipTestCase.java\n+++ b/src/test/org/apache/commons/compress/bzip2/test/BzipTestCase.java\n         forceDelete( outputFile );\n     }\n \n+    public void testCBZip2InputStreamClose()\n+        throws Exception\n+    {\n+        final InputStream input = getInputStream( \"asf-logo-huge.tar.bz2\" );\n+        final File outputFile = getOutputFile( \".tar.bz2\" );\n+        final OutputStream output = new FileOutputStream( outputFile );\n+        copy( input, output );\n+        shutdownStream( input );\n+        shutdownStream( output );\n+        assertTrue( \"Check output file exists.\" , outputFile.exists() );\n+        final InputStream input2 = new FileInputStream( outputFile );\n+        final InputStream packedInput = getPackedInput( input2 );\n+        shutdownStream( packedInput );\n+        try\n+        {\n+            input2.read();\n+            assertTrue(\"Source input stream is still opened.\", false);\n+        } catch ( Exception e )\n+        {\n+            // Read closed stream.\n+        }\n+        forceDelete( outputFile );\n+    }\n+\n     /**\n      * Copy bytes from an <code>InputStream</code> to an <code>OutputStream</code>.\n      */", "timestamp": 1126447285, "metainfo": ""}