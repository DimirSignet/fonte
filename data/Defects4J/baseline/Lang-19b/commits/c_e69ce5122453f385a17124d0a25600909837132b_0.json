{"sha": "e69ce5122453f385a17124d0a25600909837132b", "log": "Implementing an option to UnicodeUnescaper in which the syntax '\\u+0047' is supported. By default it remains unsupported to match Java's method of parsing. Request in LANG-507  ", "commit": "\n--- a/src/java/org/apache/commons/lang/text/translate/UnicodeUnescaper.java\n+++ b/src/java/org/apache/commons/lang/text/translate/UnicodeUnescaper.java\n  */\n public class UnicodeUnescaper extends CharSequenceTranslator {\n \n+    private boolean escapingPlus = false;\n+\n+    public void setEscapingPlus(boolean b) {\n+        this.escapingPlus = b;\n+    }\n+    public boolean isEscapingPlus() {\n+        return this.escapingPlus;\n+    }\n+\n     /**\n      * {@inheritDoc}\n      */\n                     i++;\n                 }\n \n+                // consume + symbol in \\\\u+0045\n+                if(isEscapingPlus()) {\n+                    if( (index + i < input.length()) && (input.charAt(index + i) == '+') ) {\n+                        i++;\n+                    }\n+                }\n+\n                 if( (index + i + 4 <= input.length()) ) {\n                     // Get 4 hex digits\n                     CharSequence unicode = input.subSequence(index + i, index + i + 4);\n                         int value = Integer.parseInt(unicode.toString(), 16);\n                         out.write((char) value);\n                     } catch (NumberFormatException nfe) {\n-                        throw new RuntimeException(\"Unable to parse unicode value: \" + unicode, nfe);\n+                        throw new IllegalArgumentException(\"Unable to parse unicode value: \" + unicode, nfe);\n                     }\n                     return i + 4;\n                 } else {\n--- a/src/test/org/apache/commons/lang/text/translate/UnicodeUnescaperTest.java\n+++ b/src/test/org/apache/commons/lang/text/translate/UnicodeUnescaperTest.java\n  */\n public class UnicodeUnescaperTest extends TestCase {\n \n+    // Requested in LANG-507\n+    public void testUPlus() throws IOException {\n+        UnicodeUnescaper uu = new UnicodeUnescaper();\n+\n+        String input = \"\\\\u+0047\";\n+        try {\n+            String result = uu.translate(input);\n+            fail(\"Default behaviour should not parse u+\");\n+        } catch(IllegalArgumentException iae) {\n+            // expected\n+        }\n+\n+        uu.setEscapingPlus(true);\n+        assertEquals(\"Failed to unescape unicode characters with 'u+' notation\", \"G\", uu.translate(input));\n+    }\n+\n     public void testUuuuu() throws IOException {\n         UnicodeUnescaper uu = new UnicodeUnescaper();\n ", "timestamp": 1255850759, "metainfo": ""}