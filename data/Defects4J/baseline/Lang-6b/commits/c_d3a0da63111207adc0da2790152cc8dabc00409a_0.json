{"sha": "d3a0da63111207adc0da2790152cc8dabc00409a", "log": "Fix replaceChars() to complete bug 25454   ", "commit": "\n--- a/src/java/org/apache/commons/lang/StringUtils.java\n+++ b/src/java/org/apache/commons/lang/StringUtils.java\n  * @author Al Chou\n  * @author Michael Davey\n  * @since 1.0\n- * @version $Id: StringUtils.java,v 1.128 2004/02/24 22:31:42 fredrik Exp $\n+ * @version $Id: StringUtils.java,v 1.129 2004/03/10 23:54:48 scolebourne Exp $\n  */\n public class StringUtils {\n     // Performance testing notes (JDK 1.4, Jul03, scolebourne)\n         if (replaceChars == null) {\n             replaceChars = \"\";\n         }\n-        StringBuffer buffer = new StringBuffer(str.length());\n+        boolean modified = false;\n+        StringBuffer buf = new StringBuffer(str.length());\n         for (int i = 0; i < str.length(); i++) {\n             char ch = str.charAt(i);\n             int index = searchChars.indexOf(ch);\n             if (index >= 0) {\n+                modified = true;\n                 if (index < replaceChars.length()) {\n-                    buffer.append(replaceChars.charAt(index));\n+                    buf.append(replaceChars.charAt(index));\n                 }\n             } else {\n-                buffer.append(ch);\n-            }\n-        }\n-        return buffer.toString();\n+                buf.append(ch);\n+            }\n+        }\n+        if (modified) {\n+            return buf.toString();\n+        } else {\n+            return str;\n+        }\n     }\n \n     // Overlay\n--- a/src/test/org/apache/commons/lang/StringUtilsTest.java\n+++ b/src/test/org/apache/commons/lang/StringUtilsTest.java\n  * @author Phil Steitz\n  * @author Gary D. Gregory\n  * @author Al Chou\n- * @version $Id: StringUtilsTest.java,v 1.58 2004/02/18 23:06:19 ggregory Exp $\n+ * @version $Id: StringUtilsTest.java,v 1.59 2004/03/10 23:54:48 scolebourne Exp $\n  */\n public class StringUtilsTest extends TestCase {\n     \n         assertEquals(\"ayzya\", StringUtils.replaceChars(\"abcba\", \"bc\", \"yzx\"));\n         \n         assertEquals(\"abcba\", StringUtils.replaceChars(\"abcba\", \"z\", \"w\"));\n-        // Comment out for now, delete later when discussion completes [Gary Gregory, Dec 14 2003]\n-        //assertSame(\"abcba\", StringUtils.replaceChars(\"abcba\", \"z\", \"w\"));\n+        assertSame(\"abcba\", StringUtils.replaceChars(\"abcba\", \"z\", \"w\"));\n         \n         // Javadoc examples:\n         assertEquals(\"jelly\", StringUtils.replaceChars(\"hello\", \"ho\", \"jy\"));\n         \n         // From http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25454\n         assertEquals(\"bcc\", StringUtils.replaceChars(\"abc\", \"ab\", \"bc\"));\n-        assertEquals(\"q651.506bera\", StringUtils.replaceChars(\"d216.102oren\", \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789\",\n-                \"nopqrstuvwxyzabcdefghijklmNOPQRSTUVWXYZABCDEFGHIJKLM567891234\"));\n+        assertEquals(\"q651.506bera\", StringUtils.replaceChars(\"d216.102oren\",\n+            \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789\",\n+            \"nopqrstuvwxyzabcdefghijklmNOPQRSTUVWXYZABCDEFGHIJKLM567891234\"));\n     }\n     \n     public void testOverlayString_StringStringIntInt() {", "timestamp": 1078962888, "metainfo": ""}