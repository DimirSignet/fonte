{"sha": "d9bd84f4fcda64628ffd908647cf09a986995163", "log": "Turn Unicode extra field handling into an enum since there are more than two options.  SANDBOX-176  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n     /**\n      * whether to create UnicodePathExtraField-s for each entry.\n      */\n-    private boolean createUnicodeExtraFields = false;\n+    private UnicodeExtraFieldPolicy createUnicodeExtraFields =\n+        UnicodeExtraFieldPolicy.NEVER;\n \n     /**\n      * Creates a new ZIP OutputStream filtering the underlying stream.\n     }\n \n     /**\n-     * Whether to create Unicode Extra Fields for all entries.\n-     *\n-     * <p>Defaults to false.</p>\n-     */\n-    public void setCreateUnicodeExtraFields(boolean b) {\n+     * Whether to create Unicode Extra Fields.\n+     *\n+     * <p>Defaults to NEVER.</p>\n+     */\n+    public void setCreateUnicodeExtraFields(UnicodeExtraFieldPolicy b) {\n         createUnicodeExtraFields = b;\n     }\n \n         boolean encodable = this.zipEncoding.canEncode(ze.getName());\n         ByteBuffer name = this.zipEncoding.encode(ze.getName());\n \n-        if (createUnicodeExtraFields) {\n-\n-            /*            if (!encodable) { -- FIXME decide what to*/\n+        if (createUnicodeExtraFields != UnicodeExtraFieldPolicy.NEVER) {\n+\n+            if (createUnicodeExtraFields == UnicodeExtraFieldPolicy.ALWAYS\n+                || !encodable) {\n                 ze.addExtraField(new UnicodePathExtraField(ze.getName(),\n                                                            name.array(),\n                                                            name.arrayOffset(),\n                                                            name.limit()));\n-            /* } */\n+            }\n \n             String comm = ze.getComment();\n             if (comm != null && !\"\".equals(comm)) {\n \n                 boolean commentEncodable = this.zipEncoding.canEncode(comm);\n \n-                /*            if (!commentEncodable) { -- FIXME decide what to*/\n+                if (createUnicodeExtraFields == UnicodeExtraFieldPolicy.ALWAYS\n+                    || !commentEncodable) {\n                     ByteBuffer commentB = this.zipEncoding.encode(comm);\n                     ze.addExtraField(new UnicodeCommentExtraField(comm,\n                                                                   commentB.array(),\n                                                                   commentB.arrayOffset(),\n                                                                   commentB.limit())\n                                      );\n-                /* } */\n+                }\n             }\n         }\n \n         // general purpose bit flag\n         writeOut(ZipShort.getBytes(generalPurposeFlag));\n     }\n+\n+    /**\n+     * enum that represents the possible policies for creating Unicode\n+     * extra fields.\n+     */\n+    public static final class UnicodeExtraFieldPolicy {\n+        /**\n+         * Always create Unicode extra fields.\n+         */\n+        public static final UnicodeExtraFieldPolicy ALWAYS =\n+            new UnicodeExtraFieldPolicy(\"always\");\n+        /**\n+         * Never create Unicode extra fields.\n+         */\n+        public static final UnicodeExtraFieldPolicy NEVER =\n+            new UnicodeExtraFieldPolicy(\"never\");\n+        /**\n+         * Create Unicode extra fields for filenames that cannot be\n+         * encoded using the specified encoding.\n+         */\n+        public static final UnicodeExtraFieldPolicy NOT_ENCODABLE =\n+            new UnicodeExtraFieldPolicy(\"not encodable\");\n+\n+        private final String name;\n+        private UnicodeExtraFieldPolicy(String n) {\n+            name = n;\n+        }\n+        public String toString() {\n+            return name;\n+        }\n+    }\n }\n--- a/src/test/java/org/apache/commons/compress/archivers/zip/UTF8ZipFilesTest.java\n+++ b/src/test/java/org/apache/commons/compress/archivers/zip/UTF8ZipFilesTest.java\n             zos = new ZipArchiveOutputStream(file);\n             zos.setEncoding(encoding);\n             zos.setUseLanguageEncodingFlag(withEFS);\n-            zos.setCreateUnicodeExtraFields(!withExplicitUnicodeExtra);\n+            zos.setCreateUnicodeExtraFields(withExplicitUnicodeExtra ? \n+                                            ZipArchiveOutputStream\n+                                            .UnicodeExtraFieldPolicy.NEVER\n+                                            : ZipArchiveOutputStream\n+                                            .UnicodeExtraFieldPolicy.ALWAYS);\n \n             ZipArchiveEntry ze = new ZipArchiveEntry(OIL_BARREL_TXT);\n             if (withExplicitUnicodeExtra", "timestamp": 1236143245, "metainfo": ""}