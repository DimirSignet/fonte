{"sha": "b88dd3ed853738b8e7fe9652b953db569bf7f79d", "log": "Zip64Mode.Always now impacts central file header same as local file header", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n         final boolean needsZip64Extra = hasZip64Extra(ze)\n                 || ze.getCompressedSize() >= ZIP64_MAGIC\n                 || ze.getSize() >= ZIP64_MAGIC\n-                || lfhOffset >= ZIP64_MAGIC;\n+                || lfhOffset >= ZIP64_MAGIC\n+                || zip64Mode == Zip64Mode.Always;\n \n         if (needsZip64Extra && zip64Mode == Zip64Mode.Never) {\n             // must be the offset that is too big, otherwise an\n         // uncompressed length\n         putLong(ze.getCrc(), buf, CFH_CRC_OFFSET);\n         if (ze.getCompressedSize() >= ZIP64_MAGIC\n-                || ze.getSize() >= ZIP64_MAGIC) {\n+                || ze.getSize() >= ZIP64_MAGIC\n+                || zip64Mode == Zip64Mode.Always) {\n             ZipLong.ZIP64_MAGIC.putLong(buf, CFH_COMPRESSED_SIZE_OFFSET);\n             ZipLong.ZIP64_MAGIC.putLong(buf, CFH_ORIGINAL_SIZE_OFFSET);\n         } else {\n         putLong(ze.getExternalAttributes(), buf, CFH_EXTERNAL_ATTRIBUTES_OFFSET);\n \n         // relative offset of LFH\n-        putLong(Math.min(lfhOffset, ZIP64_MAGIC), buf, CFH_LFH_OFFSET);\n-\n+        if(lfhOffset >= ZIP64_MAGIC || zip64Mode == Zip64Mode.Always){\n+        \tputLong(ZIP64_MAGIC, buf, CFH_LFH_OFFSET);\n+        }\n+        else{\n+        \tputLong(Math.min(lfhOffset, ZIP64_MAGIC), buf, CFH_LFH_OFFSET);\n+        }\n+        \n         // file name\n         System.arraycopy(name.array(), name.arrayOffset(), buf, CFH_FILENAME_OFFSET, nameLen);\n \n         if (needsZip64Extra) {\n             Zip64ExtendedInformationExtraField z64 = getZip64Extra(ze);\n             if (ze.getCompressedSize() >= ZIP64_MAGIC\n-                || ze.getSize() >= ZIP64_MAGIC) {\n+                || ze.getSize() >= ZIP64_MAGIC\n+                || zip64Mode == Zip64Mode.Always) {\n                 z64.setCompressedSize(new ZipEightByteInteger(ze.getCompressedSize()));\n                 z64.setSize(new ZipEightByteInteger(ze.getSize()));\n             } else {\n                 z64.setCompressedSize(null);\n                 z64.setSize(null);\n             }\n-            if (lfhOffset >= ZIP64_MAGIC) {\n+            if (lfhOffset >= ZIP64_MAGIC || zip64Mode == Zip64Mode.Always) {\n                 z64.setRelativeHeaderOffset(new ZipEightByteInteger(lfhOffset));\n             }\n             ze.setExtra();", "timestamp": 1457211176, "metainfo": ""}