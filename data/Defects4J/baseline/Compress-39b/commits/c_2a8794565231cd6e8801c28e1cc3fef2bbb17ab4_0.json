{"sha": "2a8794565231cd6e8801c28e1cc3fef2bbb17ab4", "log": "don't rely on pack/unpack closing the input in exceptional situations  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/compressors/pack200/Pack200CompressorOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/pack200/Pack200CompressorOutputStream.java\n             if (properties != null) {\n                 p.properties().putAll(properties);\n             }\n-            p.pack(new JarInputStream(streamBridge.getInput()),\n-                   originalOutput);\n+            JarInputStream ji = null;\n+            boolean success = false;\n+            try {\n+                p.pack(ji = new JarInputStream(streamBridge.getInput()),\n+                       originalOutput);\n+                success = true;\n+            } finally {\n+                if (!success && ji != null) {\n+                    try {\n+                        ji.close();\n+                    } catch (IOException ex) { // NOPMD\n+                        // swallow so original exception isn't masked\n+                    }\n+                }\n+            }\n         }\n     }\n }\n--- a/src/main/java/org/apache/commons/compress/compressors/pack200/Pack200Utils.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/pack200/Pack200Utils.java\n         f.deleteOnExit();\n         try {\n             OutputStream os = new FileOutputStream(f);\n+            JarFile j = null;\n             try {\n                 Pack200.Packer p = Pack200.newPacker();\n                 p.properties().putAll(props);\n-                p.pack(new JarFile(from), os);\n+                p.pack(j = new JarFile(from), os);\n+                j = null;\n                 os.close();\n                 os = null;\n \n                 os = new JarOutputStream(new FileOutputStream(to));\n                 u.unpack(f, (JarOutputStream) os);\n             } finally {\n+                if (j != null) {\n+                    j.close();\n+                }\n                 if (os != null) {\n                     os.close();\n                 }", "timestamp": 1316087162, "metainfo": ""}