{"sha": "a942bdf9758065901690e9d87eab92a6dcd1470e", "log": "ensure the same encoding is used for name and comment in all places.  Submitted by Wolfgang Glas  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.java\n     protected void writeLocalFileHeader(ZipArchiveEntry ze) throws IOException {\n \n         boolean encodable = zipEncoding.canEncode(ze.getName());\n-        ByteBuffer name;\n+        \n+        final ZipEncoding entryEncoding;\n+        \n         if (!encodable && fallbackToUTF8) {\n-            name = ZipEncodingHelper.UTF8_ZIP_ENCODING.encode(ze.getName());\n+            entryEncoding = ZipEncodingHelper.UTF8_ZIP_ENCODING;\n         } else {\n-            name = zipEncoding.encode(ze.getName());\n-        }\n+            entryEncoding = zipEncoding;\n+        }\n+        \n+        ByteBuffer name = entryEncoding.encode(ze.getName());        \n \n         if (createUnicodeExtraFields != UnicodeExtraFieldPolicy.NEVER) {\n \n \n                 if (createUnicodeExtraFields == UnicodeExtraFieldPolicy.ALWAYS\n                     || !commentEncodable) {\n-                    ByteBuffer commentB = this.zipEncoding.encode(comm);\n+                    ByteBuffer commentB = entryEncoding.encode(comm);\n                     ze.addExtraField(new UnicodeCommentExtraField(comm,\n                                                                   commentB.array(),\n                                                                   commentB.arrayOffset(),\n         // CheckStyle:MagicNumber ON\n \n         // file name length\n-        ByteBuffer name;\n+        final ZipEncoding entryEncoding;\n+        \n         if (!encodable && fallbackToUTF8) {\n-            name = ZipEncodingHelper.UTF8_ZIP_ENCODING.encode(ze.getName());\n+            entryEncoding = ZipEncodingHelper.UTF8_ZIP_ENCODING;\n         } else {\n-            name = zipEncoding.encode(ze.getName());\n-        }\n+            entryEncoding = zipEncoding;\n+        }\n+        \n+        ByteBuffer name = entryEncoding.encode(ze.getName());        \n+\n         writeOut(ZipShort.getBytes(name.limit()));\n         written += SHORT;\n \n         if (comm == null) {\n             comm = \"\";\n         }\n-        ByteBuffer commentB;\n-        if (!encodable && fallbackToUTF8) {\n-            commentB = ZipEncodingHelper.UTF8_ZIP_ENCODING.encode(comm);\n-        } else {\n-            commentB = zipEncoding.encode(comm);\n-        }\n+        \n+        ByteBuffer commentB = entryEncoding.encode(comm);\n+        \n         writeOut(ZipShort.getBytes(commentB.limit()));\n         written += SHORT;\n ", "timestamp": 1236227732, "metainfo": ""}