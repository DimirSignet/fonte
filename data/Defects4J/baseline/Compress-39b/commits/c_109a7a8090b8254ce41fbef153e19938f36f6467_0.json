{"sha": "109a7a8090b8254ce41fbef153e19938f36f6467", "log": "Don't NPE on archives of all empty files.    ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/sevenz/SevenZFile.java\n         final StreamMap streamMap = new StreamMap();\n         \n         int nextFolderPackStreamIndex = 0;\n-        streamMap.folderFirstPackStreamIndex = new int[archive.folders.length];\n-        for (int i = 0; i < archive.folders.length; i++) {\n+        final int numFolders = (archive.folders != null) ? archive.folders.length : 0;\n+        streamMap.folderFirstPackStreamIndex = new int[numFolders];\n+        for (int i = 0; i < numFolders; i++) {\n             streamMap.folderFirstPackStreamIndex[i] = nextFolderPackStreamIndex;\n             nextFolderPackStreamIndex += archive.folders[i].packedStreams.length;\n         }\n         \n         long nextPackStreamOffset = 0;\n-        streamMap.packStreamOffsets = new long[archive.packSizes.length];\n-        for (int i = 0; i < archive.packSizes.length; i++) {\n+        final int numPackSizes = (archive.packSizes != null) ? archive.packSizes.length : 0;\n+        streamMap.packStreamOffsets = new long[numPackSizes];\n+        for (int i = 0; i < numPackSizes; i++) {\n             streamMap.packStreamOffsets[i] = nextPackStreamOffset;\n             nextPackStreamOffset += archive.packSizes[i]; \n         }\n         \n-        streamMap.folderFirstFileIndex = new int[archive.folders.length];\n+        streamMap.folderFirstFileIndex = new int[numFolders];\n         streamMap.fileFolderIndex = new int[archive.files.length];\n         int nextFolderIndex = 0;\n         int nextFolderUnpackStreamIndex = 0;\n--- a/src/test/java/org/apache/commons/compress/archivers/sevenz/SevenZFileTest.java\n+++ b/src/test/java/org/apache/commons/compress/archivers/sevenz/SevenZFileTest.java\n import org.apache.commons.compress.AbstractTestCase;\n \n public class SevenZFileTest extends AbstractTestCase {\n+    public void testAllEmptyFilesArchive() throws Exception {\n+        SevenZFile archive = new SevenZFile(getFile(\"7z-empty-mhc-off.7z\"));\n+        try {\n+            assertNotNull(archive.getNextEntry());\n+        } finally {\n+            archive.close();\n+        }\n+    }\n+    \n     public void testHelloWorldHeaderCompressionOffCopy() throws Exception {\n         checkHelloWorld(\"7z-hello-mhc-off-copy.7z\");\n     }", "timestamp": 1368554203, "metainfo": ""}