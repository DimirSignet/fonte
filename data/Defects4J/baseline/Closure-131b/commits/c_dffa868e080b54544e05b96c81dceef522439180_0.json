{"sha": "dffa868e080b54544e05b96c81dceef522439180", "log": "Remove WITH checks in es5 strict mode. We already warn about this by default  R=johnlenz DELTA=24  (10 added, 12 deleted, 2 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=2857   ", "commit": "\n--- a/src/com/google/javascript/jscomp/DiagnosticGroups.java\n+++ b/src/com/google/javascript/jscomp/DiagnosticGroups.java\n \n   public static DiagnosticGroup ES5_STRICT =\n       DiagnosticGroups.registerGroup(\"es5Strict\",\n+          ControlStructureCheck.USE_OF_WITH,\n           StrictModeCheck.UNKNOWN_VARIABLE,\n-          StrictModeCheck.WITH_DISALLOWED,\n           StrictModeCheck.EVAL_DECLARATION,\n           StrictModeCheck.EVAL_ASSIGNMENT,\n           StrictModeCheck.ARGUMENTS_DECLARATION,\n--- a/src/com/google/javascript/jscomp/StrictModeCheck.java\n+++ b/src/com/google/javascript/jscomp/StrictModeCheck.java\n   static final DiagnosticType UNKNOWN_VARIABLE = DiagnosticType.warning(\n       \"JSC_UNKNOWN_VARIABLE\", \"unknown variable {0}\");\n \n-  static final DiagnosticType WITH_DISALLOWED = DiagnosticType.warning(\n-      \"JSC_WITH_DISALLOWED\", \"\\\"with\\\" cannot be used in ES5 strict mode\");\n-\n   static final DiagnosticType EVAL_USE = DiagnosticType.error(\n       \"JSC_EVAL_USE\", \"\\\"eval\\\" cannot be used in Caja\");\n \n   }\n \n   @Override public void visit(NodeTraversal t, Node n, Node parent) {\n-    if (n.getType() == Token.WITH) {\n-      t.report(n, WITH_DISALLOWED);\n-    } else if (n.getType() == Token.NAME) {\n+    if (n.getType() == Token.NAME) {\n       if (!isDeclaration(n)) {\n         checkNameUse(t, n);\n       }\n--- a/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n+++ b/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n     assertEquals(outputSource.substring(13).indexOf(\"'use strict'\"), -1);\n   }\n \n+  public void testWithKeywordDefault() {\n+    test(\"var x = {}; with (x) {}\", ControlStructureCheck.USE_OF_WITH);\n+  }\n+\n+  public void testWithKeywordWithEs5ChecksOff() {\n+    args.add(\"--jscomp_off=es5Strict\");\n+    testSame(\"var x = {}; with (x) {}\");\n+  }\n+\n   /* Helper functions */\n \n   private void testSame(String original) {\n--- a/test/com/google/javascript/jscomp/StrictModeCheckTest.java\n+++ b/test/com/google/javascript/jscomp/StrictModeCheckTest.java\n     return 1;\n   }\n \n-  public void testWith() {\n-    testSame(\"var a; function foo(obj) { with (obj) { a = 3; }}\",\n-         StrictModeCheck.WITH_DISALLOWED);\n-  }\n-\n   public void testEval() {\n     test(\"function foo() { eval('a'); }\", null,\n          StrictModeCheck.EVAL_USE);", "timestamp": 1312297169, "metainfo": ""}