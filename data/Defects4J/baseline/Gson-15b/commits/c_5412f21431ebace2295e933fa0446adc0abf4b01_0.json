{"sha": "5412f21431ebace2295e933fa0446adc0abf4b01", "log": "Printing more debugging information to help track an invalid JsonAdapter. (#1068)  Now the thrown exception carries this information:\r java.lang.IllegalArgumentException: Invalid attempt to bind an instance of java.lang.Integer as a @JsonAdapter for com.google.gson.functional.JsonAdapterAnnotationOnClassesTest$D. @JsonAdapter value must be a TypeAdapter, TypeAdapterFactory, JsonSerializer or JsonDeserializer.", "commit": "\n--- a/gson/src/main/java/com/google/gson/JsonObject.java\n+++ b/gson/src/main/java/com/google/gson/JsonObject.java\n    * Returns a set of members key values.\n    *\n    * @return a set of member keys as Strings\n+   * @since 2.8.1\n    */\n   public Set<String> keySet() {\n     return members.keySet();\n--- a/gson/src/main/java/com/google/gson/internal/bind/JsonAdapterAnnotationTypeAdapterFactory.java\n+++ b/gson/src/main/java/com/google/gson/internal/bind/JsonAdapterAnnotationTypeAdapterFactory.java\n           : null;\n       typeAdapter = new TreeTypeAdapter(serializer, deserializer, gson, type, null);\n     } else {\n-      throw new IllegalArgumentException(\n-          \"@JsonAdapter value must be TypeAdapter, TypeAdapterFactory, \"\n-              + \"JsonSerializer or JsonDeserializer reference.\");\n+      throw new IllegalArgumentException(\"Invalid attempt to bind an instance of \"\n+          + instance.getClass().getName() + \" as a @JsonAdapter for \" + type.toString()\n+          + \". @JsonAdapter value must be a TypeAdapter, TypeAdapterFactory,\"\n+          + \" JsonSerializer or JsonDeserializer.\");\n     }\n \n     if (typeAdapter != null && annotation.nullSafe()) {\n--- a/gson/src/test/java/com/google/gson/functional/JsonAdapterAnnotationOnClassesTest.java\n+++ b/gson/src/test/java/com/google/gson/functional/JsonAdapterAnnotationOnClassesTest.java\n       return Foo.valueOf(in.nextString().toUpperCase(Locale.US));\n     }\n   }\n+\n+  public void testIncorrectJsonAdapterType() {\n+    try {\n+      new Gson().toJson(new D());\n+      fail();\n+    } catch (IllegalArgumentException expected) {}\n+  }\n+  @JsonAdapter(Integer.class)\n+  private static final class D {\n+    @SuppressWarnings(\"unused\") final String value = \"a\";\n+  }\n }", "timestamp": 1492646901, "metainfo": ""}