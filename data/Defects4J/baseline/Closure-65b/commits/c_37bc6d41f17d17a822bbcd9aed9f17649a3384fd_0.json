{"sha": "37bc6d41f17d17a822bbcd9aed9f17649a3384fd", "log": "fix up some more inference-on-inner-functions edge cases.    ", "commit": "\n--- a/src/com/google/javascript/jscomp/TypeInference.java\n+++ b/src/com/google/javascript/jscomp/TypeInference.java\n       StaticSlot<JSType> var = scope.getSlot(varName);\n       if (var != null) {\n         type = var.getType();\n+        if (type == null) {\n+          type = getNativeType(UNKNOWN_TYPE);\n+        }\n       }\n     }\n     n.setJSType(type);\n--- a/test/com/google/javascript/jscomp/CompilerTypeTestCase.java\n+++ b/test/com/google/javascript/jscomp/CompilerTypeTestCase.java\n       \"goog.abstractMethod = function() {};\" +\n       \"goog.isArray = function(x) {};\" +\n       \"goog.isDef = function(x) {};\" +\n+      \"goog.isFunction = function(x) {};\" +\n       \"goog.isNull = function(x) {};\" +\n       \"goog.isString = function(x) {};\" +\n       \"goog.isObject = function(x) {};\" +\n--- a/test/com/google/javascript/jscomp/TypeCheckTest.java\n+++ b/test/com/google/javascript/jscomp/TypeCheckTest.java\n         \"inconsistent return type\\n\" +\n         \"found   : boolean\\n\" +\n         \"required: number\");\n+  }\n+\n+  public void testInnerFunction6() throws Exception {\n+    testClosureTypes(\n+        CLOSURE_DEFS +\n+        \"function f() {\" +\n+        \" var x = 0 || function() {};\\n\" +\n+        \" function g() { if (goog.isFunction(x)) { x(1); } }\" +\n+        \" g();\" +\n+        \"}\", null);\n+  }\n+\n+  public void testInnerFunction7() throws Exception {\n+    testClosureTypes(\n+        CLOSURE_DEFS +\n+        \"function f() {\" +\n+        \" /** @type {number|function()} */\" +\n+        \" var x = 0 || function() {};\\n\" +\n+        \" function g() { if (goog.isFunction(x)) { x(1); } }\" +\n+        \" g();\" +\n+        \"}\",\n+        \"Function x: called with 1 argument(s). \" +\n+        \"Function requires at least 0 argument(s) \" +\n+        \"and no more than 0 argument(s).\");\n+  }\n+\n+  public void testInnerFunction8() throws Exception {\n+    testClosureTypes(\n+        CLOSURE_DEFS +\n+        \"function f() {\" +\n+        \" function x() {};\\n\" +\n+        \" function g() { if (goog.isFunction(x)) { x(1); } }\" +\n+        \" g();\" +\n+        \"}\",\n+        \"Function x: called with 1 argument(s). \" +\n+        \"Function requires at least 0 argument(s) \" +\n+        \"and no more than 0 argument(s).\");\n   }\n \n   public void testAbstractMethodHandling1() throws Exception {", "timestamp": 1265317579, "metainfo": ""}