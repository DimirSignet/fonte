{"sha": "71a9ef6258d01b0e05820209be0035fab11a8d3a", "log": "If Window is declared but not marked as a constructor, don't crash  R=johnlenz DELTA=12  (11 added, 0 deleted, 1 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=851   ", "commit": "\n--- a/src/com/google/javascript/jscomp/TypedScopeCreator.java\n+++ b/src/com/google/javascript/jscomp/TypedScopeCreator.java\n       }\n \n       if (isGlobalVar && \"Window\".equals(variableName)\n-          && type instanceof FunctionType) {\n+          && type instanceof FunctionType\n+          && type.isConstructor()) {\n         FunctionType globalThisCtor =\n             typeRegistry.getNativeObjectType(GLOBAL_THIS).getConstructor();\n         globalThisCtor.getInstanceType().clearCachedValues();\n--- a/test/com/google/javascript/jscomp/TypeCheckTest.java\n+++ b/test/com/google/javascript/jscomp/TypeCheckTest.java\n         \"actual parameter 1 of foo does not match formal parameter\\n\" +\n         \"found   : global this\\n\" +\n         \"required: number\");\n+  }\n+\n+  public void testGlobalThis9() throws Exception {\n+    testTypes(\n+        // Window is not marked as a constructor, so the\n+        // inheritance doesn't happen.\n+        \"function Window() {}\" +\n+        \"Window.prototype.alert = function() {};\" +\n+        \"this.alert();\",\n+        \"Property alert never defined on global this\");\n   }\n \n   public void testControlFlowRestrictsType1() throws Exception {", "timestamp": 1300117797, "metainfo": ""}