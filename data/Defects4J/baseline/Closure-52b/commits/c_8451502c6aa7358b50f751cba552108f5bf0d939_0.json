{"sha": "8451502c6aa7358b50f751cba552108f5bf0d939", "log": "Don't move code that might be redefined in another function.  R=nicksantos DELTA=19  (18 added, 0 deleted, 1 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=926   ", "commit": "\n--- a/src/com/google/javascript/jscomp/CrossModuleCodeMotion.java\n+++ b/src/com/google/javascript/jscomp/CrossModuleCodeMotion.java\n         case Token.IF:\n         case Token.SWITCH:\n         case Token.WHILE:\n+        case Token.FUNCTION:\n           return true;\n       }\n     }\n     NamedInfo info = getNamedInfo(v);\n     if (info.allowMove) {\n       if (maybeProcessDeclaration(t, n, parent, info)) {\n-        if (hasConditionalAncestor(n)) {\n+        // Check to see if the declaration is conditional starting at the\n+        // grandparent of the name node. Since a function declaration\n+        // is considered conditional (the function might not be called)\n+        // we would need to skip the parent in this check as the name could\n+        // just be a function itself.\n+        if (hasConditionalAncestor(parent.getParent())) {\n           info.allowMove = false;\n         }\n       } else {\n--- a/test/com/google/javascript/jscomp/CrossModuleCodeMotionTest.java\n+++ b/test/com/google/javascript/jscomp/CrossModuleCodeMotionTest.java\n          });\n   }\n \n+  public void testBug4118005() {\n+    testSame(createModuleChain(\n+             // m1\n+             \"var m = 1;\\n\" +\n+             \"(function () {\\n\" +\n+             \" var x = 1;\\n\" +\n+             \" m = function() { return x };\\n\" +\n+             \"})();\\n\",\n+             // m2\n+             \"m();\"));\n+  }\n+\n   public void testEmptyModule() {\n     // When the dest module is empty, it might try to move the code to the\n     // one of the modules that the empty module depends on. In some cases", "timestamp": 1300387664, "metainfo": ""}