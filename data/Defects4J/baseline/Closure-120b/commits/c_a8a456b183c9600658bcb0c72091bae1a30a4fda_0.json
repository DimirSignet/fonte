{"sha": "a8a456b183c9600658bcb0c72091bae1a30a4fda", "log": "Improve detection of suspicious block comments.  Doesn't fix issue 1037. That would require a regex that matches more comments, and there would be spurious matches. We only care about tags that would be recognized in a jsdoc: either a tag following /*, or a tag in a line with a * followed by spaces. ------------- Created by MOE: http://code.google.com/p/moe-java MOE_MIGRATED_REVID=49296988", "commit": "\n--- a/src/com/google/javascript/jscomp/parsing/IRFactory.java\n+++ b/src/com/google/javascript/jscomp/parsing/IRFactory.java\n import com.google.javascript.rhino.jstype.StaticSourceFile;\n \n import java.util.Set;\n+import java.util.regex.Pattern;\n \n /**\n  * IRFactory transforms the new AST to the old AST.\n    * Check to see if the given block comment looks like it should be JSDoc.\n    */\n   private void handleBlockComment(Comment comment) {\n-    String value = comment.getValue();\n-    if (value.indexOf(\"/* @\") != -1 ||\n-        value.indexOf(\"\\n * @\") != -1) {\n+    Pattern p = Pattern.compile(\"(/|(\\n[ \\t]*))\\\\*[ \\t]*@[a-zA-Z]\");\n+    if (p.matcher(comment.getValue()).find()) {\n       errorReporter.warning(\n           SUSPICIOUS_COMMENT_WARNING,\n           sourceName,\n--- a/test/com/google/javascript/jscomp/parsing/ParserTest.java\n+++ b/test/com/google/javascript/jscomp/parsing/ParserTest.java\n \n   public void testSuspiciousBlockCommentWarning2() {\n     parse(\"/* \\n * @type {number} */ var x = 3;\", SUSPICIOUS_COMMENT_WARNING);\n+  }\n+\n+  public void testSuspiciousBlockCommentWarning3() {\n+    parse(\"/* \\n *@type {number} */ var x = 3;\", SUSPICIOUS_COMMENT_WARNING);\n+  }\n+\n+  public void testSuspiciousBlockCommentWarning4() {\n+    parse(\n+        \"  /*\\n\" +\n+        \"   * @type {number}\\n\" +\n+        \"   */\\n\" +\n+        \"  var x = 3;\",\n+        SUSPICIOUS_COMMENT_WARNING);\n+  }\n+\n+  public void testSuspiciousBlockCommentWarning5() {\n+    parse(\n+        \"  /*\\n\" +\n+        \"   * some random text here\\n\" +\n+        \"   * @type {number}\\n\" +\n+        \"   */\\n\" +\n+        \"  var x = 3;\",\n+        SUSPICIOUS_COMMENT_WARNING);\n+  }\n+\n+  public void testSuspiciousBlockCommentWarning6() {\n+    parse(\"/* @type{number} */ var x = 3;\", SUSPICIOUS_COMMENT_WARNING);\n   }\n \n   public void testCatchClauseForbidden() {", "timestamp": 1373671163, "metainfo": ""}