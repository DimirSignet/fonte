{"sha": "f482915efbb911c3f9a70a64e437d687d1876526", "log": "Fix check for dangling elses.  Previously, this function didn't take into account the fact that IFs branches are always BLOCK nodes. ------------- Created by MOE: http://code.google.com/p/moe-java MOE_MIGRATED_REVID=46953649", "commit": "\n--- a/src/com/google/javascript/jscomp/PeepholeMinimizeConditions.java\n+++ b/src/com/google/javascript/jscomp/PeepholeMinimizeConditions.java\n           // This IF node has no else clause.\n           n = n.getLastChild();\n           continue;\n+        case Token.BLOCK:\n+          if (n.getChildCount() != 1) {\n+            return false;\n+          }\n+          // This BLOCK has no curly braces.\n+          n = n.getLastChild();\n+          continue;\n         case Token.WITH:\n         case Token.WHILE:\n         case Token.FOR:\n--- a/test/com/google/javascript/jscomp/PeepholeMinimizeConditionsTest.java\n+++ b/test/com/google/javascript/jscomp/PeepholeMinimizeConditionsTest.java\n     foldSame(\"if(!a&&!b)for(;f(););\");\n   }\n \n+  public void testNoSwapWithDanglingElse() {\n+    foldSame(\"if(!x) {for(;;)foo(); for(;;)bar()} else if(y) for(;;) f()\");\n+    foldSame(\"if(!a&&!b) {for(;;)foo(); for(;;)bar()} else if(y) for(;;) f()\");\n+  }\n+\n   public void testMinimizeHook() {\n     fold(\"!x ? foo() : bar()\",\n          \"x ? bar() : foo()\");", "timestamp": 1369264797, "metainfo": ""}