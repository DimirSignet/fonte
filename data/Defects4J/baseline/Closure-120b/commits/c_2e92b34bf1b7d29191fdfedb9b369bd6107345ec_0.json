{"sha": "2e92b34bf1b7d29191fdfedb9b369bd6107345ec", "log": "Allow the rollup of object properties that are assigned function literals that have referencs to the object as part of its definition.  R=agrieve DELTA=39  (38 added, 0 deleted, 1 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=4271   ", "commit": "\n--- a/src/com/google/javascript/jscomp/PeepholeCollectPropertyAssignments.java\n+++ b/src/com/google/javascript/jscomp/PeepholeCollectPropertyAssignments.java\n       return false;\n     }\n     // and does not have a reference to a variable initialized after it.\n-    if (mightContainForwardReference(rhs, name)) {\n+    if (!NodeUtil.isLiteralValue(rhs, true)\n+        && mightContainForwardReference(rhs, name)) {\n       return false;\n     }\n \n--- a/test/com/google/javascript/jscomp/PeepholeCollectPropertyAssignmentsTest.java\n+++ b/test/com/google/javascript/jscomp/PeepholeCollectPropertyAssignmentsTest.java\n          \"var o; o = {x:1}; o.y = (o = {}); o.z = 4;\");\n   }\n \n+  public final void testObjectFunctionRollup1() {\n+    test(\"var o; o = {};\" +\n+         \"o.x = function() {};\",\n+         \"var o; o = {x:function () {}};\");\n+  }\n+\n+  public final void testObjectFunctionRollup2() {\n+    testSame(\n+         \"var o; o = {};\" +\n+         \"o.x = (function() {return o})();\");\n+  }\n+\n+  public final void testObjectFunctionRollup3() {\n+    test(\"var o; o = {};\" +\n+         \"o.x = function() {return o};\",\n+         \"var o; o = {x:function () {return o}};\");\n+  }\n+\n+  public final void testObjectFunctionRollup4() {\n+    testSame(\n+        \"function f() {return o};\" +\n+        \"var o; o = {};\" +\n+        \"o.x = f();\");\n+  }\n+\n+  public final void testObjectFunctionRollup5() {\n+    test(\"var o; o = {};\" +\n+         \"o.x = function() {return o};\" +\n+         \"o.y = [function() {return o}];\" +\n+         \"o.z = {a:function() {return o}};\",\n+\n+         \"var o; o = {\" +\n+         \"x:function () {return o}, \" +\n+         \"y:[function () {return o}], \" +\n+         \"z:{a:function () {return o}}};\");\n+  }\n+\n }", "timestamp": 1330105778, "metainfo": ""}