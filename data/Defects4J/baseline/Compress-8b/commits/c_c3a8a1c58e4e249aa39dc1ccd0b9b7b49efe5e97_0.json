{"sha": "c3a8a1c58e4e249aa39dc1ccd0b9b7b49efe5e97", "log": "tracked down the problem of https://issues.apache.org/jira/browse/COMPRESS-11     ", "commit": "\n--- a/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java\n+++ b/src/test/java/org/apache/commons/compress/archivers/ArTestCase.java\n \t\t\tout.close();\n \t\t}\n \t\t\n+\t\tassertEquals(282, output.length());\n+\t\t\n \t\tfinal File output2 = new File(dir, \"bla2.ar\");\t\t\n+\n+\t\tint copied = 0;\n+\t\tint deleted = 0;\n \n \t\t{\n \t\t\t// remove all but one file\n+\n \t\t\tfinal InputStream is = new FileInputStream(output);\n \t\t\tfinal OutputStream os = new FileOutputStream(output2);\n \t\t\tfinal ArchiveOutputStream aos = new ArchiveStreamFactory().createArchiveOutputStream(\"ar\", os);\n \t\t\t\tif (\"test1.xml\".equals(entry.getName())) {\n \t\t\t\t\taos.putArchiveEntry(entry);\n \t\t\t\t\tIOUtils.copy(ais, aos);\n+\t\t\t\t\taos.closeArchiveEntry();\n+\t\t\t\t\tcopied++;\n \t\t\t\t} else {\n \t\t\t        IOUtils.copy(ais, new ByteArrayOutputStream());\n+\t\t\t        deleted++;\n \t\t\t\t}\n \t\t\t\n \t\t\t}\n \t\t\tos.close();\t\t\t\n \t\t}\n \n+\t\tassertEquals(1, copied);\n+\t\tassertEquals(1, deleted);\n+\t\tassertEquals(144, output2.length());\n \t\t\n+\t\tlong files = 0;\n \t\tlong sum = 0;\n \n \t\t{\n \t\t        IOUtils.copy(ais, new ByteArrayOutputStream());\n \t\t        \n \t\t        sum +=  entry.getLength();\n+\t\t        files++;\n \t\t\t}\n \t\t\tais.close();\n \t\t\tis.close();\t\t\t\n \t\t}\n \n+\t\tassertEquals(1, files);\n \t\tassertEquals(76, sum);\n \t\t\n \t}", "timestamp": 1238188107, "metainfo": ""}