{"sha": "56b47fc117ee7153f68b9524a862c12d5e178aa3", "log": "Update match() - add detection of binary format - tighten detection of ascii formats; ensure last byte is correct  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveInputStream.java\n         return getNextCPIOEntry();\n     }\n \n+    /**\n+     * Checks if the signature matches one of the following magic values:\n+     * \n+     * Strings:\n+     *  \n+     * \"070701\" - MAGIC_NEW\n+     * \"070702\" - MAGIC_NEW_CRC\n+     * \"070707\" - MAGIC_OLD_ASCII\n+     * \n+     * Octal Binary value:\n+     * \n+     * 070707 - MAGIC_OLD_BINARY (held as a short) = 0x71C7 or 0xC771\n+     */\n     public static boolean matches(byte[] signature, int length) {\n-        // 3037 3037 30\n-\n-        if (length < 5) {\n-            return false;\n-        }\n+        if (length < 6) {\n+            return false;\n+        }\n+        \n+        // Check binary values\n+        if (signature[0] == 0x71 && signature[1] == 0xc7) {\n+            return true;\n+        }\n+        if (signature[1] == 0x71 && signature[2] == 0xc7) {\n+            return true;\n+        }\n+\n+        // Check Ascii (String) values\n+        // 3037 3037 30nn\n         if (signature[0] != 0x30) {\n             return false;\n         }\n         if (signature[4] != 0x30) {\n             return false;\n         }\n-\n-        return true;\n+        // Check last byte\n+        if (signature[5] == 0x31) {\n+            return true;\n+        }\n+        if (signature[5] == 0x32) {\n+            return true;\n+        }\n+        if (signature[5] == 0x37) {\n+            return true;\n+        }\n+\n+        return false;\n     }\n }", "timestamp": 1238258931, "metainfo": ""}