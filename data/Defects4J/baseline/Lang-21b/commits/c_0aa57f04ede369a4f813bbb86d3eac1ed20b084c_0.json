{"sha": "0aa57f04ede369a4f813bbb86d3eac1ed20b084c", "log": "Adding stripAccents method to StringUtils. It requires JDK 1.6 (and accesses it via reflection until Lang becomes 1.6 dependent). LANG-285  ", "commit": "\n--- a/src/java/org/apache/commons/lang3/StringUtils.java\n+++ b/src/java/org/apache/commons/lang3/StringUtils.java\n         return newArr;\n     }\n \n+    /**\n+     * <p>Removes the accents from a string. </p>\n+     * <p>NOTE: This is a JDK 1.6 method, it will fail on JDK 1.5. </p>\n+     *\n+     * <pre>\n+     * StringUtils.stripAccents(null)                = null\n+     * StringUtils.stripAccents(\"\")                  = \"\"\n+     * StringUtils.stripAccents(\"control\")           = \"control\"\n+     * StringUtils.stripAccents(\"&ecute;clair\")      = \"eclair\"\n+     * </pre>\n+     * \n+     * @param input String to be stripped\n+     * @return String without accents on the text\n+     *\n+     * @since 3.0\n+     */\n+    public static String stripAccents(String input) {\n+        if(input == null) {\n+            return null;\n+        }\n+        if(SystemUtils.isJavaVersionAtLeast(1.6f)) {\n+\n+            // String decomposed = Normalizer.normalize(input, Normalizer.Form.NFD);\n+\n+            // START of 1.5 reflection - in 1.6 use the line commented out above\n+            try {\n+                // get java.text.Normalizer.Form class\n+                Class normalizerFormClass = ClassUtils.getClass(\"java.text.Normalizer$Form\", false);\n+\n+                // get Normlizer class\n+                Class normalizerClass = ClassUtils.getClass(\"java.text.Normalizer\", false);\n+\n+                // get static method on Normalizer\n+                java.lang.reflect.Method method = normalizerClass.getMethod(\"normalize\", CharSequence.class, normalizerFormClass );\n+\n+                // get Normalizer.NFD field\n+                java.lang.reflect.Field nfd = normalizerFormClass.getField(\"NFD\");\n+\n+                // invoke method\n+                String decomposed = (String) method.invoke( null, input, nfd.get(null) );\n+                // END of 1.5 reflection\n+\n+                java.util.regex.Pattern accentPattern = java.util.regex.Pattern.compile(\"\\\\p{InCombiningDiacriticalMarks}+\");\n+                return accentPattern.matcher(decomposed).replaceAll(\"\");\n+            } catch(ClassNotFoundException cnfe) {\n+                throw new RuntimeException(\"ClassNotFoundException occurred during 1.6 backcompat code\", cnfe);\n+            } catch(NoSuchMethodException nsme) {\n+                throw new RuntimeException(\"NoSuchMethodException occurred during 1.6 backcompat code\", nsme);\n+            } catch(NoSuchFieldException nsfe) {\n+                throw new RuntimeException(\"NoSuchFieldException occurred during 1.6 backcompat code\", nsfe);\n+            } catch(IllegalAccessException iae) {\n+                throw new RuntimeException(\"IllegalAccessException occurred during 1.6 backcompat code\", iae);\n+            } catch(IllegalArgumentException iae) {\n+                throw new RuntimeException(\"IllegalArgumentException occurred during 1.6 backcompat code\", iae);\n+            } catch(java.lang.reflect.InvocationTargetException ite) {\n+                throw new RuntimeException(\"InvocationTargetException occurred during 1.6 backcompat code\", ite);\n+            } catch(SecurityException se) {\n+                throw new RuntimeException(\"SecurityException occurred during 1.6 backcompat code\", se);\n+            }\n+        } else {\n+            throw new UnsupportedOperationException(\"The stripAccents(String) method is not supported until Java 1.6\");\n+        }\n+    }\n+\n     // Equals\n     //-----------------------------------------------------------------------\n     /**\n--- a/src/test/org/apache/commons/lang3/StringUtilsTrimEmptyTest.java\n+++ b/src/test/org/apache/commons/lang3/StringUtilsTrimEmptyTest.java\n         assertArrayEquals(foo, StringUtils.stripAll(fooDots, \".\"));\n     }\n \n+    public void testStripAccents() {\n+        if(SystemUtils.isJavaVersionAtLeast(1.6f)) {\n+            String cue = \"\\u00C7\\u00FA\\u00EA\";\n+            assertEquals( \"Failed to strip accents from \" + cue, \"Cue\", StringUtils.stripAccents(cue));\n+\n+            String lots = \"\\u00C0\\u00C1\\u00C2\\u00C3\\u00C4\\u00C5\\u00C7\\u00C8\\u00C9\" + \n+                          \"\\u00CA\\u00CB\\u00CC\\u00CD\\u00CE\\u00CF\\u00D1\\u00D2\\u00D3\" + \n+                          \"\\u00D4\\u00D5\\u00D6\\u00D9\\u00DA\\u00DB\\u00DC\\u00DD\";\n+            assertEquals( \"Failed to strip accents from \" + lots, \n+                          \"AAAAAACEEEEIIIINOOOOOUUUUY\", \n+                          StringUtils.stripAccents(lots));\n+\n+            assertNull( \"Failed null safety\", StringUtils.stripAccents(null) );\n+            assertEquals( \"Failed empty String\", \"\", StringUtils.stripAccents(\"\") );\n+            assertEquals( \"Failed to handle non-accented text\", \"control\", StringUtils.stripAccents(\"control\") );\n+            assertEquals( \"Failed to handle easy example\", \"eclair\", StringUtils.stripAccents(\"\\u00E9clair\") );\n+        } else {\n+            try {\n+                StringUtils.stripAccents(\"string\");\n+                fail(\"Before JDK 1.6, stripAccents is not expected to work\");\n+            } catch(UnsupportedOperationException uoe) {\n+                assertEquals(\"The stripAccents(String) method is not supported until Java 1.6\", uoe.getMessage());\n+            }\n+        }\n+    }\n+\n+    //-----------------------------------------------------------------------\n+\n     private void assertArrayEquals(Object[] o1, Object[] o2) {\n         if(o1 == null) {\n             assertEquals(o1,o2);", "timestamp": 1260775902, "metainfo": ""}