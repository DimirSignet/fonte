{"sha": "ffd701db8fd53ccb34c32b954227e65a33b77c84", "log": "Make start position and length information consistent for named function nodes by moving start position to beginning of 'function' token, rather than the first position of the function's name token.  tests updated accordingly.  R=nicksantos DELTA=44  (3 added, 11 deleted, 30 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=3174   ", "commit": "\n--- a/src/com/google/javascript/jscomp/parsing/IRFactory.java\n+++ b/src/com/google/javascript/jscomp/parsing/IRFactory.java\n   }\n \n   private void setSourceInfo(Node irNode, AstNode node) {\n-    // If we have a named function, set the position to that of the name.\n-    if (irNode.getType() == Token.FUNCTION &&\n-        irNode.getFirstChild().getLineno() != -1) {\n-      irNode.setLineno(irNode.getFirstChild().getLineno());\n-      irNode.setCharno(irNode.getFirstChild().getCharno());\n+    if (irNode.getLineno() == -1) {\n+      // If we didn't already set the line, then set it now. This avoids\n+      // cases like ParenthesizedExpression where we just return a previous\n+      // node, but don't want the new node to get its parent's line number.\n+      int lineno = node.getLineno();\n+      irNode.setLineno(lineno);\n+      int charno = position2charno(node.getAbsolutePosition());\n+      irNode.setCharno(charno);\n       maybeSetLengthFrom(irNode, node);\n-    } else {\n-      if (irNode.getLineno() == -1) {\n-        // If we didn't already set the line, then set it now.  This avoids\n-        // cases like ParenthesizedExpression where we just return a previous\n-        // node, but don't want the new node to get its parent's line number.\n-        int lineno = node.getLineno();\n-        irNode.setLineno(lineno);\n-        int charno = position2charno(node.getAbsolutePosition());\n-        irNode.setCharno(charno);\n-        maybeSetLengthFrom(irNode, node);\n-      }\n     }\n   }\n \n--- a/test/com/google/debugging/sourcemap/SourceMapGeneratorV1Test.java\n+++ b/test/com/google/debugging/sourcemap/SourceMapGeneratorV1Test.java\n                    \"[]\\n\" +\n \n                    \"/** Begin mapping definitions. **/\\n\" +\n-                   \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,0,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,10]\\n\" +\n                    \"[\\\"testcode\\\",1,13]\\n\");\n                    \"[\\\"testcode\\\",1,0,\\\"c\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,0,\\\"b\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,0,\\\"a\\\"]\\n\" +\n-                   \"[\\\"testcode\\\",1,17,\\\"a.b.c\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,8,\\\"a.b.c\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,17]\\n\" +\n                    \"[\\\"testcode\\\",1,20]\\n\");\n   }\n                    \"/** Begin mapping definitions. **/\\n\" +\n                    \"[\\\"testcode\\\",1,0]\\n\" +\n                    \"[\\\"testcode\\\",1,4,\\\"q\\\"]\\n\" +\n-                   \"[\\\"testcode\\\",1,17,\\\"q\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,8,\\\"q\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,17]\\n\" +\n                    \"[\\\"testcode\\\",1,20]\\n\");\n   }\n                    \"/** Begin mapping definitions. **/\\n\" +\n                    \"[\\\"testcode\\\",1,1]\\n\" +\n                    \"[\\\"testcode\\\",1,3]\\n\" +\n-                   \"[\\\"testcode\\\",1,18,\\\"q\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,9,\\\"q\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,18]\\n\" +\n                    \"[\\\"testcode\\\",1,21]\\n\");\n   }\n                    \"[]\\n\" +\n \n                    \"/** Begin mapping definitions. **/\\n\" +\n-                   \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,0,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,10]\\n\" +\n                    \"[\\\"testcode\\\",1,11,\\\"foo\\\"]\\n\" +\n                    \"[]\\n\" +\n \n                    \"/** Begin mapping definitions. **/\\n\" +\n-                   \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,0,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,11,\\\"foo\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,16,\\\"bar\\\"]\\n\" +\n                    \"/** Begin file information. **/\\n\" +\n                    \"[]\\n\" +\n                    \"/** Begin mapping definitions. **/\\n\" +\n-                   \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n+                   \"[\\\"testcode\\\",1,0,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,9,\\\"f\\\"]\\n\" +\n                    \"[\\\"testcode\\\",1,10]\\n\" +\n                    \"[\\\"testcode\\\",1,11,\\\"foo\\\"]\\n\" +\n--- a/test/com/google/debugging/sourcemap/SourceMapGeneratorV2Test.java\n+++ b/test/com/google/debugging/sourcemap/SourceMapGeneratorV2Test.java\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n                    \"\\\"lineMaps\\\":[\\\"cAkBEBEB\\\"],\\n\" +\n-                   \"\\\"mappings\\\":[[0,1,9,0],\\n\" +\n+                   \"\\\"mappings\\\":[[0,1,0,0],\\n\" +\n                    \"[0,1,9,0],\\n\" +\n                    \"[0,1,18],\\n\" +\n                    \"[0,1,21],\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n                    \"\\\"lineMaps\\\":[\\\"cAkBABkBA/kCA+ADMBcBgBA9\\\"],\\n\" +\n-                   \"\\\"mappings\\\":[[0,1,9,0],\\n\" +\n+                   \"\\\"mappings\\\":[[0,1,0,0],\\n\" +\n                    \"[0,1,9,0],\\n\" +\n                    \"[0,1,18],\\n\" +\n                    \"[0,1,19,1],\\n\" +\n         \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n         \"\\\"lineCount\\\":1,\\n\" +\n         \"\\\"lineMaps\\\":[\\\"cAEBABIBA/ICA+ADICA/ICA+IDA9AEYBMBA5\\\"],\\n\" +\n-        \"\\\"mappings\\\":[[0,1,9,0],\\n\" +\n+        \"\\\"mappings\\\":[[0,1,0,0],\\n\" +\n         \"[0,1,9,0],\\n\" +\n         \"[0,1,10],\\n\" +\n         \"[0,1,11,1],\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n                    \"\\\"lineMaps\\\":[\\\"cAEBA/ICA+IDE9IEA8IFA7IGg6MHA5\\\"],\\n\" +\n-                   \"\\\"mappings\\\":[[0,1,9,0],\\n\" +\n+                   \"\\\"mappings\\\":[[0,1,0,0],\\n\" +\n                    \"[0,1,9,0],\\n\" +\n                    \"[0,1,11,1],\\n\" +\n                    \"[0,1,16,2],\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n                    \"\\\"lineMaps\\\":[\" +\n                        \"\\\"cAEBABIBA/ICA+ADICA/ICA+IDA9IEYBMBA5\\\"],\\n\" +\n-                   \"\\\"mappings\\\":[[0,1,9,0],\\n\" +\n+                   \"\\\"mappings\\\":[[0,1,0,0],\\n\" +\n                    \"[0,1,9,0],\\n\" +\n                    \"[0,1,10],\\n\" +\n                    \"[0,1,11,1],\\n\" +\n--- a/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java\n+++ b/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java\n                    \"\\\"version\\\":3,\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n-                   \"\\\"mappings\\\":\\\"AACSA,QAAAA,UAAS,EAAG;\\\",\\n\" +\n+                   \"\\\"mappings\\\":\\\"AACAA,QAASA,UAAS,EAAG;\\\",\\n\" +\n                    \"\\\"sources\\\":[\\\"testcode\\\"],\\n\" +\n                    \"\\\"names\\\":[\\\"__BASIC__\\\"]\\n\" +\n                    \"}\\n\");\n                    \"\\\"version\\\":3,\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n-                   \"\\\"mappings\\\":\\\"AACSA,QAAAA,UAAS,CAACC,UAAD,CAAaC,UAAb,\" +\n+                   \"\\\"mappings\\\":\\\"AACAA,QAASA,UAAS,CAACC,UAAD,CAAaC,UAAb,\" +\n                        \"CAAyB,CAAE,IAAIC,QAAU,SAAhB;\\\",\\n\" +\n                    \"\\\"sources\\\":[\\\"testcode\\\"],\\n\" +\n                    \"\\\"names\\\":[\\\"__BASIC__\\\",\\\"__PARAM1__\\\",\\\"__PARAM2__\\\",\" +\n                    \"\\\"version\\\":3,\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n-                   \"\\\"mappings\\\":\\\"AACSA,QAAAA,EAAC,CAACC,GAAD,CAAMC,GAAN,\" +\n+                   \"\\\"mappings\\\":\\\"AACAA,QAASA,EAAC,CAACC,GAAD,CAAMC,GAAN,\" +\n                        \"CAAW,CAAED,GAAA,CAAMA,GAAN,CAAYC,GAAZ,CAAkB,CAAG,\" +\n                        \"OAAOD,IAA9B;\\\",\\n\" +\n                    \"\\\"sources\\\":[\\\"testcode\\\"],\\n\" +\n                    \"\\\"version\\\":3,\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n-                   \"\\\"mappings\\\":\\\"AACSA,QAAAA,EAAAA,CAAEC,GAAFD,CAAOE,\" +\n-                       \"GAAPF,EAAcC,GAAdD,CAAoBC,GAApBD,CAA0BE,GAA1BF,\" +\n-                       \"SAA0CC,IAA1CD;\\\",\\n\" +\n+                   \"\\\"mappings\\\":\\\"AACAA,QAASA,EAATA,CAAWC,GAAXD,CAAgBE,\" +\n+                       \"GAAhBF,EAAuBC,GAAvBD,CAA6BC,GAA7BD,CAAmCE,GAAnCF,\" +\n+                       \"SAAmDC,IAAnDD;\\\",\\n\" +\n                    \"\\\"sources\\\":[\\\"testcode\\\"],\\n\" +\n                    \"\\\"names\\\":[\\\"f\\\",\\\"foo\\\",\\\"bar\\\"]\\n\" +\n                    \"}\\n\");\n                    \"\\\"version\\\":3,\\n\" +\n                    \"\\\"file\\\":\\\"testcode\\\",\\n\" +\n                    \"\\\"lineCount\\\":1,\\n\" +\n-                   \"\\\"mappings\\\":\\\"AACSA,QAAAA,EAAC,CAACC,GAAD,CAAMC,GAAN,\" +\n+                   \"\\\"mappings\\\":\\\"AACAA,QAASA,EAAC,CAACC,GAAD,CAAMC,GAAN,\" +\n                        \"CAAW,CAIrBD,GAAA,CAAMA,GAAN,CAAYC,GAAZ,CAAkBD,\" +\n                        \"GAClB,OAAOA,IALc;\\\",\\n\" +\n                    \"\\\"sources\\\":[\\\"testcode\\\"],\\n\" +\n--- a/test/com/google/javascript/jscomp/parsing/IRFactoryTest.java\n+++ b/test/com/google/javascript/jscomp/parsing/IRFactoryTest.java\n     Node param3 = param2.getNext();\n     Node body = params.getNext();\n \n-    assertNodePosition(2, 5, function);\n+    assertNodePosition(1, 0, function);\n     assertNodePosition(2, 5, functionName);\n     // params corresponds to the LP token.\n     // Can't be on a separate line because of inferred\n     //assertNodePosition(1, 1, aDotbName);\n     assertNodePosition(1, 0, aName);\n     assertNodePosition(2, 0, bName);\n-    assertNodePosition(3, 8, fnNode);\n+    assertNodePosition(3, 0, fnNode);\n     assertNodePosition(3, 8, fnName);\n   }\n ", "timestamp": 1314879662, "metainfo": ""}