{"sha": "1313a65c11dea54f1baf492d4185fb2d673b6716", "log": "Applying unit test and fix for #LANG-292. Also fixes a couple of problems with the unescape(Writer..) overload that came up  ", "commit": "\n--- a/src/java/org/apache/commons/lang/Entities.java\n+++ b/src/java/org/apache/commons/lang/Entities.java\n                             } else {\n                                 entityValue = Integer.parseInt(entityName.substring(1));\n                             }\n+                            if (entityValue > 0xFFFF) {\n+                                entityValue = -1;\n+                            }\n                         } catch (NumberFormatException ex) {\n                             entityValue = -1;\n                         }\n                                     case 'X' :\n                                     case 'x' : {\n                                         entityValue = Integer.parseInt(entityContent.substring(2), 16);\n+                                        break;\n                                     }\n                                     default : {\n                                         entityValue = Integer.parseInt(entityContent.substring(1), 10);\n                                     }\n                                 }\n+                                if (entityValue > 0xFFFF) {\n+                                    entityValue = -1;\n+                                }\n                             } catch (NumberFormatException e) {\n-                                // ignore the escaped value content\n+                                entityValue = -1;\n                             }\n                         }\n                     } else { //escaped value content is an entity name\n--- a/src/test/org/apache/commons/lang/EntitiesTest.java\n+++ b/src/test/org/apache/commons/lang/EntitiesTest.java\n         assertEquals(\"&nbsp;\", e.escape(\"\\u00A0\"));\n     }\n \n+    public void testNumberOverflow() throws Exception {\n+        doTestUnescapeEntity(\"&#12345678;\", \"&#12345678;\");\n+        doTestUnescapeEntity(\"x&#12345678;y\", \"x&#12345678;y\");\n+        doTestUnescapeEntity(\"&#x12345678;\", \"&#x12345678;\");\n+        doTestUnescapeEntity(\"x&#x12345678;y\", \"x&#x12345678;y\");\n+    }\n+\n+\n }\n ", "timestamp": 1162330443, "metainfo": ""}