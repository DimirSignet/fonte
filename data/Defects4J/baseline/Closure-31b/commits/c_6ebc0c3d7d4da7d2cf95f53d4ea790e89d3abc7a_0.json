{"sha": "6ebc0c3d7d4da7d2cf95f53d4ea790e89d3abc7a", "log": "fix smartNameRemoval crash Fixes issue 284  R=johnlenz DELTA=39  (34 added, 2 deleted, 3 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=4165   ", "commit": "\n--- a/src/com/google/javascript/jscomp/NameAnalyzer.java\n+++ b/src/com/google/javascript/jscomp/NameAnalyzer.java\n         Node nameNode = n.getFirstChild();\n         NameInformation ns = createNameInformation(t, nameNode, n);\n         if (ns != null && ns.onlyAffectsClassDef) {\n-          JsName name = getName(ns.name, false);\n-          if (name != null) {\n-            refNodes.add(new ClassDefiningFunctionNode(\n-                            name, n, parent, parent.getParent()));\n-          }\n+          JsName name = getName(ns.name, true);\n+          refNodes.add(new ClassDefiningFunctionNode(\n+              name, n, parent, parent.getParent()));\n         }\n       }\n     }\n--- a/test/com/google/javascript/jscomp/IntegrationTest.java\n+++ b/test/com/google/javascript/jscomp/IntegrationTest.java\n         \"function f(a) {return a + 'xy'}\");\n   }\n \n+  public void testIssue284() {\n+    CompilerOptions options = createCompilerOptions();\n+    options.smartNameRemoval = true;\n+    test(options,\n+        \"var goog = {};\" +\n+        \"goog.inherits = function(x, y) {};\" +\n+        \"var ns = {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel = function() {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel.FooEvent = function() {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel.SelectEvent = function() {};\" +\n+        \"goog.inherits(ns.PageSelectionModel.ChangeEvent,\" +\n+        \"    ns.PageSelectionModel.FooEvent);\",\n+        \"\");\n+  }\n+\n   public void testCodingConvention() {\n     Compiler compiler = new Compiler();\n     compiler.initOptions(new CompilerOptions());\n--- a/test/com/google/javascript/jscomp/NameAnalyzerTest.java\n+++ b/test/com/google/javascript/jscomp/NameAnalyzerTest.java\n     test(\"var x = {}; x.a.prototype = 1\", \"\");\n   }\n \n+  public void testIssue284() {\n+    test(\n+        \"var goog = {};\" +\n+        \"goog.inherits = function(x, y) {};\" +\n+        \"var ns = {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel = function() {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel.FooEvent = function() {};\" +\n+        \"/** @constructor */\" +\n+        \"ns.PageSelectionModel.SelectEvent = function() {};\" +\n+        \"goog.inherits(ns.PageSelectionModel.ChangeEvent,\" +\n+        \"    ns.PageSelectionModel.FooEvent);\",\n+        \"\");\n+  }\n+\n \n   @Override\n   protected CompilerPass getProcessor(Compiler compiler) {", "timestamp": 1328201246, "metainfo": ""}