{"sha": "4c3f8ab1283ab41d43fd50a70436425788973bdf", "log": "Bug #20652 fixed.  Submitted by:\tFredrik Westermarck   ", "commit": "\n--- a/src/java/org/apache/commons/lang/StringUtils.java\n+++ b/src/java/org/apache/commons/lang/StringUtils.java\n  * @author Arun Mammen Thomas\n  * @author <a href=\"mailto:ggregory@seagullsw.com\">Gary Gregory</a>\n  * @since 1.0\n- * @version $Id: StringUtils.java,v 1.46 2003/06/08 14:10:54 scolebourne Exp $\n+ * @version $Id: StringUtils.java,v 1.47 2003/06/21 22:24:55 bayard Exp $\n  */\n public class StringUtils {\n \n      */\n     public static String chopNewline(String str) {\n         int lastIdx = str.length() - 1;\n+        if (lastIdx == 0) {\n+            return \"\";\n+        }\n         char last = str.charAt(lastIdx);\n         if (last == '\\n') {\n             if (str.charAt(lastIdx - 1) == '\\r') {\n--- a/src/test/org/apache/commons/lang/StringUtilsTest.java\n+++ b/src/test/org/apache/commons/lang/StringUtilsTest.java\n  * @author <a href=\"mailto:fredrik@westermarck.com>Fredrik Westermarck</a>\n  * @author Holger Krauth\n  * @author <a href=\"hps@intermeta.de\">Henning P. Schmiedehausen</a>\n- * @version $Id: StringUtilsTest.java,v 1.19 2003/04/16 04:37:33 bayard Exp $\n+ * @version $Id: StringUtilsTest.java,v 1.20 2003/06/21 22:24:56 bayard Exp $\n  */\n public class StringUtilsTest extends TestCase {\n \n                 \"foobar\", StringUtils.chomp(\"foobar\", \"baz\"));\n         assertEquals(\"chomp(String, String) failed\",\n                 \"foo\", StringUtils.chomp(\"foo\", \"foooo\"));\n+    }\n+\n+    public void testChopNewLine() {\n+\n+        String[][] newLineCases = {\n+            { FOO + \"\\r\\n\", FOO } ,\n+            { FOO + \"\\n\" , FOO } ,\n+            { FOO + \"\\r\", FOO + \"\\r\" },\n+            { FOO, FOO },\n+            { FOO + \"\\n\" + FOO , FOO + \"\\n\" + FOO },\n+            { FOO + \"\\n\\n\", FOO + \"\\n\"},\n+            { \"\\n\", \"\" },\n+            { \"\\r\\n\", \"\" }\n+      };\n+\n+      for (int i = 0; i < newLineCases.length; i++) {\n+          String original = newLineCases[i][0];\n+          String expectedResult = newLineCases[i][1];\n+          assertEquals(\"chopNewline(String) failed\",\n+                  expectedResult, StringUtils.chopNewline(original));\n+      }\n     }\n \n     public void testSliceFunctions() {", "timestamp": 1056234296, "metainfo": ""}