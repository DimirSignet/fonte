{"sha": "4a61fc6cd03fb84171c9f21bce5f627b3a5e6fff", "log": "Fixing issue #38569  ", "commit": "\n--- a/src/java/org/apache/commons/lang/Entities.java\n+++ b/src/java/org/apache/commons/lang/Entities.java\n                     buf.append(ch);\n                     continue;\n                 }\n+                int amph = str.indexOf('&', i + 1);\n+                if( amph != -1 && amph < semi ) {\n+                    // Then the text looks like &...&...;\n+                    buf.append(ch);\n+                    continue;\n+                }\n                 String entityName = str.substring(i + 1, semi);\n                 int entityValue;\n                 if (entityName.length() == 0) {\n                 int nextIdx = i+1;\n                 int semiColonIdx = string.indexOf(';', nextIdx);\n                 if (semiColonIdx == -1) {\n+                    writer.write(c);\n+                    continue;\n+                }\n+                int amphersandIdx = string.indexOf('&', i + 1);\n+                if( amphersandIdx != -1 && amphersandIdx < semiColonIdx ) {\n+                    // Then the text looks like &...&...;\n                     writer.write(c);\n                     continue;\n                 }\n--- a/src/test/org/apache/commons/lang/StringEscapeUtilsTest.java\n+++ b/src/test/org/apache/commons/lang/StringEscapeUtilsTest.java\n         assertEquals(\"\", StringEscapeUtils.escapeSql(\"\"));\n         assertEquals(null, StringEscapeUtils.escapeSql(null));\n     }\n+\n+    // Tests issue #38569\n+    // http://issues.apache.org/bugzilla/show_bug.cgi?id=38569\n+    public void testStandaloneAmphersand() {\n+        assertEquals(\"<P&O>\", StringEscapeUtils.unescapeHtml(\"&lt;P&O&gt;\"));\n+        assertEquals(\"test & <\", StringEscapeUtils.unescapeHtml(\"test & &lt;\"));\n+        assertEquals(\"<P&O>\", StringEscapeUtils.unescapeXml(\"&lt;P&O&gt;\"));\n+        assertEquals(\"test & <\", StringEscapeUtils.unescapeXml(\"test & &lt;\"));\n+    }\n+\n }\n-", "timestamp": 1145344982, "metainfo": ""}