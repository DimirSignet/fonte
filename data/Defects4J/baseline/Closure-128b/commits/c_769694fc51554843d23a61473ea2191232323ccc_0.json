{"sha": "769694fc51554843d23a61473ea2191232323ccc", "log": "fix some bad internal bookkeeping around optional parameters and the 'call' method.  R=dimvar DELTA=32  (31 added, 1 deleted, 0 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=5954   ", "commit": "\n--- a/src/com/google/javascript/rhino/jstype/FunctionType.java\n+++ b/src/com/google/javascript/rhino/jstype/FunctionType.java\n       thisTypeNode.setJSType(\n           registry.createOptionalNullableType(getTypeOfThis()));\n       params.addChildToFront(thisTypeNode);\n-      thisTypeNode.setOptionalArg(isCall);\n \n       if (isBind) {\n         // The arguments of bind() are unique in that they are all\n         for (Node current = thisTypeNode.getNext();\n              current != null; current = current.getNext()) {\n           current.setOptionalArg(true);\n+        }\n+      } else if (isCall) {\n+        // The first argument of call() is optional iff all the arguments\n+        // are optional. It's sufficient to check the first argument.\n+        Node firstArg = thisTypeNode.getNext();\n+        if (firstArg == null\n+            || firstArg.isOptionalArg()\n+            || firstArg.isVarArgs()) {\n+          thisTypeNode.setOptionalArg(true);\n         }\n       }\n \n--- a/test/com/google/javascript/rhino/jstype/FunctionTypeTest.java\n+++ b/test/com/google/javascript/rhino/jstype/FunctionTypeTest.java\n         \"function ((Date|null|undefined), string=, number=):\" +\n         \" function (...[?]): boolean\",\n         fn.getPropertyType(\"bind\").toString());\n+  }\n+\n+  public void testCallSignature1() {\n+    FunctionType fn = new FunctionBuilder(registry)\n+        .withTypeOfThis(DATE_TYPE)\n+        .withParamsNode(registry.createParameters(STRING_TYPE, NUMBER_TYPE))\n+        .withReturnType(BOOLEAN_TYPE).build();\n+\n+    assertEquals(\n+        \"function ((Date|null|undefined), string, number): boolean\",\n+        fn.getPropertyType(\"call\").toString());\n+  }\n+\n+  public void testCallSignature2() {\n+    FunctionType fn = new FunctionBuilder(registry)\n+        .withTypeOfThis(DATE_TYPE)\n+        .withParamsNode(registry.createParameters())\n+        .withReturnType(BOOLEAN_TYPE).build();\n+\n+    assertEquals(\n+        \"function ((Date|null)=): boolean\",\n+        fn.getPropertyType(\"call\").toString());\n   }\n \n   public void testPrint() {", "timestamp": 1355180092, "metainfo": ""}