{"sha": "fa1b3fc6216653c4b54883e34169a40c624e4018", "log": "Another attempt at the @ngInject + goog.inherit fix.  ------------- Created by MOE: http://code.google.com/p/moe-java MOE_MIGRATED_REVID=43990430", "commit": "\n--- a/src/com/google/javascript/jscomp/AngularPass.java\n+++ b/src/com/google/javascript/jscomp/AngularPass.java\n               dependenciesArray\n           )\n       );\n-      // adds `something.$inject = [...]` node after the annotated node.\n-      Node target = entry.getTarget();\n-      target.getParent().addChildAfter(statement, target);\n+      // adds `something.$inject = [...]` node after the annotated node or the following\n+      // goog.inherits call.\n+      Node insertionPoint = entry.getTarget();\n+      Node next = insertionPoint.getNext();\n+      while (next != null &&\n+             NodeUtil.isExprCall(next) &&\n+             convention.getClassesDefinedByCall(\n+                 next.getFirstChild()) != null) {\n+        insertionPoint = next;\n+        next = insertionPoint.getNext();\n+      }\n+\n+      insertionPoint.getParent().addChildAfter(statement, insertionPoint);\n       codeChanged = true;\n     }\n     if (codeChanged) {\n--- a/test/com/google/javascript/jscomp/AngularPassTest.java\n+++ b/test/com/google/javascript/jscomp/AngularPassTest.java\n     );\n   }\n \n+  public void testNgInjectAddsInjectAfterGoogInherits() throws Exception {\n+    test(\n+         \"/** @ngInject \\n @constructor */\" +\n+         \"function fn(a, b) {}\" +\n+         \"goog.inherits(fn, parent);\",\n+\n+         \"function fn(a, b) {}\\n\" +\n+         \"goog.inherits(fn, parent);\" +\n+         \"fn['$inject']=['a', 'b']\"\n+         );\n+\n+    test(\n+         \"/** @ngInject \\n @constructor */\" +\n+         \"function fn(a, b) {}\" +\n+         \"goog.inherits(fn, parent);\" +\n+         \"var foo = 42;\",\n+\n+         \"function fn(a, b) {}\\n\" +\n+         \"goog.inherits(fn, parent);\" +\n+         \"fn['$inject']=['a', 'b'];\" +\n+         \"var foo = 42;\"\n+         );\n+  }\n+\n   public void testNgInjectAddsInjectToProps() throws Exception {\n     test(\n         \"var ns = {};\\n\" +", "timestamp": 1363370074, "metainfo": ""}