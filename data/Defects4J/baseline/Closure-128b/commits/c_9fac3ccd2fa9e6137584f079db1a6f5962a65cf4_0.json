{"sha": "9fac3ccd2fa9e6137584f079db1a6f5962a65cf4", "log": "Don't attempt to inline aliases of external names during collapse properties as all the sets can not be accounted for. Fixes issue 931 ------------- Created by MOE: http://code.google.com/p/moe-java MOE_MIGRATED_REVID=43187988", "commit": "\n--- a/src/com/google/javascript/jscomp/CollapseProperties.java\n+++ b/src/com/google/javascript/jscomp/CollapseProperties.java\n         continue;\n       }\n \n-      if (name.globalSets == 1 && name.localSets == 0 &&\n+      if (!name.inExterns && name.globalSets == 1 && name.localSets == 0 &&\n           name.aliasingGets > 0) {\n         // {@code name} meets condition (b). Find all of its local aliases\n         // and try to inline them.\n--- a/test/com/google/javascript/jscomp/CollapsePropertiesTest.java\n+++ b/test/com/google/javascript/jscomp/CollapsePropertiesTest.java\n public class CollapsePropertiesTest extends CompilerTestCase {\n \n   private static String EXTERNS =\n-      \"var window; function alert(s) {} function parseInt(s) {}\" +\n-      \"/** @constructor */ function String() {}\";\n+      \"var window;\\n\" +\n+      \"function alert(s) {}\\n\" +\n+      \"function parseInt(s) {}\\n\" +\n+      \"/** @constructor */ function String() {};\\n\" +\n+      \"var arguments\";\n \n   private boolean collapsePropertiesOnExternTypes = false;\n \n          \"if (!Array.forEach) {\\n\" +\n          \"  Array.forEach = function() {};\\n\" +\n          \"}\", null, null);\n+  }\n+\n+  public void testIssue931() {\n+    collapsePropertiesOnExternTypes = true;\n+    testSame(\n+      \"function f() {\\n\" +\n+      \"  return function () {\\n\" +\n+      \"    var args = arguments;\\n\" +\n+      \"    setTimeout(function() { alert(args); }, 0);\\n\" +\n+      \"  }\\n\" +\n+      \"};\\n\");\n   }\n \n   public void testDoNotCollapsePropertyOnExternType() {", "timestamp": 1362006533, "metainfo": ""}