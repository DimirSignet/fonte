{"sha": "dc70a4bbfba18aa966a368a5568745d75b863dec", "log": "[Bug 35966] - [lang] StrBuilderTest#testReplaceStringString fails. From Nathan Beyer nbeyer@kc.rr.com.  ", "commit": "\n--- a/src/java/org/apache/commons/lang/text/StrBuilder.java\n+++ b/src/java/org/apache/commons/lang/text/StrBuilder.java\n     public StrBuilder replace(int startIndex, int endIndex, String str) {\n         endIndex = validateRange(startIndex, endIndex);\n         int insertLen = str.length();\n-        int removeLen = endIndex = startIndex;\n+        int removeLen = endIndex - startIndex;\n         int newSize = size - removeLen + insertLen;\n         if (insertLen > removeLen) {\n             ensureCapacity(newSize);\n      * @return this, to enable chaining\n      */\n     public StrBuilder reverse() {\n+        if (size == 0) {\n+            return this;\n+        }\n+        \n         int half = size / 2;\n-        char swap;\n-        for (int i = 0; i < half; i++) {\n-            swap = buf[i];\n-            buf[i] = buf[size - i];\n-            buf[size - i] = swap;\n+        for (int leftIdx = 0, rightIdx = size - 1; leftIdx < half; leftIdx++,rightIdx--) {\n+            char swap = buf[leftIdx];\n+            buf[leftIdx] = buf[rightIdx];\n+            buf[rightIdx] = swap;\n         }\n         return this;\n     }\n--- a/src/test/org/apache/commons/lang/text/StrBuilderTest.java\n+++ b/src/test/org/apache/commons/lang/text/StrBuilderTest.java\n         assertEquals(\"\", sb.toString());\n     }\n     \n-    public void toStringBuffer() {\n+    public void testStringBuffer() {\n         StrBuilder sb = new StrBuilder();\n         assertEquals (new StringBuffer().toString(), sb.toStringBuffer().toString());\n         \n         sb.append(\"junit\");\n         assertEquals(new StringBuffer(\"junit\").toString(), sb.toStringBuffer().toString());\n     }\n+    \n+    public void testReverse() {\n+        StrBuilder sb = new StrBuilder();\n+        \n+        String actual = sb.reverse().toString();\n+        assertEquals (\"\", actual);\n+        \n+        sb.append(true);\n+        actual = sb.reverse().toString();\n+        assertEquals(\"eurt\", actual);\n+        \n+        actual = sb.reverse().toString();\n+        assertEquals(\"true\", actual);\n+    }\n }", "timestamp": 1122944625, "metainfo": ""}