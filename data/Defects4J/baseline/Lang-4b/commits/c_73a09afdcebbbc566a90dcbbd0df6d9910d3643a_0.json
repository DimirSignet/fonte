{"sha": "73a09afdcebbbc566a90dcbbd0df6d9910d3643a", "log": "Making the EntityArrays class public by cloning the arrays when they are accessed. API might need a sanity check as this is the old Entities stuff. Also changing the arrays to be private and the rest of the code to use the cloning methods. This does add performance overhead, but I think it'll be negligible and better to practice safe coding. Part of LANG-505  ", "commit": "\n--- a/src/java/org/apache/commons/lang/text/translate/EntityArrays.java\n+++ b/src/java/org/apache/commons/lang/text/translate/EntityArrays.java\n package org.apache.commons.lang.text.translate;\n \n /**\n- * Package private class holding varius entity data for HTML and XML.\n+ * Class holding various entity data for HTML and XML - generally for use with \n+ * the LookupTranslator.\n  * All arrays are of length [*][2].\n  *\n  * @since 3.0\n  */\n-// TODO: These need to be public - make methods to return them for security purposes?\n-class EntityArrays {\n-\n-    static final String[][] ISO8859_1_ESCAPE = {\n+public class EntityArrays {\n+\n+    public static String[][] ISO8859_1_ESCAPE() { return ISO8859_1_ESCAPE.clone(); }\n+    private static final String[][] ISO8859_1_ESCAPE = {\n         {\"\\u00A0\", \"&nbsp;\"}, // non-breaking space\n         {\"\\u00A1\", \"&iexcl;\"}, // inverted exclamation mark\n         {\"\\u00A2\", \"&cent;\"}, // cent sign\n         {\"\\u00FF\", \"&yuml;\"}, //  - lowercase y, umlaut\n     };\n \n-    static final String[][] ISO8859_1_UNESCAPE = invert(ISO8859_1_ESCAPE);\n+    public static String[][] ISO8859_1_UNESCAPE() { return ISO8859_1_UNESCAPE.clone(); }\n+    private static final String[][] ISO8859_1_UNESCAPE = invert(ISO8859_1_ESCAPE);\n \n     // http://www.w3.org/TR/REC-html40/sgml/entities.html\n-    static final String[][] HTML40_EXTENDED_ESCAPE = {\n+    public static String[][] HTML40_EXTENDED_ESCAPE() { return HTML40_EXTENDED_ESCAPE.clone(); }\n+    private static final String[][] HTML40_EXTENDED_ESCAPE = {\n         // <!-- Latin Extended-B -->\n         {\"\\u0192\", \"&fnof;\"}, // latin small f with hook = function= florin, U+0192 ISOtech -->\n         // <!-- Greek -->\n         {\"\\u20AC\", \"&euro;\"}, // -- euro sign, U+20AC NEW -->\n     };\n \n-    static final String[][] HTML40_EXTENDED_UNESCAPE = invert(HTML40_EXTENDED_ESCAPE);\n-\n-    static final String[][] BASIC_ESCAPE = {\n+    public static String[][] HTML40_EXTENDED_UNESCAPE() { return HTML40_EXTENDED_UNESCAPE.clone(); }\n+    private static final String[][] HTML40_EXTENDED_UNESCAPE = invert(HTML40_EXTENDED_ESCAPE);\n+\n+    public static String[][] BASIC_ESCAPE() { return BASIC_ESCAPE.clone(); }\n+    private static final String[][] BASIC_ESCAPE = {\n         {\"\\\"\", \"&quot;\"}, // \" - double-quote\n         {\"&\", \"&amp;\"},   // & - ampersand\n         {\"<\", \"&lt;\"},    // < - less-than\n         {\">\", \"&gt;\"},    // > - greater-than\n     };\n \n-    static final String[][] BASIC_UNESCAPE = invert(BASIC_ESCAPE);\n-\n-    static final String[][] APOS_ESCAPE = {\n+    public static String[][] BASIC_UNESCAPE() { return BASIC_UNESCAPE.clone(); }\n+    private static final String[][] BASIC_UNESCAPE = invert(BASIC_ESCAPE);\n+\n+    public static String[][] APOS_ESCAPE() { return APOS_ESCAPE.clone(); }\n+    private static final String[][] APOS_ESCAPE = {\n         {\"'\", \"&apos;\"}, // XML apostrophe\n     };\n \n-    static final String[][] APOS_UNESCAPE = invert(APOS_ESCAPE);\n+    public static String[][] APOS_UNESCAPE() { return APOS_UNESCAPE.clone(); }\n+    private static final String[][] APOS_UNESCAPE = invert(APOS_ESCAPE);\n \n     /**\n      * Used to invert an escape array into an unescape array\n      * @param array String[][] to be inverted\n      * @return String[][] inverted array\n      */\n-    static String[][] invert(String[][] array) {\n+    public static String[][] invert(String[][] array) {\n         String[][] newarray = new String[array.length][2];\n         for(int i = 0; i<array.length; i++) {\n             newarray[i][0] = array[i][1];\n--- a/src/java/org/apache/commons/lang/text/translate/EscapeUtils.java\n+++ b/src/java/org/apache/commons/lang/text/translate/EscapeUtils.java\n                 \n     public static final CharSequenceTranslator ESCAPE_XML = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_ESCAPE),\n-            new LookupTranslator(EntityArrays.APOS_ESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_ESCAPE()),\n+            new LookupTranslator(EntityArrays.APOS_ESCAPE()),\n             NumericEntityEscaper.above(0x7f)\n         );\n \n                 \n     public static final CharSequenceTranslator ESCAPE_HTML3 = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_ESCAPE),\n-            new LookupTranslator(EntityArrays.ISO8859_1_ESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_ESCAPE()),\n+            new LookupTranslator(EntityArrays.ISO8859_1_ESCAPE()),\n             NumericEntityEscaper.above(0x7f)\n         );\n \n                 \n     public static final CharSequenceTranslator ESCAPE_HTML4 = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_ESCAPE),\n-            new LookupTranslator(EntityArrays.ISO8859_1_ESCAPE),\n-            new LookupTranslator(EntityArrays.HTML40_EXTENDED_ESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_ESCAPE()),\n+            new LookupTranslator(EntityArrays.ISO8859_1_ESCAPE()),\n+            new LookupTranslator(EntityArrays.HTML40_EXTENDED_ESCAPE()),\n             NumericEntityEscaper.above(0x7f)\n         );\n \n--- a/src/java/org/apache/commons/lang/text/translate/UnescapeUtils.java\n+++ b/src/java/org/apache/commons/lang/text/translate/UnescapeUtils.java\n                 \n     public static final CharSequenceTranslator UNESCAPE_HTML3 = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_UNESCAPE),\n-            new LookupTranslator(EntityArrays.ISO8859_1_UNESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_UNESCAPE()),\n+            new LookupTranslator(EntityArrays.ISO8859_1_UNESCAPE()),\n             new NumericEntityUnescaper()\n         );\n \n                 \n     public static final CharSequenceTranslator UNESCAPE_HTML4 = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_UNESCAPE),\n-            new LookupTranslator(EntityArrays.ISO8859_1_UNESCAPE),\n-            new LookupTranslator(EntityArrays.HTML40_EXTENDED_UNESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_UNESCAPE()),\n+            new LookupTranslator(EntityArrays.ISO8859_1_UNESCAPE()),\n+            new LookupTranslator(EntityArrays.HTML40_EXTENDED_UNESCAPE()),\n             new NumericEntityUnescaper()\n         );\n \n                 \n     public static final CharSequenceTranslator UNESCAPE_XML = \n         new AggregateTranslator(\n-            new LookupTranslator(EntityArrays.BASIC_UNESCAPE),\n-            new LookupTranslator(EntityArrays.APOS_UNESCAPE),\n+            new LookupTranslator(EntityArrays.BASIC_UNESCAPE()),\n+            new LookupTranslator(EntityArrays.APOS_UNESCAPE()),\n             new NumericEntityUnescaper()\n         );\n ", "timestamp": 1246344438, "metainfo": ""}