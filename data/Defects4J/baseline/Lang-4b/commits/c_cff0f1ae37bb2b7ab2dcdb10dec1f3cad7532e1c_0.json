{"sha": "cff0f1ae37bb2b7ab2dcdb10dec1f3cad7532e1c", "log": "[LANG-857] StringIndexOutOfBoundsException in CharSequenceTranslator.  ", "commit": "\n--- a/src/main/java/org/apache/commons/lang3/text/translate/CharSequenceTranslator.java\n+++ b/src/main/java/org/apache/commons/lang3/text/translate/CharSequenceTranslator.java\n //          // contract with translators is that they have to understand codepoints \n //          // and they just took care of a surrogate pair\n             for (int pt = 0; pt < consumed; pt++) {\n-                pos += Character.charCount(Character.codePointAt(input, pos));\n+                pos += Character.charCount(Character.codePointAt(input, pt));\n             }\n         }\n     }\n--- a/src/test/java/org/apache/commons/lang3/StringUtilsTest.java\n+++ b/src/test/java/org/apache/commons/lang3/StringUtilsTest.java\n         expectedBytes = expectedString.getBytes(encoding);\n         assertEquals(expectedString, StringUtils.toString(expectedBytes, encoding));\n     }\n+    \n+    @Test\n+    public void testEscapeSurrogatePairs() throws Exception {\n+        assertEquals(\"\\uD83D\\uDE30\", StringEscapeUtils.escapeCsv(\"\\uD83D\\uDE30\"));\n+        // Examples from https://en.wikipedia.org/wiki/UTF-16\n+        assertEquals(\"\\uD800\\uDC00\", StringEscapeUtils.escapeCsv(\"\\uD800\\uDC00\"));\n+        assertEquals(\"\\uD834\\uDD1E\", StringEscapeUtils.escapeCsv(\"\\uD834\\uDD1E\"));\n+        assertEquals(\"\\uDBFF\\uDFFD\", StringEscapeUtils.escapeCsv(\"\\uDBFF\\uDFFD\"));\n+        \n+    }\n }", "timestamp": 1353444350, "metainfo": ""}