{"sha": "1aa17f763aadb26bece2f19fd8e9d847d0cb7ba1", "log": "rescope global symbols needs to happen last  R=malteubl DELTA=16  (14 added, 2 deleted, 0 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=5490   ", "commit": "\n--- a/src/com/google/javascript/jscomp/DefaultPassConfig.java\n+++ b/src/com/google/javascript/jscomp/DefaultPassConfig.java\n       passes.add(nameUnmappedAnonymousFunctions);\n     }\n \n+    passes.add(stripSideEffectProtection);\n+\n     if (options.renamePrefixNamespace != null) {\n       if (!GLOBAL_SYMBOL_NAMESPACE_PATTERN.matcher(\n           options.renamePrefixNamespace).matches()) {\n       }\n       passes.add(rescopeGlobalSymbols);\n     }\n-\n-    passes.add(stripSideEffectProtection);\n \n     // Safety checks\n     passes.add(sanityCheckAst);\n--- a/test/com/google/javascript/jscomp/IntegrationTest.java\n+++ b/test/com/google/javascript/jscomp/IntegrationTest.java\n     options.collapseProperties = true;\n     options.renamePrefixNamespace = \"_\";\n     test(options, code, \"_.x$FOO = 5; _.x$bar = 3;\");\n+  }\n+\n+  public void testRenamePrefixNamespaceProtectSideEffects() {\n+    String code = \"var x = null; try { +x.FOO; } catch (e) {}\";\n+\n+    CompilerOptions options = createCompilerOptions();\n+    testSame(options, code);\n+\n+    CompilationLevel.SIMPLE_OPTIMIZATIONS.setOptionsForCompilationLevel(\n+        options);\n+    options.renamePrefixNamespace = \"_\";\n+    test(options, code, \"_.x = null; try { +_.x.FOO; } catch (e) {}\");\n   }\n \n   public void testRenamePrefixNamespaceActivatesMoveFunctionDeclarations() {", "timestamp": 1347393539, "metainfo": ""}