{"sha": "61095090415cff7cae4f3645fa76ee7cdd3ee23d", "log": "Fix stack overflow with cycle in prototype chain.  This cycle starts when detectImplicitPrototypeCycle calls getImplicitPrototype. GetImplicitPrototype calls referencedObjType.getImplicitPrototype(), which SOs because this == this.referencedObjType.  R=nicksantos,johnlenz,dimvar DELTA=20 (19 added, 1 deleted, 0 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=6041   ", "commit": "\n--- a/src/com/google/javascript/rhino/jstype/NamedType.java\n+++ b/src/com/google/javascript/rhino/jstype/NamedType.java\n     }\n     setReferencedType(type);\n     checkEnumElementCycle(t);\n+    checkProtoCycle(t);\n     setResolvedTypeInternal(getReferencedType());\n   }\n \n     JSType referencedType = getReferencedType();\n     if (referencedType instanceof EnumElementType &&\n         ((EnumElementType) referencedType).getPrimitiveType() == this) {\n+      handleTypeCycle(t);\n+    }\n+  }\n+\n+  private void checkProtoCycle(ErrorReporter t) {\n+    JSType referencedType = getReferencedType();\n+    if (referencedType == this) {\n       handleTypeCycle(t);\n     }\n   }\n--- a/src/com/google/javascript/rhino/jstype/ObjectType.java\n+++ b/src/com/google/javascript/rhino/jstype/ObjectType.java\n import com.google.common.collect.Sets;\n import com.google.javascript.rhino.JSDocInfo;\n import com.google.javascript.rhino.Node;\n-import com.google.javascript.rhino.jstype.StaticSlot;\n \n import java.util.Set;\n \n--- a/test/com/google/javascript/jscomp/IntegrationTest.java\n+++ b/test/com/google/javascript/jscomp/IntegrationTest.java\n \n   private static final String CLOSURE_COMPILED =\n       \"var COMPILED = true; var goog$exportSymbol = function() {};\";\n+\n+  public void testConstructorCycle() {\n+    CompilerOptions options = createCompilerOptions();\n+    options.checkTypes = true;\n+    test(options,\n+        \"/** @return {function()} */ var AsyncTestCase = function() {};\\n\" +\n+        \"/**\\n\" +\n+        \" * @constructor\\n\" +\n+        \" */ Foo = /** @type {function(new:Foo)} */ (AyncTestCase());\",\n+        RhinoErrorReporter.PARSE_ERROR);\n+  }\n \n   public void testBug1949424() {\n     CompilerOptions options = createCompilerOptions();", "timestamp": 1356130110, "metainfo": ""}