{"sha": "1e0570247c09cae5cf3c7b1e3f17cb71b38ba3aa", "log": "Automated g4 rollback  *** Reason for rollback ***  i screwed this up  *** Original change description ***  add a more robust failsafe mode  DELTA=29  (14 added, 6 deleted, 9 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=4359   ", "commit": "\n--- a/src/com/google/javascript/jscomp/ComposeWarningsGuard.java\n+++ b/src/com/google/javascript/jscomp/ComposeWarningsGuard.java\n \n   private final Comparator<WarningsGuard> guardComparator =\n       new GuardComparator(orderOfAddition);\n-  private boolean demoteErrors = false;\n \n   private static class GuardComparator\n       implements Comparator<WarningsGuard>, Serializable {\n     for (WarningsGuard guard : guards) {\n       CheckLevel newLevel = guard.level(error);\n       if (newLevel != null) {\n-        if (demoteErrors && newLevel == CheckLevel.ERROR) {\n-          return CheckLevel.WARNING;\n-        }\n         return newLevel;\n       }\n     }\n    */\n   ComposeWarningsGuard makeEmergencyFailSafeGuard() {\n     ComposeWarningsGuard safeGuard = new ComposeWarningsGuard();\n-    safeGuard.demoteErrors = true;\n     for (WarningsGuard guard : guards.descendingSet()) {\n-      safeGuard.addGuard(guard);\n+      if (guard instanceof StrictWarningsGuard) {\n+        continue;\n+      } else if (guard instanceof DiagnosticGroupWarningsGuard) {\n+        DiagnosticGroupWarningsGuard dgGuard =\n+            (DiagnosticGroupWarningsGuard) guard;\n+        if (dgGuard.level == CheckLevel.ERROR) {\n+          safeGuard.addGuard(\n+              new DiagnosticGroupWarningsGuard(\n+                  dgGuard.group, CheckLevel.WARNING));\n+        } else {\n+        safeGuard.addGuard(guard);\n+        }\n+      } else {\n+        safeGuard.addGuard(guard);\n+      }\n     }\n     return safeGuard;\n   }", "timestamp": 1331658646, "metainfo": ""}