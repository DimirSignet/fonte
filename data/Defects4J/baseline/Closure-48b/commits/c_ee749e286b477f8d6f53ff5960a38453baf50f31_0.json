{"sha": "ee749e286b477f8d6f53ff5960a38453baf50f31", "log": "Propertly fold \">>> 0\" on negative values. Fixes issue 200  R=acleung DELTA=10  (8 added, 0 deleted, 2 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=53018   ", "commit": "\n--- a/src/com/google/javascript/jscomp/PeepholeFoldConstants.java\n+++ b/src/com/google/javascript/jscomp/PeepholeFoldConstants.java\n           result = lvalInt >> rvalInt;\n           break;\n         case Token.URSH:\n-          result = lvalInt >>> rvalInt;\n+          // JavaScript handles zero shifts on signed numbers differently than\n+          // Java as an Java int can not represent the unsigned 32-bit number\n+          // where JavaScript can so use a long here.\n+          long lvalLong = lvalInt & 0xffffffffL;\n+          result = lvalLong >>> rvalInt;\n           break;\n         default:\n           throw new AssertionError(\"Unknown shift operator: \" +\n--- a/test/com/google/javascript/jscomp/PeepholeFoldConstantsTest.java\n+++ b/test/com/google/javascript/jscomp/PeepholeFoldConstantsTest.java\n \n   public void testFoldBitShifts() {\n     fold(\"x = 1 << 0\", \"x = 1\");\n+    fold(\"x = -1 << 0\", \"x = -1\");\n     fold(\"x = 1 << 1\", \"x = 2\");\n     fold(\"x = 3 << 1\", \"x = 6\");\n     fold(\"x = 1 << 8\", \"x = 256\");\n \n     fold(\"x = 1 >> 0\", \"x = 1\");\n+    fold(\"x = -1 >> 0\", \"x = -1\");\n     fold(\"x = 1 >> 1\", \"x = 0\");\n     fold(\"x = 2 >> 1\", \"x = 1\");\n     fold(\"x = 5 >> 1\", \"x = 2\");\n     fold(\"x = 10 >>> 1\", \"x = 5\");\n     fold(\"x = 10 >>> 2\", \"x = 2\");\n     fold(\"x = 10 >>> 5\", \"x = 0\");\n-    fold(\"x = -1 >>> 1\", \"x = \" + 0x7fffffff);\n+    fold(\"x = -1 >>> 1\", \"x = 2147483647\"); // 0x7fffffff\n+    fold(\"x = -1 >>> 0\", \"x = 4294967295\"); // 0xffffffff\n+    fold(\"x = -2 >>> 0\", \"x = 4294967294\"); // 0xfffffffe\n \n     fold(\"3000000000 << 1\", \"3000000000<<1\",\n          PeepholeFoldConstants.BITWISE_OPERAND_OUT_OF_RANGE);", "timestamp": 1279582905, "metainfo": ""}