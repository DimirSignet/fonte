{"sha": "04f380716cd2403ae87e2b0880a56369aa0c6c33", "log": "Hoist type declarations for hoisted functions This doesn't change any functionality, but will make it easier for me to clean some other things up.  R=johnlenz DELTA=26  (22 added, 0 deleted, 4 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=808   ", "commit": "\n--- a/src/com/google/javascript/jscomp/NodeUtil.java\n+++ b/src/com/google/javascript/jscomp/NodeUtil.java\n    * @return Whether the node is used as a statement.\n    */\n   static boolean isStatement(Node n) {\n-    Node parent = n.getParent();\n+    return isStatementParent(n.getParent());\n+  }\n+\n+  static boolean isStatementParent(Node parent) {\n     // It is not possible to determine definitely if a node is a statement\n     // or not if it is not part of the AST.  A FUNCTION node can be\n     // either part of an expression or a statement.\n--- a/src/com/google/javascript/jscomp/TypedScopeCreator.java\n+++ b/src/com/google/javascript/jscomp/TypedScopeCreator.java\n \n       // We do want to traverse the name of a named function, but we don't\n       // want to traverse the arguments or body.\n-      return parent == null || parent.getType() != Token.FUNCTION ||\n+      boolean descend = parent == null || parent.getType() != Token.FUNCTION ||\n           n == parent.getFirstChild() || parent == scope.getRootNode();\n+\n+      if (descend) {\n+        // Handle hoisted functions on pre-order traversal, so that they\n+        // get hit before other things in the scope.\n+        if (NodeUtil.isStatementParent(n)) {\n+          for (Node child = n.getFirstChild();\n+               child != null;\n+               child = child.getNext()) {\n+            if (NodeUtil.isHoistedFunctionDeclaration(child)) {\n+              defineFunctionLiteral(child, n);\n+            }\n+          }\n+        }\n+      }\n+\n+      return descend;\n     }\n \n     @Override\n             nonExternFunctions.add(n);\n           }\n \n-          defineFunctionLiteral(n, parent);\n+          // Hoisted functions are handled during pre-traversal.\n+          if (!NodeUtil.isHoistedFunctionDeclaration(n)) {\n+            defineFunctionLiteral(n, parent);\n+          }\n           break;\n \n         case Token.ASSIGN:\n--- a/test/com/google/javascript/jscomp/CodePrinterTest.java\n+++ b/test/com/google/javascript/jscomp/CodePrinterTest.java\n         + \"function f(a){};\\n\",\n         \"goog.java.Long;\\n\"\n         + \"/**\\n\"\n-        + \" * @param {Array} a\\n\"\n+        + \" * @param {(Array|null)} a\\n\"\n         + \" * @return {undefined}\\n\"\n         + \" */\\n\"\n         + \"function f(a) {\\n}\\n\");", "timestamp": 1299699987, "metainfo": ""}