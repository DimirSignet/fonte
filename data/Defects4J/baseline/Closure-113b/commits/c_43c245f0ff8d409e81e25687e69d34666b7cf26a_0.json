{"sha": "43c245f0ff8d409e81e25687e69d34666b7cf26a", "log": "fix a bug in open-source args parsing. Fixes issue 319.  R=johnlenz DELTA=24  (23 added, 0 deleted, 1 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=299   ", "commit": "\n--- a/src/com/google/javascript/jscomp/CommandLineRunner.java\n+++ b/src/com/google/javascript/jscomp/CommandLineRunner.java\n \n       @Override\n       public int parseArguments(Parameters params) throws CmdLineException {\n-        String param = params.getParameter(0);\n+        String param = null;\n+        try {\n+          param = params.getParameter(0);\n+        } catch (CmdLineException e) {}\n+\n         if (param == null) {\n           setter.addValue(true);\n           return 0;\n--- a/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n+++ b/test/com/google/javascript/jscomp/CommandLineRunnerTest.java\n   private List<Integer> exitCodes = null;\n   private ByteArrayOutputStream outReader = null;\n   private ByteArrayOutputStream errReader = null;\n+\n+  // If set, this will be appended to the end of the args list.\n+  // For testing args parsing.\n+  private String lastArg = null;\n \n   // If set to true, uses comparison by string instead of by AST.\n   private boolean useStringComparison = false;\n     super.setUp();\n     externs = DEFAULT_EXTERNS;\n     lastCompiler = null;\n+    lastArg = null;\n     outReader = new ByteArrayOutputStream();\n     errReader = new ByteArrayOutputStream();\n     useStringComparison = false;\n             \"Version: \"));\n   }\n \n+  public void testVersionFlag2() {\n+    lastArg = \"--version\";\n+    testSame(\"\");\n+    assertEquals(\n+        0,\n+        new String(errReader.toByteArray()).indexOf(\n+            \"Closure Compiler (http://code.google.com/closure/compiler)\\n\" +\n+            \"Version: \"));\n+  }\n+\n   public void testPrintAstFlag() {\n     args.add(\"--print_ast=true\");\n     testSame(\"\");\n         args.add(\"--module\");\n         args.add(\"mod\" + i + \":1\" + (i > 0 ? \":mod0\" : \"\"));\n       }\n+    }\n+\n+    if (lastArg != null) {\n+      args.add(lastArg);\n     }\n \n     String[] argStrings = args.toArray(new String[] {});", "timestamp": 1295373752, "metainfo": ""}