{"sha": "82649cae8f3431169a3b8e6a6f14adf4f495a350", "log": "PR: Bugzilla Bug 27661 [lang] [patch] ArrayUtils.addAll doesn't always return new array Submitted by:\tMaarten Coene Reviewed by:\t Gary Gregory   ", "commit": "\n--- a/src/java/org/apache/commons/lang/ArrayUtils.java\n+++ b/src/java/org/apache/commons/lang/ArrayUtils.java\n  * @author <a href=\"mailto:equinus100@hotmail.com\">Ashwin S</a>\n  * @author Maarten Coene\n  * @since 2.0\n- * @version $Id: ArrayUtils.java,v 1.42 2004/02/18 22:59:50 ggregory Exp $\n+ * @version $Id: ArrayUtils.java,v 1.43 2004/03/16 01:40:57 ggregory Exp $\n  */\n public class ArrayUtils {\n \n     /**\n      * <p>Adds all the elements of the provided arrays into a new array.</p>\n      * <p>The new array contains all of the element of <code>array1</code> followed\n-     * by all of the elements <code>array2</code>.</p>\n+     * by all of the elements <code>array2</code>. If an array is returned, it is always\n+     * a new array.</p>\n      *\n      * <pre>\n      * ArrayUtils.addAll(null, null)     = null\n-     * ArrayUtils.addAll(array1, null)   = array1\n-     * ArrayUtils.addAll(null, array2)   = array2\n+     * ArrayUtils.addAll(array1, null)   = cloned copy of array1\n+     * ArrayUtils.addAll(null, array2)   = cloned copy of array2\n      * ArrayUtils.addAll([], [])         = []\n      * ArrayUtils.addAll([null], [null]) = [null, null]\n      * ArrayUtils.addAll([\"a\", \"b\", \"c\"], [\"1\", \"2\", \"3\"]) = [\"a\", \"b\", \"c\", \"1\", \"2\", \"3\"]\n      */\n     public static Object[] addAll(Object[] array1, Object[] array2) {\n         if (array1 == null) {\n-            return array2;\n+            return clone(array2);\n         } else if (array2 == null) {\n-            return array1;\n+            return clone(array1);\n         } else {\n             Object[] joinedArray = (Object[]) Array.newInstance(array1.getClass().getComponentType(), array1.length\n                 + array2.length);\n--- a/src/test/org/apache/commons/lang/ArrayUtilsAddTest.java\n+++ b/src/test/org/apache/commons/lang/ArrayUtilsAddTest.java\n  * Tests ArrayUtils add methods.\n  * \n  * @author Gary D. Gregory\n- * @version $Id: ArrayUtilsAddTest.java,v 1.2 2004/02/18 23:06:19 ggregory Exp $\n+ * @version $Id: ArrayUtilsAddTest.java,v 1.3 2004/03/16 01:40:57 ggregory Exp $\n  */\n public class ArrayUtilsAddTest extends TestCase {\n     public static void main(String[] args) {\n         String[] stringArray1 = new String[]{\"a\", \"b\", \"c\"};\n         String[] stringArray2 = new String[]{\"1\", \"2\", \"3\"};\n         newArray = ArrayUtils.addAll(stringArray1, null);\n+        assertNotSame(stringArray1, newArray);\n         assertTrue(Arrays.equals(stringArray1, newArray));\n         assertTrue(Arrays.equals((new String[]{\"a\", \"b\", \"c\"}), newArray));\n         assertEquals(String.class, newArray.getClass().getComponentType());\n         newArray = ArrayUtils.addAll(null, stringArray2);\n+        assertNotSame(stringArray2, newArray);\n         assertTrue(Arrays.equals(stringArray2, newArray));\n         assertTrue(Arrays.equals((new String[]{\"1\", \"2\", \"3\"}), newArray));\n         assertEquals(String.class, newArray.getClass().getComponentType());", "timestamp": 1079401257, "metainfo": ""}