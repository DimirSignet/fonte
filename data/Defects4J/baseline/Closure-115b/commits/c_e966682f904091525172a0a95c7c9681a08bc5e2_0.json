{"sha": "e966682f904091525172a0a95c7c9681a08bc5e2", "log": "Fix NPE in AttachJsDoc. Fixes issue 1073. R=blickly", "commit": "\n--- a/lib/rhino/src/org/mozilla/javascript/AttachJsDocs.java\n+++ b/lib/rhino/src/org/mozilla/javascript/AttachJsDocs.java\n         return new NodePos(n, napos);\n \n       case Token.RETURN:\n-        res = attachComment(((ReturnStatement) n).getReturnValue(), napos);\n-        if (res != null) {\n-          return res;\n+        AstNode retValue = ((ReturnStatement) n).getReturnValue();\n+        if (retValue != null) {\n+          res = attachComment(retValue, napos);\n+          if (res != null) {\n+            return res;\n+          }\n         }\n         return new NodePos(n, napos);\n \n--- a/test/com/google/javascript/jscomp/parsing/ParserTest.java\n+++ b/test/com/google/javascript/jscomp/parsing/ParserTest.java\n     Node cast =\n         fn.getLastChild().getFirstChild().getFirstChild().getFirstChild();\n     assertEquals(Token.CAST, cast.getType());\n+  }\n+\n+  public void testJSDocAttachment19() {\n+    Node fn =\n+        parse(\n+            \"function f() { \" +\n+            \"  /** @type {string} */\" +\n+            \"  return;\" +\n+            \"};\").getFirstChild();\n+    assertEquals(Token.FUNCTION, fn.getType());\n+\n+    Node ret = fn.getLastChild().getFirstChild();\n+    assertEquals(Token.RETURN, ret.getType());\n+    assertNull(ret.getJSDocInfo());\n+  }\n+\n+  public void testJSDocAttachment20() {\n+    Node fn =\n+        parse(\n+            \"function f() { \" +\n+            \"  /** @type {string} */\" +\n+            \"  if (true) return;\" +\n+            \"};\").getFirstChild();\n+    assertEquals(Token.FUNCTION, fn.getType());\n+\n+    Node ret = fn.getLastChild().getFirstChild();\n+    assertEquals(Token.IF, ret.getType());\n+    assertNull(ret.getJSDocInfo());\n   }\n \n   public void testInlineJSDocAttachment1() {", "timestamp": 1377901844, "metainfo": ""}