{"sha": "1668b7774dd529234defd8c19cf6d20a1673b582", "log": "Move peephole TRY folding to PeepholdRemoveDeadCode.  R=nicksantos DELTA=35  (34 added, 0 deleted, 1 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=218   ", "commit": "\n--- a/src/com/google/javascript/jscomp/PeepholeRemoveDeadCode.java\n+++ b/src/com/google/javascript/jscomp/PeepholeRemoveDeadCode.java\n         return tryFoldFor(subtree);\n       case Token.DO:\n         return tryFoldDo(subtree);\n-        default:\n+      case Token.TRY:\n+        return tryFoldTry(subtree);\n+      default:\n           return subtree;\n     }\n+  }\n+\n+  /**\n+   * Remove try blocks without catch blocks and with empty or not\n+   * existent finally blocks.\n+   * @return the replacement node, if changed, or the original if not\n+   */\n+  private Node tryFoldTry(Node n) {\n+    // Removes TRYs that had its CATCH removed and/or empty FINALLY.\n+    Preconditions.checkState(n.getType() == Token.TRY);\n+    Node body = n.getFirstChild();\n+    Node catchBlock = body.getNext();\n+    Node finallyBlock = catchBlock.getNext();\n+\n+    if (!catchBlock.hasChildren() &&\n+        (finallyBlock == null || !finallyBlock.hasChildren())) {\n+      n.removeChild(body);\n+      n.getParent().replaceChild(n, body);\n+      reportCodeChange();\n+      return body;\n+    }\n+\n+    return n;\n   }\n \n   /**\n--- a/test/com/google/javascript/jscomp/PeepholeRemoveDeadCodeTest.java\n+++ b/test/com/google/javascript/jscomp/PeepholeRemoveDeadCodeTest.java\n     test(\"var y=(x=x)\", \"var y=x\");\n     test(\"y=1 + (x=x)\", \"y=1 + x\");\n   }\n+  \n+  public void testTryCatchFinally() {\n+    testSame(\"try {foo()} catch (e) {bar()}\");\n+    testSame(\"try { try {foo()} catch (e) {bar()}} catch (x) {bar()}\");\n+    test(\"try {var x = 1} finally {}\", \"var x = 1;\");\n+    testSame(\"try {var x = 1} finally {x()}\");\n+    test(\"function f() { return; try{var x = 1}finally{} }\",\n+        \"function f() { return; var x = 1; }\");\n+  }  \n }", "timestamp": 1294361709, "metainfo": ""}