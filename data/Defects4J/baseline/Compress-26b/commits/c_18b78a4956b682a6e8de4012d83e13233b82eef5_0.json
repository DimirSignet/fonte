{"sha": "18b78a4956b682a6e8de4012d83e13233b82eef5", "log": "improve test-coverage of pack200 package  ", "commit": "\n--- a/src/test/java/org/apache/commons/compress/compressors/Pack200TestCase.java\n+++ b/src/test/java/org/apache/commons/compress/compressors/Pack200TestCase.java\n import java.io.FileInputStream;\n import java.io.FileOutputStream;\n import java.io.InputStream;\n+import java.io.IOException;\n import java.io.OutputStream;\n import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n import org.apache.commons.compress.AbstractTestCase;\n import org.apache.commons.compress.archivers.ArchiveEntry;\n             is.close();\n         }\n     }\n+\n+    public void testShortSignature() throws Exception {\n+        final InputStream is = new FileInputStream(getFile(\"bla.pack\"));\n+        try {\n+            byte[] sig = new byte[2];\n+            is.read(sig);\n+            assertFalse(Pack200CompressorInputStream.matches(sig, 2));\n+        } finally {\n+            is.close();\n+        }\n+    }\n+\n+    public void testInputStreamMethods() throws Exception {\n+        Map<String, String> m = new HashMap<String, String>();\n+        m.put(\"foo\", \"bar\");\n+        final InputStream is =\n+            new Pack200CompressorInputStream(new FileInputStream(getFile(\"bla.jar\")),\n+                                             m);\n+        try {\n+            // packed file is a jar, which is a zip so it starts with\n+            // a local file header\n+            assertTrue(is.markSupported());\n+            is.mark(5);\n+            assertEquals(0x50, is.read());\n+            byte[] rest = new byte[3];\n+            assertEquals(3, is.read(rest));\n+            assertEquals(0x4b, rest[0]);\n+            assertEquals(3, rest[1]);\n+            assertEquals(4, rest[2]);\n+            assertEquals(1, is.skip(1));\n+            is.reset();\n+            assertEquals(0x50, is.read());\n+            assertTrue(is.available() > 0);\n+        } finally {\n+            is.close();\n+        }\n+    }\n+\n+    public void testOutputStreamMethods() throws Exception {\n+        final File output = new File(dir, \"bla.pack\");\n+        Map<String, String> m = new HashMap<String, String>();\n+        m.put(\"foo\", \"bar\");\n+        final OutputStream out = new FileOutputStream(output);\n+        try {\n+            final OutputStream os = new Pack200CompressorOutputStream(out, m);\n+            os.write(1);\n+            os.write(new byte[] { 2, 3 });\n+            os.close();\n+        } finally {\n+            out.close();\n+        }\n+    }\n }", "timestamp": 1319625338, "metainfo": ""}