{"sha": "173671957fc11b5a2c6e517c4e40729149ed20d2", "log": "Mode will be zero for trailers in old format cpio archives too.  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveEntry.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveEntry.java\n  * <p>The MAGIC numbers and other constants are defined in {@link CpioConstants}\n  * @see \"http://people.freebsd.org/~kientzle/libarchive/man/cpio.5.txt\"\n  * \n+ * <p>\n+ * N.B. does not handle the cpio \"tar\" format\n+ * </p>\n  * @NotThreadSafe\n  */\n public class CpioArchiveEntry implements CpioConstants, ArchiveEntry {\n--- a/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveInputStream.java\n \n         ret.setDevice(readAsciiLong(6, 8));\n         ret.setInode(readAsciiLong(6, 8));\n-        ret.setMode(readAsciiLong(6, 8));\n+        final long mode = readAsciiLong(6, 8);\n+        if (mode != 0) {\n+            ret.setMode(mode);\n+        }\n         ret.setUID(readAsciiLong(6, 8));\n         ret.setGID(readAsciiLong(6, 8));\n         ret.setNumberOfLinks(readAsciiLong(6, 8));\n         ret.setTime(readAsciiLong(11, 8));\n         long namesize = readAsciiLong(6, 8);\n         ret.setSize(readAsciiLong(11, 8));\n-        ret.setName(readCString((int) namesize));\n+        final String name = readCString((int) namesize);\n+        ret.setName(name);\n+        if (mode == 0 && !name.equals(CPIO_TRAILER)){\n+            // TODO - change this to throw\n+            new IOException(\"Mode 0 only allowed in the trailer. Found: \"+name).printStackTrace();\n+        }\n \n         return ret;\n     }\n \n         ret.setDevice(readBinaryLong(2, swapHalfWord));\n         ret.setInode(readBinaryLong(2, swapHalfWord));\n-        ret.setMode(readBinaryLong(2, swapHalfWord));\n+        final long mode = readBinaryLong(2, swapHalfWord);\n+        if (mode != 0){\n+            ret.setMode(mode);            \n+        }\n         ret.setUID(readBinaryLong(2, swapHalfWord));\n         ret.setGID(readBinaryLong(2, swapHalfWord));\n         ret.setNumberOfLinks(readBinaryLong(2, swapHalfWord));\n         ret.setTime(readBinaryLong(4, swapHalfWord));\n         long namesize = readBinaryLong(2, swapHalfWord);\n         ret.setSize(readBinaryLong(4, swapHalfWord));\n-        ret.setName(readCString((int) namesize));\n+        final String name = readCString((int) namesize);\n+        ret.setName(name);\n+        if (mode == 0 && !name.equals(CPIO_TRAILER)){\n+            // TODO - change this to throw\n+            new IOException(\"Mode 0 only allowed in the trailer. Found: \"+name).printStackTrace();\n+        }\n         skip(ret.getHeaderPadCount());\n \n         return ret;", "timestamp": 1238268836, "metainfo": ""}