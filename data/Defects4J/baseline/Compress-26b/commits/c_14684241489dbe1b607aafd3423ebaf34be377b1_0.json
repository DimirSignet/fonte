{"sha": "14684241489dbe1b607aafd3423ebaf34be377b1", "log": "it looks as if CPIO was writing files in blocks with 512 being the default blocksize.  COMPRESS-85  ", "commit": "\n--- a/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveOutputStream.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/cpio/CpioArchiveOutputStream.java\n      *            The format of the stream\n      */\n     public CpioArchiveOutputStream(final OutputStream out, final short format) {\n-        this.out = new FilterOutputStream(out);\n+        this.out = new CountingStream(out);\n         switch (format) {\n         case FORMAT_NEW:\n         case FORMAT_NEW_CRC:\n         this.entry.setNumberOfLinks(1);\n         writeHeader(this.entry);\n         closeArchiveEntry();\n-        \n+\n+        int lengthOfLastBlock =\n+            (int) (((CountingStream) out).getTotalWritten() % BLOCK_SIZE);\n+        if (lengthOfLastBlock != 0) {\n+            pad(BLOCK_SIZE - lengthOfLastBlock);\n+        }\n+\n         finished = true;\n     }\n \n         return new CpioArchiveEntry(inputFile, entryName);\n     }\n \n+    private static class CountingStream extends FilterOutputStream {\n+        private long totalWritten = 0;\n+\n+        private CountingStream(final OutputStream out) {\n+            super(out);\n+        }\n+        public void write(byte[] b) throws IOException {\n+            write(b, 0, b.length);\n+        }\n+        public void write(int b) throws IOException {\n+            totalWritten++;\n+            out.write(b);\n+        }\n+        public void write(byte[] b, int off, int len)\n+            throws IOException {\n+            totalWritten += len;\n+            out.write(b, off, len);\n+        }\n+        private long getTotalWritten() { return totalWritten; }\n+    }\n }\n--- a/src/main/java/org/apache/commons/compress/archivers/cpio/CpioConstants.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/cpio/CpioConstants.java\n \n     /** The special trailer marker */\n     final String CPIO_TRAILER = \"TRAILER!!!\";\n+\n+    /** The default block size */\n+    final int BLOCK_SIZE = 512;\n }", "timestamp": 1266422421, "metainfo": ""}