{"sha": "b57a1aec395cff5156812295c9dbaf9b7edbddcf", "log": "Fix for CODEC-101:  java.io.InputStreamReader hates it when InputStream.read(byte[]) returns a zero. (Adding an extra JUnit Test for good luck.)  ", "commit": "\n--- a/src/test/org/apache/commons/codec/binary/Base64InputStreamTest.java\n+++ b/src/test/org/apache/commons/codec/binary/Base64InputStreamTest.java\n \n package org.apache.commons.codec.binary;\n \n+import java.io.BufferedReader;\n import java.io.ByteArrayInputStream;\n import java.io.InputStream;\n+import java.io.InputStreamReader;\n import java.util.Arrays;\n \n import junit.framework.TestCase;\n \n         c = in.read(result);\n         assertTrue(\"Codec101: Second read should report end-of-stream [c=\" + c + \"]\", c < 0);\n+    }\n+\n+    /**\n+     * Another test for the CODEC-101 bug:\n+     * In commons-codec-1.4 this test shows InputStreamReader explicitly hating an\n+     * InputStream.read(byte[]) return of 0:\n+     *\n+     * java.io.IOException: Underlying input stream returned zero bytes\n+     * at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:268)\n+     * at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)\n+     * at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)\n+     * at java.io.InputStreamReader.read(InputStreamReader.java:167)\n+     * at java.io.BufferedReader.fill(BufferedReader.java:136)\n+     * at java.io.BufferedReader.readLine(BufferedReader.java:299)\n+     * at java.io.BufferedReader.readLine(BufferedReader.java:362)\n+     * at org.apache.commons.codec.binary.Base64InputStreamTest.testInputStreamReader(Base64InputStreamTest.java:75)\n+     *\n+     * But in commons-codec-1.5 it's fixed.  :-)\n+     *\n+     * @throws Exception for some failure scenarios.\n+     */\n+    public void testInputStreamReader() throws Exception {\n+        byte[] codec101 = StringUtils.getBytesUtf8(Base64TestData.CODEC_101_MULTIPLE_OF_3);\n+        ByteArrayInputStream bais = new ByteArrayInputStream(codec101);\n+        Base64InputStream in = new Base64InputStream(bais);\n+        InputStreamReader isr = new InputStreamReader(in);\n+        BufferedReader br = new BufferedReader(isr);\n+        String line = br.readLine();\n+        assertNotNull(\"Codec101:  InputStreamReader works!\", line);\n     }\n \n     /**", "timestamp": 1295638751, "metainfo": ""}