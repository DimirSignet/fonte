{"sha": "28b7b958d39730fc278fd1919bf335c52133a1a2", "log": "[CODEC-199] Bug in HW rule in Soundex.  ", "commit": "\n--- a/src/main/java/org/apache/commons/codec/language/Soundex.java\n+++ b/src/main/java/org/apache/commons/codec/language/Soundex.java\n         final char mappedChar = this.map(str.charAt(index));\n         // HW rule check\n         if (index > 1 && mappedChar != '0') {\n-            final char hwChar = str.charAt(index - 1);\n-            if ('H' == hwChar || 'W' == hwChar) {\n-                final char preHWChar = str.charAt(index - 2);\n-                final char firstCode = this.map(preHWChar);\n-                if (firstCode == mappedChar || 'H' == preHWChar || 'W' == preHWChar) {\n+            for (int i=index-1 ; i>=0 ; i--) {\n+                final char prevChar = str.charAt(i);\n+                if (this.map(prevChar)==mappedChar) {\n                     return 0;\n+                }\n+                if ('H'!=prevChar && 'W'!=prevChar) {\n+                    break;\n                 }\n             }\n         }\n--- a/src/test/java/org/apache/commons/codec/language/SoundexTest.java\n+++ b/src/test/java/org/apache/commons/codec/language/SoundexTest.java\n         // for the F). It is not coded A-226.\n         Assert.assertEquals(\"A261\", this.getStringEncoder().encode(\"Ashcraft\"));\n         Assert.assertEquals(\"A261\", this.getStringEncoder().encode(\"Ashcroft\"));\n+        Assert.assertEquals(\"Y330\", this.getStringEncoder().encode(\"yehudit\"));\n+        Assert.assertEquals(\"Y330\", this.getStringEncoder().encode(\"yhwdyt\"));\n     }\n \n     /**\n             Assert.assertEquals(\"\", this.getStringEncoder().encode(\"\\u00f6\"));\n         }\n     }\n+    \n+    /**\n+     * Tests example from http://en.wikipedia.org/wiki/Soundex#American_Soundex as of 2015-03-22.\n+     */\n+    @Test\n+    public void testWikipediaAmericanSoundex() {\n+        Assert.assertEquals(\"R163\", this.getStringEncoder().encode(\"Robert\"));        \n+        Assert.assertEquals(\"R163\", this.getStringEncoder().encode(\"Rupert\"));        \n+        Assert.assertEquals(\"A261\", this.getStringEncoder().encode(\"Ashcraft\"));        \n+        Assert.assertEquals(\"A261\", this.getStringEncoder().encode(\"Ashcroft\"));        \n+        Assert.assertEquals(\"T522\", this.getStringEncoder().encode(\"Tymczak\"));        \n+        Assert.assertEquals(\"P236\", this.getStringEncoder().encode(\"Pfister\"));        \n+    }\n }", "timestamp": 1427050132, "metainfo": ""}