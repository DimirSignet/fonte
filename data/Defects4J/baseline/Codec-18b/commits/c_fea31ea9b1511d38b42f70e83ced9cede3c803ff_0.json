{"sha": "fea31ea9b1511d38b42f70e83ced9cede3c803ff", "log": "[CODEC-174] 15% performance gain with this patch from https://issues.apache.org/jira/secure/attachment/12613371/CODEC-174-refactor-restrictTo-method-in-SomeLanguages.patch. See test Javadoc.  ", "commit": "\n--- a/src/main/java/org/apache/commons/codec/language/bm/Languages.java\n+++ b/src/main/java/org/apache/commons/codec/language/bm/Languages.java\n                 return this;\n             } else {\n                 final SomeLanguages sl = (SomeLanguages) other;\n-                if (sl.languages.containsAll(languages)) {\n-                    return this;\n-                } else {\n-                    final Set<String> ls = new HashSet<String>(this.languages);\n-                    ls.retainAll(sl.languages);\n-                    return from(ls);\n+                final Set<String> ls = new HashSet<String>(Math.min(languages.size(), sl.languages.size()));\n+                for (String lang : languages) {\n+                    if (sl.languages.contains(lang)) {\n+                        ls.add(lang);\n+                    }\n                 }\n+                return from(ls);\n             }\n         }\n \n--- a/src/test/java/org/apache/commons/codec/language/bm/PhoneticEnginePerformanceTest.java\n+++ b/src/test/java/org/apache/commons/codec/language/bm/PhoneticEnginePerformanceTest.java\n  * <p>\n  * Patch applied, committed revision 1539788.\n  * </p>\n+ * <p>\n+ * Before patch https://issues.apache.org/jira/secure/attachment/12613371/CODEC-174-refactor-restrictTo-method-in-SomeLanguages.patch\n+ * </p>\n+ * <ol>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 13,133 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 13,064 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': <b>12,838 millis.</b></li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 12,970 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 13,122 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 13,293 millis.</li>\n+ * </ol>\n+ * <p>\n+ * After patch https://issues.apache.org/jira/secure/attachment/12613371/CODEC-174-refactor-restrictTo-method-in-SomeLanguages.patch\n+ * </p>\n+ * <ol>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 11,576 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 11,506 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 11,361 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': <b>11,142 millis.</b></li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 11,430 millis.</li>\n+ * <li>Time for encoding 80,000 times the input 'Angelo': 11,297 millis.</li>\n+ * </ol>\n+ * <p>\n+ * Patch applied, committed revision 1541234.\n+ * </p>\n  */\n public class PhoneticEnginePerformanceTest {\n ", "timestamp": 1384291205, "metainfo": ""}